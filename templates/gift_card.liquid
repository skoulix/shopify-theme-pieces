{% layout none %}

<!doctype html>
<html lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    <title>{{ gift_card.balance | money }} - {{ shop.name }}</title>

    {% render 'css-variables' %}
    {% render 'meta-tags' %}

    {{ content_for_header }}

    {%- comment -%} Phosphor Icons {%- endcomment -%}
    {{ 'phosphor-icons.css' | asset_url | stylesheet_tag: preload: true }}

    {%- comment -%} Tailwind CSS {%- endcomment -%}
    {{ 'pieces-app.css' | asset_url | stylesheet_tag: preload: true }}

    <style>
      .gift-card-wrapper { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--color-background); }
      .gift-card-container { width: 100%; max-width: 28rem; padding: 2rem; }
      .gift-card-balance { font-size: calc(clamp(3rem, 12vw, 5rem) * var(--heading-font-scale, 1)); letter-spacing: calc(-0.03em + var(--heading-letter-spacing, 0em)); line-height: 1; }
      .gift-card-visual { position: relative; aspect-ratio: 1.6; background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-text) 100%); border-radius: 1rem; overflow: hidden; }
      .gift-card-visual::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
      .gift-card-visual-content { position: relative; z-index: 1; height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 1.5rem; color: white; }
      .gift-card-code-display { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 1.125rem; letter-spacing: 0.15em; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 0.75rem 1rem; border-radius: 0.5rem; text-align: center; }
      .gift-card-wrapper.is-loading .gift-card-animate { opacity: 0; transform: translateY(20px); }
      .gift-card-wrapper.is-ready .gift-card-animate { opacity: 1; transform: translateY(0); transition: opacity 0.6s ease, transform 0.6s ease; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(1) { transition-delay: 0s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(2) { transition-delay: 0.1s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(3) { transition-delay: 0.2s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(4) { transition-delay: 0.3s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(5) { transition-delay: 0.4s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(6) { transition-delay: 0.5s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(7) { transition-delay: 0.6s; }
      .gift-card-wrapper.is-ready .gift-card-animate:nth-child(8) { transition-delay: 0.7s; }
      .qr-code { display: flex; align-items: center; justify-content: center; }
      .qr-code img { background: white; padding: 0.5rem; border-radius: 0.5rem; }
    </style>
  </head>

  <body class="antialiased">
    <div class="gift-card-wrapper is-loading" data-gift-card-wrapper>
      <div class="gift-card-container">
        {%- comment -%} Header with Shop Name {%- endcomment -%}
        <div class="gift-card-animate text-center mb-8">
          {% render 'logo', class: 'h-auto mx-auto', loading: 'eager' %}
        </div>

        {%- comment -%} Gift Card Visual {%- endcomment -%}
        <div class="gift-card-animate gift-card-visual">
          <div class="gift-card-visual-content">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm uppercase tracking-wider opacity-70">{{ 'gift_card.card' | t }}</p>
                <p class="popup-title mt-1">{{ shop.name }}</p>
              </div>
              <i class="ph ph-gift text-3xl opacity-70"></i>
            </div>

            <div>
              <p class="text-sm uppercase tracking-wider opacity-70 mb-2">Card Number</p>
              <div class="gift-card-code-display">
                {{ gift_card.code | format_code }}
              </div>
            </div>
          </div>
        </div>

        {%- comment -%} Balance {%- endcomment -%}
        <div class="gift-card-animate text-center mt-8">
          <p class="text-sm uppercase tracking-wider font-medium text-[--color-text-secondary] mb-2">
            {{ 'gift_card.balance' | t }}
          </p>
          <p class="gift-card-balance section-title text-[--color-text]">
            {{ gift_card.balance | money }}
          </p>

          {% if gift_card.enabled == false or gift_card.expired %}
            <p class="mt-3 inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-800 text-sm font-medium rounded-full">
              <i class="ph ph-warning"></i>
              {{ 'gift_card.expired' | t }}
            </p>
          {% endif %}

          {% if gift_card.expires_on %}
            {% assign expires_on = gift_card.expires_on | date: '%B %e, %Y' %}
            <p class="mt-3 text-sm text-[--color-text-secondary]">
              {{ 'gift_card.expires_on_html' | t: expires_on: expires_on }}
            </p>
          {% endif %}
        </div>

        {%- comment -%} QR Code {%- endcomment -%}
        {% # theme-check-disable UnknownFilter %}
        <div class="gift-card-animate qr-code mt-8">
          {{ gift_card.qr_code_identifier | qr_code }}
        </div>
        {% # theme-check-enable UnknownFilter %}

        {%- comment -%} Instructions {%- endcomment -%}
        <div class="gift-card-animate mt-8 text-center">
          <p class="text-sm text-[--color-text-secondary]">
            {{ 'gift_card.use_at_checkout' | t }}
          </p>
        </div>

        {%- comment -%} Actions {%- endcomment -%}
        <div class="gift-card-animate mt-8 space-y-3">
          {%- comment -%} Copy Code Button {%- endcomment -%}
          <button
            type="button"
            class="btn btn--primary btn--full"
            data-copy-code="{{ gift_card.code }}"
          >
            <i class="ph ph-copy"></i>
            <span data-copy-text>{{ 'gift_card.copy_code' | t }}</span>
          </button>

          {% if gift_card.pass_url %}
            <a href="{{ gift_card.pass_url }}" class="btn btn--secondary btn--full">
              <i class="ph ph-wallet"></i>
              <span>{{ 'gift_card.add_to_apple_wallet' | t }}</span>
            </a>
          {% endif %}

          <a href="{{ shop.url }}" class="btn btn--secondary btn--full">
            <i class="ph ph-storefront"></i>
            <span>{{ 'general.shop_now' | t }}</span>
          </a>
        </div>

        {%- comment -%} Footer {%- endcomment -%}
        <div class="gift-card-animate mt-12 pt-8 border-t border-[--color-border] text-center">
          <p class="text-xs text-[--color-text-secondary]">
            {{ 'gift_card.print_hint' | t }}
          </p>
        </div>
      </div>
    </div>

    <script>
    (function() {
      // Animate in
      const wrapper = document.querySelector('[data-gift-card-wrapper]');
      if (wrapper) {
        setTimeout(() => wrapper.classList.remove('is-loading'), 100);
        setTimeout(() => wrapper.classList.add('is-ready'), 150);
      }

      // Copy code functionality
      const copyBtn = document.querySelector('[data-copy-code]');
      if (copyBtn) {
        copyBtn.addEventListener('click', async function() {
          const code = this.dataset.copyCode;
          const textEl = this.querySelector('[data-copy-text]');
          const iconEl = this.querySelector('i');
          const originalText = textEl.textContent;

          try {
            await navigator.clipboard.writeText(code);
            textEl.textContent = '{{ 'gift_card.copied' | t }}';
            iconEl.className = 'ph ph-check';

            setTimeout(() => {
              textEl.textContent = originalText;
              iconEl.className = 'ph ph-copy';
            }, 2000);
          } catch (err) {
            // Fallback for older browsers
            const textarea = document.createElement('textarea');
            textarea.value = code;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            textEl.textContent = '{{ 'gift_card.copied' | t }}';
            iconEl.className = 'ph ph-check';

            setTimeout(() => {
              textEl.textContent = originalText;
              iconEl.className = 'ph ph-copy';
            }, 2000);
          }
        });
      }
    })();
    </script>
  </body>
</html>
