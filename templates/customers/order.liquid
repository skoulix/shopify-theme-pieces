{%- comment -%}
  Customer Order Details Page
  Shows full order information
{%- endcomment -%}

<style>

  .customer-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    border-radius: 9999px;
  }

  .customer-status-badge--success {
    background-color: rgba(34, 197, 94, 0.1);
    color: #16a34a;
  }

  .customer-status-badge--warning {
    background-color: rgba(234, 179, 8, 0.1);
    color: #ca8a04;
  }

  .customer-status-badge--neutral {
    background-color: var(--color-background-secondary);
    color: var(--color-text-secondary);
  }

  .customer-status-badge--error {
    background-color: rgba(239, 68, 68, 0.1);
    color: #dc2626;
  }

  .customer-order-table {
    width: 100%;
  }

  .customer-order-table thead {
    background-color: var(--color-background-secondary);
    font-size: 0.875rem;
  }

  .customer-order-table th {
    padding: 1rem;
    font-weight: 500;
    text-align: left;
  }

  .customer-order-table th:last-child {
    text-align: right;
  }

  .customer-order-table tbody {
    divide-y: 1px solid var(--color-border);
  }

  .customer-order-table td {
    padding: 1rem;
    vertical-align: top;
  }

  .customer-order-card {
    border: 1px solid var(--color-border);
    border-radius: var(--card-radius);
    padding: 1.25rem;
  }

  .customer-order-card__title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }
</style>

<div class="page-container page-padding">
  {%- comment -%} Back Link {%- endcomment -%}
  {%- capture back_text -%}{{ 'customers.account.return' | t }}{%- endcapture -%}
  <a href="{{ routes.account_url }}" class="text-hover-reveal inline-flex items-center gap-2 text-xs font-semibold tracking-widest text-(--color-text-secondary) mb-8" data-no-swup>
    <i class="ph ph-arrow-left" aria-hidden="true"></i>
    <span data-hover="{{ back_text }}">{{ back_text }}</span>
  </a>

  {%- comment -%} Order Header {%- endcomment -%}
  <header class="mb-10" data-tween-group="customer-order" data-tween-start="top bottom">
    <h1 class="page-title mb-3" data-tween data-tween-type="split-text">
      {{ 'customers.order.title' | t: name: order.name }}
    </h1>
    <p class="text-(--color-text-secondary)" data-tween data-tween-type="fade-up">
      {{ 'customers.order.date_html' | t: date: order.created_at | date: format: 'date' }}
    </p>
  </header>

  {%- comment -%} Order Status {%- endcomment -%}
  <div class="flex flex-wrap gap-3 mb-10" data-tween data-tween-type="fade-up" data-tween-start="top bottom">
    <span class="customer-status-badge
      {% if order.financial_status == 'paid' %}
        customer-status-badge--success
      {% elsif order.financial_status == 'pending' %}
        customer-status-badge--warning
      {% else %}
        customer-status-badge--neutral
      {% endif %}
    ">
      {{ order.financial_status_label }}
    </span>
    <span class="customer-status-badge
      {% if order.fulfillment_status == 'fulfilled' %}
        customer-status-badge--success
      {% elsif order.fulfillment_status == 'partial' %}
        customer-status-badge--warning
      {% else %}
        customer-status-badge--neutral
      {% endif %}
    ">
      {{ order.fulfillment_status_label }}
    </span>
    {% if order.cancelled %}
      <span class="customer-status-badge customer-status-badge--error">
        {{ 'customers.order.cancelled_on' | t: date: order.cancelled_at | date: format: 'date' }}
      </span>
    {% endif %}
  </div>

  <div class="grid lg:grid-cols-3 gap-8" data-tween data-tween-type="fade-up" data-tween-start="top bottom">
    {%- comment -%} Order Items {%- endcomment -%}
    <div class="lg:col-span-2">
      <div class="border border-(--color-border) rounded-lg overflow-hidden">
        <table class="customer-order-table">
          <thead>
            <tr>
              <th>{{ 'customers.order.product' | t }}</th>
              <th class="text-center hidden sm:table-cell">{{ 'customers.order.quantity' | t }}</th>
              <th class="text-right">{{ 'customers.order.total' | t }}</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-(--color-border)">
            {% for line_item in order.line_items %}
              <tr>
                <td>
                  <div class="flex gap-4">
                    {% if line_item.image %}
                      <img
                        src="{{ line_item.image | image_url: width: 120 }}"
                        alt="{{ line_item.title | escape }}"
                        width="60"
                        height="60"
                        class="w-15 h-15 object-cover rounded border border-(--color-border)"
                        loading="lazy"
                      >
                    {% endif %}
                    <div>
                      <p class="font-medium">
                        {% if line_item.url != blank %}
                          <a href="{{ line_item.url }}" class="hover:text-(--color-primary) transition-colors">
                            {{ line_item.product.title }}
                          </a>
                        {% else %}
                          {{ line_item.title }}
                        {% endif %}
                      </p>
                      {% if line_item.variant.title != 'Default Title' %}
                        <p class="text-sm text-(--color-text-secondary)">{{ line_item.variant.title }}</p>
                      {% endif %}
                      {% if line_item.selling_plan_allocation %}
                        <p class="text-sm text-(--color-text-secondary)">{{ line_item.selling_plan_allocation.selling_plan.name }}</p>
                      {% endif %}
                      <p class="text-sm text-(--color-text-secondary) sm:hidden">{{ 'customers.order.quantity' | t }}: {{ line_item.quantity }}</p>
                      {% if line_item.line_level_discount_allocations.size > 0 %}
                        {% for discount in line_item.line_level_discount_allocations %}
                          <p class="text-sm text-(--color-sale)">
                            <i class="ph ph-tag"></i> {{ discount.discount_application.title }} (-{{ discount.amount | money }})
                          </p>
                        {% endfor %}
                      {% endif %}
                    </div>
                  </div>
                </td>
                <td class="text-center hidden sm:table-cell">{{ line_item.quantity }}</td>
                <td class="text-right">
                  {% if line_item.original_line_price != line_item.final_line_price %}
                    <s class="text-(--color-text-secondary)">{{ line_item.original_line_price | money }}</s>
                    <br>
                  {% endif %}
                  {{ line_item.final_line_price | money }}
                  {%- if line_item.unit_price_measurement -%}
                    <p class="text-xs text-(--color-text-secondary) mt-1">
                      {{ line_item.unit_price | money }}/{{ line_item.unit_price_measurement.reference_value }}{{ line_item.unit_price_measurement.reference_unit }}
                    </p>
                  {%- endif -%}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {%- comment -%} Fulfillment Info {%- endcomment -%}
      {% for line_item in order.line_items %}
        {% if line_item.fulfillment %}
          <div class="mt-4 p-4 border border-(--color-border) rounded-lg">
            <p class="font-medium mb-2">
              {{ 'customers.order.fulfilled_at_html' | t: date: line_item.fulfillment.created_at | date: format: 'date' }}
            </p>
            {% if line_item.fulfillment.tracking_url %}
              <a href="{{ line_item.fulfillment.tracking_url }}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 text-sm text-(--color-primary) hover:underline">
                <i class="ph ph-truck"></i>
                {{ 'customers.order.track_shipment' | t }}
                {% if line_item.fulfillment.tracking_number %}
                  ({{ line_item.fulfillment.tracking_number }})
                {% endif %}
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    {%- comment -%} Order Summary Sidebar {%- endcomment -%}
    <div class="lg:col-span-1 space-y-6">
      {%- comment -%} Totals {%- endcomment -%}
      <div class="customer-order-card">
        <h3 class="customer-order-card__title">{{ 'customers.order.order_summary' | t }}</h3>
        <dl class="space-y-2 text-sm">
          <div class="flex justify-between">
            <dt>{{ 'customers.order.subtotal' | t }}</dt>
            <dd>{{ order.line_items_subtotal_price | money }}</dd>
          </div>

          {% for discount in order.cart_level_discount_applications %}
            <div class="flex justify-between text-(--color-sale)">
              <dt><i class="ph ph-tag"></i> {{ discount.title }}</dt>
              <dd>-{{ discount.total_allocated_amount | money }}</dd>
            </div>
          {% endfor %}

          {% for shipping_method in order.shipping_methods %}
            <div class="flex justify-between">
              <dt>{{ 'customers.order.shipping' | t }} ({{ shipping_method.title }})</dt>
              <dd>{{ shipping_method.price | money }}</dd>
            </div>
          {% endfor %}

          {% for tax_line in order.tax_lines %}
            <div class="flex justify-between">
              <dt>{{ tax_line.title }} ({{ tax_line.rate_percentage }}%)</dt>
              <dd>{{ tax_line.price | money }}</dd>
            </div>
          {% endfor %}

          <div class="flex justify-between pt-2 border-t border-(--color-border) font-semibold text-base">
            <dt>{{ 'customers.order.total' | t }}</dt>
            <dd>{{ order.total_price | money }}</dd>
          </div>
        </dl>
      </div>

      {%- comment -%} Shipping Address {%- endcomment -%}
      <div class="customer-order-card">
        <h3 class="customer-order-card__title">{{ 'customers.order.shipping_address' | t }}</h3>
        <address class="text-sm text-(--color-text-secondary) not-italic">
          {{ order.shipping_address | format_address }}
        </address>
      </div>

      {%- comment -%} Billing Address {%- endcomment -%}
      <div class="customer-order-card">
        <h3 class="customer-order-card__title">{{ 'customers.order.billing_address' | t }}</h3>
        <address class="text-sm text-(--color-text-secondary) not-italic">
          {{ order.billing_address | format_address }}
        </address>
      </div>
    </div>
  </div>
</div>
