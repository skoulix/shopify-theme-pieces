/* ==========================================================================
   Navigation - Mobile drawer and desktop dropdowns
   ========================================================================== */

@layer components {
  /* ==========================================================================
     Header Icon - Reusable icon button/link styling for header
     Used for: search, account, wishlist, cart icons
     ========================================================================== */

  .header-icon {
    @apply p-2 flex items-center transition-colors cursor-pointer;
    color: var(--color-text-secondary) !important;
  }

  .header-icon:hover {
    color: var(--color-text) !important;
  }

  .header-icon i {
    @apply text-xl;
  }

  /* ==========================================================================
     Desktop Nav Link - Expanding underline hover effect
     ========================================================================== */

  .nav-link {
    @apply relative text-sm font-semibold leading-6 transition-colors;
    color: var(--color-text);
  }

  .nav-link:hover {
    color: var(--color-primary);
  }

  .nav-link__text {
    position: relative;
    display: inline-block;
  }

  .nav-link__text::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 100%;
    height: 2px;
    background-color: currentColor;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease-out;
  }

  .nav-link:hover .nav-link__text::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  .nav-link.is-active .nav-link__text::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  /* Mobile Nav */
  .mobile-nav.is-open {
    @apply pointer-events-auto visible;
  }

  .mobile-nav__drawer {
    @apply will-change-transform;
    clip-path: inset(0 0 100% 0);
  }

  .mobile-nav.is-open .mobile-nav__drawer {
    clip-path: inset(0 0 0 0);
  }

  .mobile-nav__link {
    @apply py-3 font-heading text-(--color-text) leading-snug;
    font-size: calc(clamp(2.25rem, 6vw, 3rem) * var(--heading-font-scale, 1));
    font-weight: var(--font-heading-weight, 700);
    letter-spacing: calc(-0.02em + var(--heading-letter-spacing, 0em));
    transition: color var(--transition-base);
  }

  .mobile-nav__link:hover,
  .mobile-nav__link.is-active {
    @apply text-(--color-primary);
  }

  .mobile-nav-char {
    @apply inline-block;
  }

  .mobile-nav__link-line {
    @apply absolute left-0 bottom-2 w-full h-0.5 bg-current;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform var(--transition-base);
  }

  .mobile-nav__link:hover .mobile-nav__link-line {
    transform: scaleX(1);
    transform-origin: left;
  }

  .mobile-nav__toggle-icon {
    @apply text-2xl;
    transition: transform var(--transition-base);
  }

  .mobile-nav__link--parent[aria-expanded='true'] .mobile-nav__toggle-icon {
    @apply rotate-45;
  }

  .mobile-nav__submenu {
    grid-template-rows: 0fr;
    transition: grid-template-rows var(--transition-slow);
  }

  .mobile-nav__submenu.is-open {
    grid-template-rows: 1fr;
  }

  .mobile-nav__submenu-link {
    @apply py-2.5 font-body;
    font-size: calc(1.125rem * var(--body-font-scale, 1));
  }

  /* Sliding Panels */
  .mobile-nav--slide .mobile-nav__panel {
    @apply absolute top-0 left-0 w-full h-full flex flex-col will-change-transform
           bg-(--color-background) translate-x-full;
    transition: transform var(--transition-base);
  }

  .mobile-nav--slide .mobile-nav__panel--main {
    @apply relative translate-x-0;
  }

  .mobile-nav--slide .mobile-nav__panel.is-active {
    @apply translate-x-0;
  }

  .mobile-nav--slide .mobile-nav__panel--main.is-hidden,
  .mobile-nav--slide .mobile-nav__panel.is-hidden {
    @apply -translate-x-1/3;
  }

  .mobile-nav__panel-title {
    @apply font-heading leading-snug;
    font-size: calc(clamp(1.5rem, 4vw, 1.875rem) * var(--heading-font-scale, 1));
    font-weight: var(--font-heading-weight, 700);
    letter-spacing: calc(-0.02em + var(--heading-letter-spacing, 0em));
  }

  .mobile-nav--slide .mobile-nav__link {
    font-size: calc(clamp(1.875rem, 5vw, 2.25rem) * var(--heading-font-scale, 1));
  }

  .mobile-nav--slide .mobile-nav__panel[data-panel-level='2'] .mobile-nav__link:not(.mobile-nav__link--view-all),
  .mobile-nav--slide .mobile-nav__panel[data-panel-level='3'] .mobile-nav__link:not(.mobile-nav__link--view-all) {
    @apply font-body font-medium;
    font-size: calc(1.25rem * var(--body-font-scale, 1));
    letter-spacing: 0;
  }

  /* Desktop Dropdowns */
  .dropdown-wrapper {
    @apply relative;
  }

  .dropdown-panel {
    @apply absolute left-1/2 -translate-x-1/2 opacity-0 invisible pointer-events-none
           top-full min-w-60 pt-3 z-50 transition-[opacity,visibility] duration-200;
  }

  .dropdown-wrapper.is-open .dropdown-panel {
    @apply opacity-100 visible pointer-events-auto;
  }

  .dropdown-panel__inner {
    @apply p-6 opacity-0 -translate-y-2 bg-(--color-background)
           border border-(--color-border) rounded-lg shadow-xl
           transition-[opacity,transform] duration-200;
  }

  .dropdown-wrapper.is-open .dropdown-panel__inner {
    @apply opacity-100 translate-y-0;
  }

  .dropdown-featured {
    @apply flex flex-col p-4 no-underline opacity-0 translate-y-2
           -mx-2 -mt-2 mb-4 bg-(--color-background-secondary) rounded-md
           text-(--color-text) transition-all duration-300;
  }

  .dropdown-wrapper.is-open .dropdown-featured {
    @apply opacity-100 translate-y-0 delay-150;
  }

  .dropdown-featured:hover {
    @apply bg-(--color-border);
  }

  .dropdown-featured__label {
    @apply text-xs font-semibold mb-1 tracking-widest text-(--color-text-secondary);
  }

  .dropdown-featured__title {
    @apply font-heading leading-snug;
    font-size: calc(1.125rem * var(--heading-font-scale, 1));
    font-weight: var(--font-heading-weight, 700);
    letter-spacing: calc(-0.01em + var(--heading-letter-spacing, 0em));
  }

  .dropdown-featured__arrow {
    @apply absolute right-4 top-1/2 -translate-y-1/2 opacity-0 text-base transition-all duration-200;
  }

  .dropdown-featured:hover .dropdown-featured__arrow {
    @apply opacity-100 translate-x-1;
  }

  .dropdown-links {
    @apply flex flex-col gap-1;
  }

  .dropdown-link {
    @apply relative block py-2 text-sm font-medium no-underline opacity-0 translate-y-2
           text-(--color-text) transition-all duration-200;
  }

  .dropdown-wrapper.is-open .dropdown-link {
    @apply opacity-100 translate-y-0;
    transition-delay: calc(0.2s + (var(--item-index, 0) * 0.05s));
  }

  .dropdown-link:hover {
    @apply text-(--color-primary);
  }

  .dropdown-link__text {
    @apply relative z-10;
  }

  .dropdown-link__line {
    @apply absolute left-0 bottom-1 w-full h-px bg-current scale-x-0 origin-right transition-transform duration-200;
  }

  .dropdown-link:hover .dropdown-link__line {
    @apply scale-x-100 origin-left;
  }

  /* Nested Flyout */
  .dropdown-link-wrapper {
    @apply relative;
  }

  .dropdown-link--parent {
    @apply flex items-center justify-between w-full bg-transparent border-none cursor-pointer text-left;
  }

  .dropdown-link__arrow {
    @apply text-xs opacity-50 transition-all duration-150;
  }

  .dropdown-link-wrapper:hover .dropdown-link__arrow,
  .dropdown-link-wrapper.is-open .dropdown-link__arrow {
    @apply opacity-100 translate-x-0.5;
  }

  .dropdown-submenu {
    @apply absolute opacity-0 invisible pointer-events-none
           -top-2 left-full pl-2 min-w-48 z-50 transition-[opacity,visibility] duration-150;
  }

  .dropdown-link-wrapper:hover .dropdown-submenu,
  .dropdown-link-wrapper.is-open .dropdown-submenu {
    @apply opacity-100 visible pointer-events-auto;
  }

  .dropdown-submenu__inner {
    @apply p-4 bg-(--color-background) border border-(--color-border)
           rounded-lg shadow-lg -translate-x-2 transition-transform duration-150;
  }

  .dropdown-link-wrapper:hover .dropdown-submenu__inner,
  .dropdown-link-wrapper.is-open .dropdown-submenu__inner {
    @apply translate-x-0;
  }

  .dropdown-submenu__header {
    @apply flex items-center justify-between gap-4 no-underline font-semibold
           py-2.5 px-3 -mx-1 -mt-1 mb-2 bg-(--color-background-secondary)
           rounded-md text-(--color-text) text-base transition-colors duration-150;
  }

  .dropdown-submenu__header:hover {
    @apply bg-(--color-border);
  }

  .dropdown-submenu__header i {
    @apply text-sm opacity-0 -translate-x-1 transition-all duration-150;
  }

  .dropdown-submenu__header:hover i {
    @apply opacity-100 translate-x-0;
  }

  .dropdown-submenu__links {
    @apply flex flex-col gap-0.5;
  }

  .dropdown-submenu__link {
    @apply block font-medium no-underline opacity-0 py-1.5 -translate-x-1.5
           text-base text-(--color-text) transition-all duration-150;
  }

  .dropdown-link-wrapper:hover .dropdown-submenu__link,
  .dropdown-link-wrapper.is-open .dropdown-submenu__link {
    @apply opacity-100 translate-x-0;
    transition-delay: calc(0.05s + (var(--subitem-index, 0) * 0.03s));
  }

  .dropdown-submenu__link:hover {
    @apply text-(--color-primary);
  }

  /* Transparent header */
  .header-group.is-transparent:not(.is-scrolled) .dropdown-panel__inner,
  .header-group.is-transparent:not(.is-scrolled) .dropdown-submenu__inner {
    @apply bg-(--color-background) text-(--color-text);
  }

  .header-group.is-transparent:not(.is-scrolled) .dropdown-link,
  .header-group.is-transparent:not(.is-scrolled) .dropdown-featured,
  .header-group.is-transparent:not(.is-scrolled) .dropdown-submenu__link,
  .header-group.is-transparent:not(.is-scrolled) .dropdown-submenu__header {
    @apply text-(--color-text);
  }
}
