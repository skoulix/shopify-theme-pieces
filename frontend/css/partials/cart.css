/* ==========================================================================
   Cart Drawer - Slide-out panel from right
   Uses GSAP for animations when available, CSS fallback otherwise
   ========================================================================== */

@layer components {
  .cart-drawer {
    @apply fixed inset-0 pointer-events-none invisible;
    z-index: var(--z-drawer);
  }

  .cart-drawer.is-open {
    @apply pointer-events-auto visible;
  }

  /* Loading state */
  .cart-drawer.is-loading,
  .cart-drawer.is-updating {
    @apply cursor-wait;
  }

  .cart-drawer.is-loading *,
  .cart-drawer.is-updating * {
    cursor: wait !important;
  }

  .cart-drawer.is-loading .cart-drawer__content,
  .cart-drawer.is-updating .cart-drawer__content {
    @apply pointer-events-none;
    opacity: var(--opacity-disabled);
  }

  /* Panel - Slides from right */
  .cart-drawer__panel {
    @apply absolute top-0 right-0 w-full h-full flex flex-col will-change-transform;
    max-width: 420px;
    background: var(--color-background);
    transform: translateX(100%);
    box-shadow: var(--shadow-drawer);
    border-left: 1px solid var(--color-border);
  }

  /* Header */
  .cart-drawer__header {
    @apply flex items-center gap-3 py-5 px-6;
    border-bottom: 1px solid var(--color-border);
  }

  .cart-drawer__title {
    @apply flex-1 text-xl m-0;
    font-weight: var(--font-heading-weight, 500);
  }

  .cart-drawer__count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-2 text-xs font-semibold rounded-full;
    background: var(--color-primary);
    color: var(--color-primary-contrast);
  }

  .cart-drawer__close {
    @apply flex items-center justify-center size-10 -m-2 ml-auto bg-transparent border-none cursor-pointer;
    color: var(--color-text);
    transition: opacity var(--transition-sm);
  }

  .cart-drawer__close:hover {
    opacity: var(--opacity-secondary);
  }

  .cart-drawer__close i {
    @apply text-xl;
  }

  /* Content */
  .cart-drawer__content {
    @apply flex-1 overflow-y-auto p-6;
    transition: opacity var(--transition-sm);
  }

  /* Items list */
  .cart-drawer__items {
    @apply list-none m-0 p-0 flex flex-col gap-6;
  }

  /* Single item */
  .cart-drawer__item {
    @apply grid gap-4 pb-6;
    grid-template-columns: 80px 1fr;
    border-bottom: 1px solid var(--color-border);
  }

  .cart-drawer__item:last-child {
    @apply pb-0 border-b-0;
  }

  .cart-drawer__item-image {
    @apply aspect-square overflow-hidden;
    background: var(--color-background-secondary, #f5f5f5);
  }

  .cart-drawer__item-image img {
    @apply w-full h-full object-cover;
  }

  .cart-drawer__item-details {
    @apply flex flex-col gap-1;
  }

  .cart-drawer__item-title {
    @apply text-sm font-medium no-underline leading-normal;
    color: var(--color-text);
  }

  .cart-drawer__item-title:hover {
    color: var(--color-primary);
  }

  .cart-drawer__item-variant {
    @apply text-xs m-0;
    color: var(--color-text-secondary);
  }

  .cart-drawer__item-price {
    @apply text-sm font-medium mt-1;
  }

  .cart-drawer__item-price--compare {
    @apply line-through mr-2;
    color: var(--color-text-secondary);
  }

  .cart-drawer__item-price .sale-price {
    color: var(--color-sale, #dc2626);
  }

  .cart-drawer__item-actions {
    @apply flex items-center gap-3 mt-auto pt-2;
  }

  /* Quantity controls */
  .cart-drawer__quantity {
    @apply inline-flex items-center h-8 p-0 relative;
    background: var(--color-background);
    border-radius: var(--input-radius);
    border-width: var(--input-border-width) !important;
    border-style: solid !important;
    border-color: var(--color-border) !important;
    box-shadow: var(--input-shadow) !important;
  }

  .cart-drawer__quantity-btn {
    @apply size-8 flex items-center justify-center bg-transparent border-none cursor-pointer;
    color: var(--color-text);
    transition: all var(--transition-base);
  }

  .cart-drawer__quantity-btn:hover {
    background: var(--color-primary);
    color: var(--color-primary-contrast);
  }

  .cart-drawer__quantity-btn:active {
    @apply scale-95;
  }

  .cart-drawer__quantity-btn i {
    @apply text-xs;
  }

  .cart-drawer__quantity-value {
    @apply w-10 h-8 flex items-center justify-center;
  }

  .cart-drawer__quantity-input {
    @apply w-full h-full text-center text-sm font-semibold bg-transparent outline-none;
    border: none !important;
    border-width: 0 !important;
    box-shadow: none !important;
    color: var(--color-text);
    -moz-appearance: textfield;
  }

  .cart-drawer__quantity-input::-webkit-outer-spin-button,
  .cart-drawer__quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .cart-drawer__quantity-input:focus {
    @apply outline-none;
    border: none !important;
  }

  .cart-drawer__quantity:focus-within {
    border-color: var(--color-primary);
    box-shadow: var(--input-shadow-focus);
  }

  .cart-drawer__quantity.is-changing .cart-drawer__quantity-input {
    animation: drawerQuantityPop var(--transition-base);
  }

  @keyframes drawerQuantityPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  /* Remove button */
  .cart-drawer__remove {
    @apply flex items-center justify-center size-8 bg-transparent border-none cursor-pointer;
    color: var(--color-text-secondary);
    transition: color var(--transition-sm);
  }

  .cart-drawer__remove:hover {
    color: var(--color-sale, #dc2626);
  }

  .cart-drawer__remove i {
    @apply text-base;
  }

  /* Empty state */
  .cart-drawer__empty {
    @apply flex flex-col items-center justify-center text-center py-8 px-6 gap-3 h-full;
  }

  .cart-drawer__empty p {
    @apply m-0 text-sm;
    color: var(--color-text-secondary);
  }

  .cart-drawer__empty .btn {
    @apply mt-2;
  }

  /* Footer */
  .cart-drawer__footer {
    @apply p-6;
    border-top: 1px solid var(--color-border);
    background: var(--color-background);
  }

  /* Cart note */
  .cart-drawer__note-wrapper {
    @apply mb-4;
  }

  .cart-drawer__note-toggle {
    @apply flex items-center justify-between w-full py-3 text-xs font-semibold tracking-wide uppercase cursor-pointer;
    color: var(--color-text-secondary);
    transition: color var(--transition-sm);
  }

  .cart-drawer__note-toggle:hover {
    color: var(--color-text);
  }

  .cart-drawer__note-toggle i {
    @apply text-base;
    transition: transform var(--transition-sm);
  }

  .cart-drawer__note-wrapper[open] .cart-drawer__note-toggle i {
    @apply rotate-180;
  }

  .cart-drawer__note-content {
    @apply pb-4;
  }

  .cart-drawer__note-input {
    @apply w-full min-h-20 p-3 text-sm bg-transparent resize-y;
    border: 1px solid var(--color-border);
    color: var(--color-text);
  }

  .cart-drawer__note-input:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: -2px;
  }

  /* Subtotal */
  .cart-drawer__subtotal {
    @apply flex justify-between items-center text-base font-semibold mb-2;
  }

  .cart-drawer__tax-note {
    @apply text-xs m-0 mb-4;
    color: var(--color-text-secondary);
  }

  /* Actions */
  .cart-drawer__actions {
    @apply flex flex-col gap-3;
  }

  .cart-drawer__actions form {
    @apply m-0;
  }

  /* ==========================================================================
     Cart Notification - Mini popup from top
     ========================================================================== */

  .cart-notification {
    @apply fixed top-4 right-4 left-4 flex justify-end pointer-events-none invisible sm:left-auto sm:w-96;
    z-index: var(--z-drawer);
  }

  .cart-notification.is-visible {
    @apply pointer-events-auto visible;
  }

  .cart-notification__content {
    @apply relative w-full p-4 opacity-0;
    background: var(--color-background);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-dropdown);
  }

  .cart-notification.is-visible .cart-notification__content {
    @apply opacity-100;
  }

  /* Product info */
  .cart-notification__product {
    @apply grid gap-4 mb-4;
    grid-template-columns: 60px 1fr;
  }

  .cart-notification__image {
    @apply aspect-square overflow-hidden;
    background: var(--color-background-secondary, #f5f5f5);
  }

  .cart-notification__image img {
    @apply w-full h-full object-cover;
  }

  .cart-notification__details {
    @apply flex flex-col gap-1;
  }

  .cart-notification__message {
    @apply flex items-center gap-2 text-xs font-semibold m-0;
    color: var(--color-success, #16a34a);
  }

  .cart-notification__message i {
    @apply text-base;
  }

  .cart-notification__title {
    @apply text-sm font-medium m-0 leading-normal;
    color: var(--color-text);
  }

  .cart-notification__variant {
    @apply text-xs m-0;
    color: var(--color-text-secondary);
  }

  /* Actions */
  .cart-notification__actions {
    @apply flex flex-col gap-2;
  }

  .cart-notification__actions form {
    @apply m-0;
  }

  /* Close button */
  .cart-notification__close {
    @apply absolute top-2 right-2 flex items-center justify-center size-8 bg-transparent border-none cursor-pointer;
    color: var(--color-text-secondary);
    transition: color var(--transition-sm);
  }

  .cart-notification__close:hover {
    color: var(--color-text);
  }

  .cart-notification__close i {
    @apply text-base;
  }
}
