import{P as c}from"./pieces-Piece.js";import{t as n,r as d}from"./pieces-app.js";class u extends c{constructor(){super("PickupAvailability",{stylesheets:[]}),this.errorHtml=null}mount(){if(!this.hasAttribute("available"))return;const t=this.$("template")[0];t&&(this.errorHtml=t.content.firstElementChild.cloneNode(!0)),this.fetchAvailability(this.dataset.variantId)}fetchAvailability(t){if(!t)return;let e=this.dataset.rootUrl||"";e.endsWith("/")||(e=e+"/");const o=`${e}variants/${t}/?section_id=pickup-availability`;fetch(o).then(i=>i.text()).then(i=>{const r=new DOMParser().parseFromString(i,"text/html").querySelector(".shopify-section");this.renderPreview(r)}).catch(()=>{this.renderError()})}update(t){t!=null&&t.available?this.fetchAvailability(t.id):(this.removeAttribute("available"),this.innerHTML="")}renderError(){if(this.innerHTML="",this.errorHtml){this.appendChild(this.errorHtml);const t=this.$("button")[0];t&&this.on("click",t,()=>this.fetchAvailability(this.dataset.variantId))}}renderPreview(t){var l;const e=document.querySelector("pickup-availability-drawer");e&&e.remove();const o=t==null?void 0:t.querySelector("pickup-availability-preview");if(!o){this.innerHTML="",this.removeAttribute("available");return}this.innerHTML=o.outerHTML,this.setAttribute("available","");const i=t.querySelector("pickup-availability-drawer");i&&((((l=this.dataset.productPageColorScheme)==null?void 0:l.split(" "))||[]).forEach(s=>{s&&i.classList.add(s)}),document.body.appendChild(i));const r=this.$("button")[0];r&&this.on("click",r,a=>{const s=document.querySelector("pickup-availability-drawer");s&&s.show(a.target)})}}class p extends c{constructor(){super("PickupDrawer",{stylesheets:[]}),this.focusElement=null,this.boundBodyClick=this.handleBodyClick.bind(this)}mount(){this.$closeButton=this.$("button")[0],this.$closeButton&&this.on("click",this.$closeButton,this.hide),this.on("keyup",this,this.onKeyUp)}unmount(){this.$closeButton&&this.off("click",this.$closeButton,this.hide),this.off("keyup",this,this.onKeyUp),document.body.removeEventListener("click",this.boundBodyClick)}onKeyUp(t){t.code==="Escape"&&this.hide()}handleBodyClick(t){const e=t.target;e!==this&&!e.closest("pickup-availability-drawer")&&e.id!=="ShowPickupAvailabilityDrawer"&&this.hide()}show(t){this.focusElement=t,this.setAttribute("open",""),document.body.addEventListener("click",this.boundBodyClick),document.body.classList.add("overflow-hidden"),n(this)}hide(){this.removeAttribute("open"),document.body.removeEventListener("click",this.boundBodyClick),document.body.classList.remove("overflow-hidden"),d(this.focusElement)}}customElements.define("pickup-availability",u);customElements.define("pickup-availability-drawer",p);export{u as PickupAvailability,p as PickupDrawer,u as default};
//# sourceMappingURL=pieces-PickupAvailability.js.map
