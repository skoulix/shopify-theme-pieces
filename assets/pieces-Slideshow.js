import{P as h}from"./pieces-Piece.js";import"./pieces-app.js";class o extends h{constructor(){super("Slideshow",{stylesheets:[]}),this.currentPage=1,this.totalPages=1,this.sliderItemOffset=0,this.autoplaySpeed=5e3,this.autoplayInterval=null,this.isPlaying=!1,this.reducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)")}mount(){this.$slider=this.$("[data-slider-track]")[0]||this.$('[id^="Slider-"]')[0],this.$items=this.$$("[data-slider-item]").length?this.$$("[data-slider-item]"):this.$$('[id^="Slide-"]'),this.$prevButton=this.$("[data-slider-prev]")[0]||this.$('button[name="previous"]')[0],this.$nextButton=this.$("[data-slider-next]")[0]||this.$('button[name="next"]')[0],this.$dots=this.$$("[data-slider-dot]")||this.$$(".slider-counter__link"),this.$autoplayButton=this.$("[data-autoplay-toggle]")[0]||this.$(".slideshow__autoplay")[0],this.$currentPage=this.$("[data-slider-current]")[0]||this.$(".slider-counter--current")[0],this.$totalPages=this.$("[data-slider-total]")[0]||this.$(".slider-counter--total")[0],!(!this.$slider||!this.$items.length)&&(this.autoplaySpeed=(parseInt(this.$slider.dataset.speed)||5)*1e3,this.enableAutoplay=this.$slider.dataset.autoplay==="true",this.initPages(),this.resizeObserver=new ResizeObserver(()=>this.initPages()),this.resizeObserver.observe(this.$slider),this.on("scroll",this.$slider,this.update),this.$prevButton&&this.on("click",this.$prevButton,this.onPrevClick),this.$nextButton&&this.on("click",this.$nextButton,this.onNextClick),this.$dots.forEach((t,e)=>{this.on("click",t,()=>this.goToSlide(e+1))}),this.$autoplayButton&&this.on("click",this.$autoplayButton,this.toggleAutoplay),this.on("mouseenter",this,this.pause),this.on("mouseleave",this,this.onMouseLeave),this.on("focusin",this,this.pause),this.on("focusout",this,this.onFocusOut),this.setSlideVisibility(),this.enableAutoplay&&!this.reducedMotion.matches&&this.play(),this.reducedMotion.addEventListener("change",this.handleReducedMotionChange.bind(this)))}unmount(){this.pause(),this.resizeObserver&&this.resizeObserver.disconnect(),this.off("scroll",this.$slider,this.update),this.$prevButton&&this.off("click",this.$prevButton,this.onPrevClick),this.$nextButton&&this.off("click",this.$nextButton,this.onNextClick),this.off("mouseenter",this,this.pause),this.off("mouseleave",this,this.onMouseLeave),this.off("focusin",this,this.pause),this.off("focusout",this,this.onFocusOut)}initPages(){this.visibleItems=Array.from(this.$items).filter(t=>t.clientWidth>0),!(this.visibleItems.length<2)&&(this.sliderItemOffset=this.visibleItems[1].offsetLeft-this.visibleItems[0].offsetLeft,this.totalPages=this.visibleItems.length,this.$totalPages&&(this.$totalPages.textContent=this.totalPages),this.update())}update(){if(!this.$slider)return;const t=this.currentPage;this.currentPage=Math.round(this.$slider.scrollLeft/this.sliderItemOffset)+1,this.currentPage=Math.max(1,Math.min(this.currentPage,this.totalPages)),this.$currentPage&&(this.$currentPage.textContent=this.currentPage),this.$dots.forEach((e,i)=>{e.classList.toggle("slider-counter__link--active",i===this.currentPage-1),e.setAttribute("aria-current",i===this.currentPage-1?"true":"false")}),this.setSlideVisibility(),this.currentPage!==t&&this.emit("slideChanged",this,{detail:{currentPage:this.currentPage,currentElement:this.visibleItems[this.currentPage-1]}})}setSlideVisibility(){this.visibleItems.forEach((t,e)=>{const i=e===this.currentPage-1,a=t.querySelectorAll("a, button");t.setAttribute("aria-hidden",i?"false":"true"),i?(t.removeAttribute("tabindex"),a.forEach(s=>s.removeAttribute("tabindex"))):(t.setAttribute("tabindex","-1"),a.forEach(s=>s.setAttribute("tabindex","-1")))})}onPrevClick(t){t.preventDefault();let e=this.currentPage-1;e<1&&(e=this.totalPages),this.goToSlide(e)}onNextClick(t){t.preventDefault();let e=this.currentPage+1;e>this.totalPages&&(e=1),this.goToSlide(e)}goToSlide(t){const e=(t-1)*this.sliderItemOffset;this.$slider.scrollTo({left:e,behavior:this.reducedMotion.matches?"auto":"smooth"})}play(){var t,e;this.isPlaying||(this.isPlaying=!0,(t=this.$slider)==null||t.setAttribute("aria-live","off"),this.autoplayInterval=setInterval(()=>{this.autoRotate()},this.autoplaySpeed),this.$autoplayButton&&(this.$autoplayButton.classList.remove("slideshow__autoplay--paused"),this.$autoplayButton.setAttribute("aria-label",((e=window.accessibilityStrings)==null?void 0:e.pauseSlideshow)||"Pause slideshow")))}pause(){var t,e;this.isPlaying&&(this.isPlaying=!1,(t=this.$slider)==null||t.setAttribute("aria-live","polite"),this.autoplayInterval&&(clearInterval(this.autoplayInterval),this.autoplayInterval=null),this.$autoplayButton&&(this.$autoplayButton.classList.add("slideshow__autoplay--paused"),this.$autoplayButton.setAttribute("aria-label",((e=window.accessibilityStrings)==null?void 0:e.playSlideshow)||"Play slideshow")))}toggleAutoplay(){this.isPlaying?this.pause():this.play()}autoRotate(){let t=this.currentPage+1;t>this.totalPages&&(t=1),this.goToSlide(t)}onMouseLeave(){this.enableAutoplay&&!this.reducedMotion.matches&&this.play()}onFocusOut(t){!this.contains(t.relatedTarget)&&this.enableAutoplay&&!this.reducedMotion.matches&&this.play()}handleReducedMotionChange(){this.reducedMotion.matches?this.pause():this.enableAutoplay&&this.play()}}customElements.define("c-slideshow",o);export{o as default};
//# sourceMappingURL=pieces-Slideshow.js.map
