import{P as f}from"./pieces-Piece.js";import"./pieces-app.js";class $ extends f{constructor(){super("LocalizationForm",{stylesheets:[]}),this.mql=window.matchMedia("(min-width: 750px)")}mount(){this.$header=document.querySelector(".header-wrapper"),this.$input=this.$('input[name="locale_code"], input[name="country_code"]')[0],this.$button=this.$("button.localization-form__select")[0],this.$panel=this.$(".disclosure__list-wrapper")[0],this.$search=this.$('input[name="country_filter"]')[0],this.$closeButton=this.$(".country-selector__close-button")[0],this.$resetButton=this.$(".country-filter__reset-button")[0],this.$searchIcon=this.$(".country-filter__search-icon")[0],this.$liveRegion=this.$("#sr-country-search-results")[0],this.on("keyup",this,this.onContainerKeyUp),this.on("keydown",this,this.onContainerKeyDown),this.on("focusout",this,this.closeSelector),this.$button&&this.on("click",this.$button,this.openSelector),this.$search&&(this.on("keyup",this.$search,this.filterCountries),this.on("focus",this.$search,this.onSearchFocus),this.on("blur",this.$search,this.onSearchBlur),this.on("keydown",this.$search,this.onSearchKeyDown)),this.$closeButton&&this.on("click",this.$closeButton,this.hidePanel),this.$resetButton&&(this.on("click",this.$resetButton,this.resetFilter),this.on("mousedown",this.$resetButton,t=>t.preventDefault())),this.$$("a").forEach(t=>{this.on("click",t,this.onItemClick)})}unmount(){this.off("keyup",this,this.onContainerKeyUp),this.off("keydown",this,this.onContainerKeyDown),this.off("focusout",this,this.closeSelector),this.$button&&this.off("click",this.$button,this.openSelector),this.$search&&(this.off("keyup",this.$search,this.filterCountries),this.off("focus",this.$search,this.onSearchFocus),this.off("blur",this.$search,this.onSearchBlur),this.off("keydown",this.$search,this.onSearchKeyDown)),this.$closeButton&&this.off("click",this.$closeButton,this.hidePanel),this.$resetButton&&this.off("click",this.$resetButton,this.resetFilter),this.$$("a").forEach(t=>{this.off("click",t,this.onItemClick)})}hidePanel(){var t;this.$button&&this.$button.setAttribute("aria-expanded","false"),this.$panel&&this.$panel.setAttribute("hidden",!0),this.$search&&(this.$search.value="",this.filterCountries(),this.$search.setAttribute("aria-activedescendant","")),document.body.classList.remove("overflow-hidden-mobile"),(t=document.querySelector(".menu-drawer"))==null||t.classList.remove("country-selector-open"),this.$header&&(this.$header.preventHide=!1)}onContainerKeyDown(t){const e=Array.from(this.querySelectorAll("a")).filter(o=>!o.parentElement.classList.contains("hidden"));let s=e.findIndex(o=>o===document.activeElement),i;switch(t.code.toUpperCase()){case"ARROWUP":t.preventDefault(),i=s>0?e[s-1]:e[e.length-1],i==null||i.focus();break;case"ARROWDOWN":t.preventDefault(),i=s<e.length-1?e[s+1]:e[0],i==null||i.focus();break}this.$search&&setTimeout(()=>{s=e.findIndex(o=>o===document.activeElement),s>-1?this.$search.setAttribute("aria-activedescendant",e[s].id):this.$search.setAttribute("aria-activedescendant","")})}onContainerKeyUp(t){var e,s,i;switch(t.preventDefault(),t.code.toUpperCase()){case"ESCAPE":if(((e=this.$button)==null?void 0:e.getAttribute("aria-expanded"))==="false")return;this.hidePanel(),t.stopPropagation(),(s=this.$button)==null||s.focus();break;case"SPACE":if(((i=this.$button)==null?void 0:i.getAttribute("aria-expanded"))==="true")return;this.openSelector();break}}onItemClick(t){t.preventDefault();const e=this.$("form")[0];this.$input&&(this.$input.value=t.currentTarget.dataset.value),e&&e.submit()}openSelector(){var t,e,s,i,o;(t=this.$button)==null||t.focus(),(e=this.$panel)==null||e.toggleAttribute("hidden"),(i=this.$button)==null||i.setAttribute("aria-expanded",(((s=this.$button)==null?void 0:s.getAttribute("aria-expanded"))==="false").toString()),document.body.classList.contains("overflow-hidden-tablet")||document.body.classList.add("overflow-hidden-mobile"),this.$search&&this.mql.matches&&this.$search.focus(),this.hasAttribute("data-prevent-hide")&&this.$header&&(this.$header.preventHide=!0),(o=document.querySelector(".menu-drawer"))==null||o.classList.add("country-selector-open")}closeSelector(t){(t.target.classList.contains("country-selector__overlay")||!this.contains(t.target)||!this.contains(t.relatedTarget))&&this.hidePanel()}normalizeString(t){return t.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase()}filterCountries(){var o,h,a,c,l;const t=this.normalizeString(((o=this.$search)==null?void 0:o.value)||""),e=this.$(".popular-countries")[0],s=this.$$("a");let i=s.length;(h=this.$resetButton)==null||h.classList.toggle("hidden",!t),e&&e.classList.toggle("hidden",!!t),s.forEach(r=>{var u,d;const n=r.querySelector(".country");this.normalizeString((n==null?void 0:n.textContent)||"").indexOf(t)>-1?((u=r.parentElement)==null||u.classList.remove("hidden"),i++):((d=r.parentElement)==null||d.classList.add("hidden"),i--)}),this.$liveRegion&&((a=window.accessibilityStrings)!=null&&a.countrySelectorSearchCount)&&(this.$liveRegion.innerHTML=window.accessibilityStrings.countrySelectorSearchCount.replace("[count]",i)),(c=this.$(".country-selector")[0])==null||c.scrollTo(0,0),(l=this.$(".country-selector__list")[0])==null||l.scrollTo(0,0)}resetFilter(t){var e;t.stopPropagation(),this.$search&&(this.$search.value=""),this.filterCountries(),(e=this.$search)==null||e.focus()}onSearchFocus(){var t;(t=this.$searchIcon)==null||t.classList.add("country-filter__search-icon--hidden")}onSearchBlur(){var t,e;(t=this.$search)!=null&&t.value||(e=this.$searchIcon)==null||e.classList.remove("country-filter__search-icon--hidden")}onSearchKeyDown(t){t.code.toUpperCase()==="ENTER"&&t.preventDefault()}}customElements.define("localization-form",$);export{$ as default};
//# sourceMappingURL=pieces-LocalizationForm.js.map
