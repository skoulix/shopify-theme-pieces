{%- comment -%}
  Image with Text Section - Modern split layout with parallax and reveal animations
{%- endcomment -%}

{%- liquid
  if section.settings.full_width
    if section.settings.layout == 'image_left'
      assign container_class = 'lg:pr-[--page-padding]'
    else
      assign container_class = 'lg:pl-[--page-padding]'
    endif
    assign content_class = 'page-full lg:px-0'
  else
    assign container_class = 'page-container'
    assign content_class = ''
  endif
-%}

<style>
  /* ==========================================================================
     Image with Text Section - Custom CSS for Liquid values & clamp()
     ========================================================================== */

  /* Section padding - requires Liquid conditionals and clamp() */
  .iwt-section {
    {% if section.settings.remove_padding %}
    padding: 0 0 clamp(2rem, 5vh, 4rem) 0;
    {% else %}
    padding: clamp(4rem, 10vh, 8rem) 0;
    {% endif %}
    background-color: {{ section.settings.background_color }};
  }

  @media (min-width: 1024px) {
    .iwt-section {
      {% if section.settings.remove_padding %}
      padding: 0;
      {% endif %}
    }

    /* Layout direction for image_right - requires data attribute */
    .iwt-section[data-layout="image_right"] .iwt-container {
      direction: rtl;
    }

    .iwt-section[data-layout="image_right"] .iwt-container > * {
      direction: ltr;
    }
  }

  /* Grid gap - requires clamp() */
  .iwt-container {
    gap: clamp(2rem, 5vw, 4rem);
  }

  /* Image aspect ratio - requires Liquid dynamic value */
  .iwt-image {
    aspect-ratio: {{ section.settings.image_ratio }};
  }

  /* Title - requires clamp() and Liquid color */
  .iwt-title {
    font-size: clamp(1.75rem, 5vw, 2.5rem);
    letter-spacing: -0.03em;
    line-height: 0.95;
    color: {{ section.settings.text_color }};
  }

  @media (min-width: 1024px) {
    .iwt-title {
      font-size: clamp(2rem, 3.5vw, 3rem);
    }
  }

  @media (min-width: 1536px) {
    .iwt-title {
      font-size: clamp(2.5rem, 3vw, 3.5rem);
    }
  }

  /* Title line indent - requires clamp() */
  .iwt-title-line:nth-child(2) {
    margin-left: clamp(0.5rem, 4vw, 2rem);
  }

  /* Text - requires clamp() and Liquid color */
  .iwt-text {
    font-size: clamp(0.875rem, 1.5vw, 1rem);
    color: {{ section.settings.text_color }};
  }

  /* Label and CTA - require Liquid color */
  .iwt-label,
  .iwt-cta {
    color: {{ section.settings.text_color }};
  }

  /* CTA hover effects */
  .iwt-cta:hover {
    opacity: 0.7;
  }

  .iwt-cta-text-wrapper {
    overflow: hidden;
    display: inline-block;
  }

  .iwt-cta .iwt-cta-text {
    display: inline-block;
    position: relative;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .iwt-cta .iwt-cta-text::after {
    content: attr(data-hover);
    position: absolute;
    left: 0;
    top: 100%;
    white-space: nowrap;
  }

  .iwt-cta:hover .iwt-cta-text {
    transform: translateY(-100%);
  }

  /* Stats - requires clamp() and Liquid color */
  .iwt-stats {
    gap: clamp(2rem, 4vw, 4rem);
    border-top-color: {{ section.settings.text_color }}20;
  }

  .iwt-stat-number {
    font-size: clamp(2rem, 5vw, 3.5rem);
    letter-spacing: -0.03em;
    color: {{ section.settings.text_color }};
  }

  .iwt-stat-label {
    color: {{ section.settings.text_color }};
  }
</style>

<section
  class="iwt-section overflow-hidden"
  data-iwt-section="{{ section.id }}"
  data-layout="{{ section.settings.layout }}"
>
  <div class="iwt-container grid grid-cols-1 lg:grid-cols-2 items-center {{ container_class }}">
    {%- comment -%} Image {%- endcomment -%}
    <div class="iwt-image-wrapper relative overflow-hidden">
      <div class="iwt-image overflow-hidden" data-iwt-image>
        {% if section.settings.image != blank %}
          {{ section.settings.image | image_url: width: 1200 | image_tag:
            class: 'w-full h-full object-cover',
            loading: 'lazy',
            sizes: '(max-width: 1024px) 100vw, 50vw',
            widths: '600, 800, 1000, 1200'
          }}
        {% else %}
          {{ 'lifestyle-2' | placeholder_svg_tag: 'w-full h-full object-cover' }}
        {% endif %}
      </div>
    </div>

    {%- comment -%} Content {%- endcomment -%}
    <div class="iwt-content max-w-2xl lg:mx-auto {{ content_class }}" data-iwt-content>
      {% if section.settings.label != blank %}
        <span class="iwt-label inline-block text-[0.65rem] font-semibold uppercase tracking-[0.2em] opacity-60 mb-6" data-iwt-label>{{ section.settings.label }}</span>
      {% endif %}

      {% if section.settings.title != blank %}
        <h2 class="iwt-title font-bold uppercase mb-6" data-iwt-title>
          {%- assign title_words = section.settings.title | split: ' ' -%}
          {%- assign words_per_line = 3 -%}
          {%- for word in title_words -%}
            {%- assign word_index = forloop.index0 | modulo: words_per_line -%}
            {%- if word_index == 0 -%}
              <span class="iwt-title-line overflow-hidden">
            {%- endif -%}
            <span class="inline-block">{{ word }}</span>{% unless forloop.last %} {% endunless %}
            {%- assign next_index = forloop.index | modulo: words_per_line -%}
            {%- if next_index == 0 or forloop.last -%}
              </span>
            {%- endif -%}
          {%- endfor -%}
        </h2>
      {% endif %}

      {% if section.settings.text != blank %}
        <div class="iwt-text leading-relaxed opacity-80 mb-8" data-iwt-text>
          {{ section.settings.text }}
        </div>
      {% endif %}

      {% if section.settings.button_text != blank and section.settings.button_link != blank %}
        <a href="{{ section.settings.button_link }}" class="iwt-cta inline-flex items-center gap-3 text-xs font-semibold uppercase tracking-[0.1em] border-b border-current pb-2 transition-opacity duration-300" data-iwt-cta>
          <span class="iwt-cta-text-wrapper">
            <span class="iwt-cta-text" data-hover="{{ section.settings.button_text }}">{{ section.settings.button_text }}</span>
          </span>
          <i class="ph ph-arrow-right transition-transform duration-300"></i>
        </a>
      {% endif %}

      {%- comment -%} Stats {%- endcomment -%}
      {% if section.blocks.size > 0 %}
        <div class="iwt-stats flex mt-12 pt-8 border-t" data-iwt-stats>
          {% for block in section.blocks %}
            {% if block.type == 'stat' %}
              <div class="iwt-stat overflow-hidden" {{ block.shopify_attributes }}>
                <div class="iwt-stat-number font-bold leading-none overflow-hidden">
                  <span class="inline-block" data-iwt-stat-number>{{ block.settings.number }}</span>
                </div>
                <div class="iwt-stat-label mt-2 text-[0.65rem] uppercase tracking-[0.1em] opacity-60">{{ block.settings.label }}</div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</section>

<script>
  (function() {
    const section = document.querySelector('[data-iwt-section="{{ section.id }}"]');
    if (!section || section.dataset.iwtAnimInitialized) return;
    section.dataset.iwtAnimInitialized = 'true';

    function initAnimation() {
      if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
        requestAnimationFrame(initAnimation);
        return;
      }

      // Mark section as ready for animations
      section.dataset.iwtAnimReady = 'true';

      const image = section.querySelector('[data-iwt-image]');
      const label = section.querySelector('[data-iwt-label]');
      const title = section.querySelector('[data-iwt-title]');
      const titleSpans = title ? title.querySelectorAll('.inline-block') : [];
      const text = section.querySelector('[data-iwt-text]');
      const cta = section.querySelector('[data-iwt-cta]');
      const statNumbers = section.querySelectorAll('[data-iwt-stat-number]');

      // Set initial states
      if (image) gsap.set(image, { clipPath: 'inset(0 100% 0 0)' });
      if (label) gsap.set(label, { opacity: 0, y: 20 });
      if (titleSpans.length) gsap.set(titleSpans, { yPercent: 100 });
      if (text) gsap.set(text, { opacity: 0, y: 30 });
      if (cta) gsap.set(cta, { opacity: 0, y: 20 });
      if (statNumbers.length) gsap.set(statNumbers, { yPercent: 100 });

      // Main timeline with ScrollTrigger
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: section,
          start: 'top 70%',
          once: true
        }
      });

      // Image reveal
      if (image) {
        tl.to(image, {
          clipPath: 'inset(0 0% 0 0)',
          duration: 1.6,
          ease: 'expo.inOut'
        }, 0);
      }

      // Label
      if (label) {
        tl.to(label, {
          opacity: 0.6,
          y: 0,
          duration: 0.6,
          ease: 'power3.out'
        }, 0.4);
      }

      // Title
      if (titleSpans.length) {
        tl.to(titleSpans, {
          yPercent: 0,
          duration: 1,
          ease: 'power4.out',
          stagger: 0.04
        }, 0.5);
      }

      // Text
      if (text) {
        tl.to(text, {
          opacity: 0.8,
          y: 0,
          duration: 0.8,
          ease: 'power3.out'
        }, 0.8);
      }

      // CTA
      if (cta) {
        tl.to(cta, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: 'power3.out'
        }, 1);
      }

      // Stats
      if (statNumbers.length) {
        tl.to(statNumbers, {
          yPercent: 0,
          duration: 0.8,
          ease: 'power4.out',
          stagger: 0.1
        }, 1.1);
      }
    }

    requestAnimationFrame(initAnimation);
  })();
</script>

{% schema %}
{
  "name": "Image with Text",
  "tag": "section",
  "class": "iwt-section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        { "value": "1/1", "label": "Square (1:1)" },
        { "value": "4/5", "label": "Portrait (4:5)" },
        { "value": "3/4", "label": "Portrait (3:4)" },
        { "value": "16/9", "label": "Landscape (16:9)" }
      ],
      "default": "4/5",
      "label": "Image ratio"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "label",
      "default": "Our Story",
      "label": "Label"
    },
    {
      "type": "text",
      "id": "title",
      "default": "Crafted With Purpose",
      "label": "Title"
    },
    {
      "type": "richtext",
      "id": "text",
      "default": "<p>We believe in creating products that stand the test of time. Each piece is thoughtfully designed and meticulously crafted using the finest materials and traditional techniques.</p>",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "button_text",
      "default": "Learn More",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "options": [
        { "value": "image_left", "label": "Image left" },
        { "value": "image_right", "label": "Image right" }
      ],
      "default": "image_left",
      "label": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": true,
      "label": "Full width"
    },
    {
      "type": "checkbox",
      "id": "remove_padding",
      "default": false,
      "label": "Remove vertical padding"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "default": "#ffffff",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "text_color",
      "default": "#000000",
      "label": "Text color"
    }
  ],
  "blocks": [
    {
      "type": "stat",
      "name": "Statistic",
      "settings": [
        {
          "type": "text",
          "id": "number",
          "default": "100+",
          "label": "Number"
        },
        {
          "type": "text",
          "id": "label",
          "default": "Products",
          "label": "Label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with Text",
      "blocks": [
        { "type": "stat", "settings": { "number": "10+", "label": "Years" } },
        { "type": "stat", "settings": { "number": "50K", "label": "Customers" } }
      ]
    }
  ]
}
{% endschema %}
