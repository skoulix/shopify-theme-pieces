{%- comment -%}
  Cart Section - Modern design with GSAP animations
{%- endcomment -%}

{%- liquid
  if section.settings.full_width
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif
-%}

<style>
  .cart-page-title { font-size: calc(clamp(2.5rem, 10vw, 4.5rem) * var(--heading-font-scale, 1)); letter-spacing: -0.03em; line-height: 0.9; }
  @media (min-width: 1024px) { .cart-page-title { font-size: calc(clamp(3.5rem, 7vw, 6rem) * var(--heading-font-scale, 1)); } }
  .cart-page-title-line:nth-child(2) { margin-left: clamp(1.5rem, 10vw, 8rem); }
  /* Note: Title/subtitle hidden states are handled by GSAP fromTo */
  .cart-wrapper.is-loading .cart-item-image { clip-path: inset(0 100% 0 0); }
  .cart-item { opacity: 0; transform: translateY(30px); }
  .cart-item-image { clip-path: inset(0 100% 0 0); }
  .cart-wrapper.is-ready .cart-item { opacity: 1; transform: translateY(0); }
  .cart-wrapper.is-ready .cart-item-image { clip-path: inset(0 0% 0 0); }
  .cart-quantity { display: inline-flex; align-items: center; background: transparent; border-radius: var(--input-radius); padding: 0; position: relative; overflow: hidden; border: var(--input-border-width) solid var(--color-border); }
  .cart-quantity-btn { width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; background: transparent; border: none; cursor: pointer; color: var(--color-text); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  .cart-quantity-btn:hover { background: var(--color-primary); color: var(--color-primary-contrast); }
  .cart-quantity-btn:active { transform: scale(0.95); }
  .cart-quantity-value { width: 3.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; }
  .cart-quantity-input { width: 100%; height: 100%; text-align: center; font-size: 1rem; font-weight: 600; background: transparent; border: none !important; border-width: 0 !important; color: var(--color-text); -moz-appearance: textfield; outline: none; }
  .cart-quantity-input::-webkit-outer-spin-button, .cart-quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .cart-quantity-input:focus { outline: none; border: none !important; }
  .cart-quantity.is-changing .cart-quantity-input { animation: cartQuantityPop 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  @keyframes cartQuantityPop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
  .cart-summary { opacity: 0; transform: translateY(30px); }
  .cart-wrapper.is-ready .cart-summary { opacity: 1; transform: translateY(0); }
  .cart-empty { opacity: 0; }
  .cart-wrapper.is-ready .cart-empty { opacity: 1; }
  .cart-wrapper.is-updating { cursor: wait; }
  .cart-wrapper.is-updating * { cursor: wait !important; }
  .cart-wrapper.is-updating [data-cart-form] { opacity: 0.5; pointer-events: none; }
</style>

<div class="cart-wrapper is-loading min-h-screen" data-cart-wrapper>
  <header class="pt-[--page-vertical-padding] pb-16 {{ container_class }}">
    <h1 class="cart-page-title font-bold text-[--color-text] font-heading">
      <span class="cart-page-title-line block overflow-hidden">
        <span class="inline-block">{{ 'cart.title' | t }}</span>
      </span>
    </h1>

    <p class="page-header-subtitle mt-6">
      <span class="page-header-subtitle-line" data-subtitle-line></span>
      <span class="overflow-hidden"><span class="inline-block" data-subtitle-text>{{ cart.item_count }} {{ cart.item_count | pluralize: 'Item', 'Items' }}</span></span>
    </p>
  </header>

  {% if cart.item_count > 0 %}
    <div class="{{ container_class }} pb-[--page-vertical-padding]">
      <div class="lg:grid lg:grid-cols-12 lg:gap-x-12">
        {%- comment -%} Cart Items {%- endcomment -%}
        <div class="lg:col-span-7">
          <form action="{{ routes.cart_url }}" method="post" id="cart-form" data-cart-form>
            <ul role="list" class="divide-y divide-[--color-border]">
              {% for item in cart.items %}
                <li class="cart-item py-8 first:pt-0" data-cart-item data-line="{{ forloop.index }}">
                  <div class="flex gap-6">
                    {%- comment -%} Image {%- endcomment -%}
                    <div class="cart-item-image w-28 h-36 flex-shrink-0 overflow-hidden bg-[--color-background-secondary]">
                      {% if item.image %}
                        <a href="{{ item.url }}">
                          {{ item.image | image_url: width: 300 | image_tag:
                            class: 'w-full h-full object-cover',
                            loading: 'lazy'
                          }}
                        </a>
                      {% endif %}
                    </div>

                    {%- comment -%} Details {%- endcomment -%}
                    <div class="flex flex-1 flex-col justify-between">
                      <div>
                        <div class="flex justify-between">
                          <div>
                            <h3 class="text-base font-medium text-[--color-text]">
                              <a href="{{ item.url }}" class="hover:text-[--color-primary] transition-colors">
                                {{ item.product.title }}
                              </a>
                            </h3>
                            {% unless item.product.has_only_default_variant %}
                              <p class="mt-1 text-sm text-[--color-text-secondary]">{{ item.variant.title }}</p>
                            {% endunless %}
                            {% if item.selling_plan_allocation %}
                              <p class="mt-1 text-xs text-[--color-text-secondary]">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                            {% endif %}
                          </div>
                          <div class="text-right">
                            <p class="text-base font-medium text-[--color-text]">{{ item.final_line_price | money }}</p>
                            {% if item.original_line_price != item.final_line_price %}
                              <p class="text-sm text-[--color-text-secondary] line-through">{{ item.original_line_price | money }}</p>
                            {% endif %}
                          </div>
                        </div>
                      </div>

                      <div class="flex items-center justify-between mt-4">
                        {%- comment -%} Quantity {%- endcomment -%}
                        <div class="cart-quantity" data-quantity-wrapper>
                          <button type="button" class="cart-quantity-btn" data-quantity-minus aria-label="Decrease quantity">
                            <i class="ph ph-minus"></i>
                          </button>
                          <div class="cart-quantity-value">
                            <input
                              type="number"
                              name="updates[]"
                              value="{{ item.quantity }}"
                              min="0"
                              class="cart-quantity-input"
                              data-quantity-input
                              data-line="{{ forloop.index }}"
                              aria-label="Quantity"
                            >
                          </div>
                          <button type="button" class="cart-quantity-btn" data-quantity-plus aria-label="Increase quantity">
                            <i class="ph ph-plus"></i>
                          </button>
                        </div>

                        {%- comment -%} Remove {%- endcomment -%}
                        <button
                          type="button"
                          class="text-xs uppercase tracking-wider font-medium text-[--color-text-secondary] hover:text-[--color-text] transition-colors"
                          data-remove-item
                          data-line="{{ forloop.index }}"
                        >
                          {{ 'cart.remove' | t }}
                        </button>
                      </div>
                    </div>
                  </div>
                </li>
              {% endfor %}
            </ul>
          </form>
        </div>

        {%- comment -%} Summary {%- endcomment -%}
        <div class="lg:col-span-5 mt-12 lg:mt-0">
          <div class="cart-summary sticky top-24 bg-[--color-background-secondary] p-8">
            <h2 class="text-lg font-semibold text-[--color-text] font-heading">{{ 'cart.summary' | t }}</h2>

            <dl class="mt-6 space-y-4">
              <div class="flex items-center justify-between">
                <dt class="text-sm text-[--color-text-secondary]">{{ 'cart.subtotal' | t }}</dt>
                <dd class="text-sm font-medium text-[--color-text]" data-cart-subtotal>{{ cart.total_price | money }}</dd>
              </div>
              {% if cart.cart_level_discount_applications.size > 0 %}
                {% for discount in cart.cart_level_discount_applications %}
                  <div class="flex items-center justify-between">
                    <dt class="text-sm text-[--color-text-secondary]">
                      <i class="ph ph-tag mr-1"></i>
                      {{ discount.title }}
                    </dt>
                    <dd class="text-sm font-medium text-green-600">-{{ discount.total_allocated_amount | money }}</dd>
                  </div>
                {% endfor %}
              {% endif %}
            </dl>

            <div class="mt-6 pt-6 border-t border-[--color-border]">
              <div class="flex items-center justify-between">
                <dt class="text-base font-medium text-[--color-text]">{{ 'cart.total' | t }}</dt>
                <dd class="text-base font-medium text-[--color-text]" data-cart-total>{{ cart.total_price | money }}</dd>
              </div>
              <p class="mt-1 text-xs text-[--color-text-secondary]">{{ 'cart.taxes_shipping_note' | t }}</p>
            </div>

            {%- comment -%} Cart Note {%- endcomment -%}
            <details class="mt-6">
              <summary class="text-xs uppercase tracking-wider font-medium text-[--color-text-secondary] cursor-pointer hover:text-[--color-text] transition-colors flex items-center justify-between">
                <span>{{ 'cart.add_note' | t }}</span>
                <i class="ph ph-caret-down text-sm transition-transform"></i>
              </summary>
              <div class="mt-4">
                <textarea
                  name="note"
                  form="cart-form"
                  class="w-full p-3 text-sm bg-transparent border border-[--color-border] text-[--color-text] resize-none focus:border-[--color-primary] focus:outline-none"
                  rows="3"
                  placeholder="{{ 'cart.note_placeholder' | t }}"
                  data-cart-note
                >{{ cart.note }}</textarea>
              </div>
            </details>

            {%- comment -%} Actions {%- endcomment -%}
            <div class="mt-8 space-y-3">
              <form action="{{ routes.cart_url }}" method="post">
                <button type="submit" name="checkout" class="btn btn--primary btn--full">
                  <i class="ph ph-lock-simple"></i>
                  <span>{{ 'cart.checkout' | t }}</span>
                </button>
              </form>

              <a href="{{ routes.all_products_collection_url }}" class="btn btn--secondary btn--full">
                <i class="ph ph-arrow-left"></i>
                <span>{{ 'cart.continue_shopping' | t }}</span>
              </a>
            </div>

            {%- comment -%} Trust Badges {%- endcomment -%}
            <div class="mt-8 pt-6 border-t border-[--color-border]">
              <div class="flex items-center justify-center gap-6 text-[--color-text-secondary]">
                <div class="flex items-center gap-2 text-xs">
                  <i class="ph ph-shield-check text-lg"></i>
                  <span>Secure</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <i class="ph ph-truck text-lg"></i>
                  <span>Fast Shipping</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <i class="ph ph-arrows-counter-clockwise text-lg"></i>
                  <span>Easy Returns</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="cart-empty {{ container_class }} pb-[--page-vertical-padding]">
      <h2 class="text-2xl md:text-3xl font-semibold text-[--color-text] font-heading">{{ 'cart.empty' | t }}</h2>
      <p class="mt-4 text-[--color-text-secondary] max-w-sm">{{ 'cart.empty_description' | t }}</p>

      <div class="mt-10 flex flex-col sm:flex-row gap-4 max-w-xs sm:max-w-none">
        <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary w-full sm:w-auto">
          <i class="ph ph-storefront"></i>
          <span>{{ 'cart.start_shopping' | t }}</span>
        </a>
        <a href="{{ routes.root_url }}" class="btn btn--secondary w-full sm:w-auto">
          <i class="ph ph-house"></i>
          <span>{{ '404.back_home' | t }}</span>
        </a>
      </div>
    </div>
  {% endif %}
</div>

{%- comment -%} Cart page functionality is now handled by CartPageManager in the bundled JS {%- endcomment -%}

{% schema %}
{
  "name": "Cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": false
    }
  ]
}
{% endschema %}
