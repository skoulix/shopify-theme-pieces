{%- liquid
  if section.settings.full_width
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif

  assign collection = section.settings.collection
  assign products_to_show = section.settings.products_to_show
-%}

<style>
  .fc-{{ section.id }} {
    padding: var(--section-vertical-padding) 0;
  }

  .fc-header-{{ section.id }} {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
    margin-bottom: clamp(2rem, 5vh, 4rem);
  }

  .fc-header-content-{{ section.id }} {
    text-align: {{ section.settings.header_alignment }};
    flex: 1;
  }

  /* Label, title, description use global .section-* classes from utilities.css */
  .fc-header-{{ section.id }} .section-label {
    margin-bottom: 1.5rem;
  }

  .fc-header-{{ section.id }} .section-description {
    margin-top: 1.5rem;
    {% if section.settings.header_alignment == 'center' %}
    margin-left: auto;
    margin-right: auto;
    {% elsif section.settings.header_alignment == 'right' %}
    margin-left: auto;
    {% endif %}
  }

  .fc-view-all-{{ section.id }} {
    flex-shrink: 0;
    margin-top: 0.5rem;
  }

  @media (min-width: 1024px) {
    .fc-{{ section.id }} .fc-grid {
      grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
    }
  }
</style>

<section
  class="fc-{{ section.id }} color-{{ section.settings.color_scheme }}"
  data-featured-collection="{{ section.id }}"
>
  <div class="{{ container_class }}">
    {%- comment -%} Header - uses global data-tween system for animations {%- endcomment -%}
    {% if section.settings.label != blank or section.settings.title != blank or collection.title != blank or section.settings.show_view_all %}
      <div class="fc-header-{{ section.id }}">
        <div class="fc-header-content-{{ section.id }}" data-tween-group="fc-header-{{ section.id }}">
          {% if section.settings.label != blank %}
            <span class="section-label" data-tween data-tween-type="fade-up">
              {{ section.settings.label }}
            </span>
          {% endif %}

          <h2 class="section-title font-heading" data-tween data-tween-type="split-text">
            {% if section.settings.title != blank %}
              {{ section.settings.title }}
            {% else %}
              {{ collection.title | default: 'Featured' }}
            {% endif %}
          </h2>

          {% if section.settings.description != blank %}
            <p class="section-description" data-tween data-tween-type="fade-up">
              {{ section.settings.description }}
            </p>
          {% endif %}
        </div>

        {% if section.settings.show_view_all and collection %}
          <a href="{{ collection.url }}" class="fc-view-all-{{ section.id }} text-hover-reveal inline-flex items-center gap-2 text-xs font-semibold tracking-widest text-[--color-text-secondary]">
            <span data-hover="{{ section.settings.view_all_text }}">{{ section.settings.view_all_text }}</span>
            <span class="sr-only">{{ collection.title }}</span>
            <i class="ph ph-arrow-right" aria-hidden="true"></i>
          </a>
        {% endif %}
      </div>
    {% endif %}

    {%- comment -%} Product Grid {%- endcomment -%}
    <div class="fc-grid grid grid-cols-2 md:grid-cols-3 gap-[clamp(1rem,3vw,2rem)]">
      {% if collection != blank %}
        {% for product in collection.products limit: products_to_show %}
          {% render 'product-card',
            product: product,
            collection: collection,
            index: forloop.index0,
            show_vendor: section.settings.show_vendor,
            lazy_load: true,
            animate_image: true
          %}
        {% endfor %}
      {% else %}
        {%- comment -%} Placeholder cards when no collection selected {%- endcomment -%}
        {% for i in (1..products_to_show) %}
          {%- assign placeholder_index = forloop.index | modulo: 6 | plus: 1 -%}
          <div class="product-card flex flex-col cursor-pointer rounded-[--card-radius] overflow-hidden h-full border-[length:var(--card-border-width)] border-solid border-[--color-border] shadow-[--card-shadow]">
            <div class="product-card-image relative overflow-hidden aspect-[3/4]" data-tween data-tween-type="clip-right">
              {{ 'product-' | append: placeholder_index | placeholder_svg_tag: 'w-full h-full object-cover' }}
            </div>
            <div class="product-card-content flex-1 p-4 bg-[--color-background]">
              <h3 class="product-card-title mt-2 text-xs md:text-sm font-semibold tracking-wide text-[--color-text] font-heading">
                {{ 'sections.featured_collection.placeholder_product' | t }} {{ forloop.index }}
              </h3>
              <div class="product-card-price mt-2 text-sm text-[--color-text-secondary]">
                $99.00
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "featured-collection-wrapper",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "label",
      "label": "Label"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "info": "Leave blank to use collection title"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text_alignment",
      "id": "header_alignment",
      "default": "left",
      "label": "Header alignment"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Products to show"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Columns (desktop)"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Show 'View All' link"
    },
    {
      "type": "text",
      "id": "view_all_text",
      "default": "View All",
      "label": "View all text"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Featured Collection",
      "category": "Products"
    }
  ]
}
{% endschema %}
