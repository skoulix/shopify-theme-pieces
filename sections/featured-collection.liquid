{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width, full_class: 'container-fluid'
  endcapture

  capture header_container_class
    render 'container-class', full_width: section.settings.full_width, full_class: 'container-fluid'
  endcapture

  assign collection = section.settings.collection
  assign products_to_show = section.settings.products_to_show
-%}

<style>
  .fc-{{ section.id }} .fc-grid {
    grid-template-columns: repeat(1, 1fr);
  }
  @media (min-width: 640px) {
    .fc-{{ section.id }} .fc-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (min-width: 1024px) {
    .fc-{{ section.id }} .fc-grid {
      grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
    }
  }
</style>

<div
  class="fc-{{ section.id }} section-padding{% unless section.settings.padding == 'default' %}-{{ section.settings.padding }}{% endunless %} color-{{ section.settings.color_scheme }}"
  data-featured-collection="{{ section.id }}"
>
  {%- comment -%} Header {%- endcomment -%}
  <div class="{{ header_container_class }}">
    {% render 'section-header-link',
      label: section.settings.label,
      title: section.settings.title,
      title_fallback: collection.title | default: 'Featured',
      description: section.settings.text,
      alignment: section.settings.header_alignment,
      group_id: section.id,
      link_url: collection.url,
      link_text: section.settings.view_all_text,
      link_sr_text: collection.title,
      show_link: section.settings.show_view_all
    %}
  </div>

  {%- comment -%} Product Grid {%- endcomment -%}
  <div class="{{ container_class }}">
    <div class="fc-grid grid gap-[clamp(1rem,3vw,2rem)]">
      {% if collection != blank %}
        {% for product in collection.products limit: products_to_show %}
          {% render 'product-card',
            product: product,
            collection: collection,
            index: forloop.index0,
            show_vendor: section.settings.show_vendor,
            lazy_load: true,
            animate_image: true
          %}
        {% endfor %}
      {% else %}
        {%- comment -%} Placeholder cards when no collection selected {%- endcomment -%}
        {% for i in (1..products_to_show) %}
          {%- assign placeholder_index = forloop.index | modulo: 6 | plus: 1 -%}
          <div class="product-card flex flex-col cursor-pointer rounded-(--card-radius) overflow-hidden h-full border border-(--color-border) shadow-(--card-shadow)">
            <div class="product-card-image relative overflow-hidden aspect-3/4" data-tween data-tween-type="clip-right">
              {{ 'product-' | append: placeholder_index | placeholder_svg_tag: 'w-full h-full object-cover' }}
            </div>
            <div class="product-card-content flex-1 p-4 bg-(--color-background)">
              <h3 class="product-card-title card-title mt-2">
                {{ 'sections.featured_collection.placeholder_product' | t }} {{ forloop.index }}
              </h3>
              <div class="product-card-price mt-2 text-sm text-(--color-text-secondary)">
                $99.00
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.featured_collection.name",
  "tag": "section",
  "class": "featured-collection-wrapper",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "t:shared.settings.collection.label"
    },
    {
      "type": "header",
      "content": "t:shared.headers.content"
    },
    {
      "type": "text",
      "id": "label",
      "label": "t:shared.settings.label.label"
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:shared.settings.title.label",
      "info": "t:sections.featured_collection.settings.title.info"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "t:shared.settings.text.label"
    },
    {
      "type": "header",
      "content": "t:shared.headers.layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "t:shared.settings.full_width.label"
    },
    {
      "type": "text_alignment",
      "id": "header_alignment",
      "label": "t:shared.settings.header_alignment.label",
      "default": "left"
    },
    {
      "type": "select",
      "id": "padding",
      "label": "t:shared.settings.padding.label",
      "info": "t:shared.settings.padding.info",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "t:shared.settings.padding.options__2.label"
        },
        {
          "value": "small",
          "label": "t:shared.settings.padding.options__1.label"
        },
        {
          "value": "large",
          "label": "t:shared.settings.padding.options__3.label"
        },
        {
          "value": "none",
          "label": "t:shared.settings.padding.options__0.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:shared.headers.products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "t:shared.settings.products_to_show.label"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "t:shared.settings.columns.label"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "t:shared.settings.show_vendor.label"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "t:shared.settings.show_view_all.label"
    },
    {
      "type": "text",
      "id": "view_all_text",
      "default": "t:sections.featured_collection.settings.view_all_text.default",
      "label": "t:shared.settings.view_all_text.label"
    },
    {
      "type": "header",
      "content": "t:shared.headers.colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:shared.settings.color_scheme.label",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured_collection.presets.featured_collection.name",
      "category": "t:sections.featured_collection.presets.featured_collection.category"
    }
  ],
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  }
}
{% endschema %}
