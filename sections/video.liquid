{%- comment -%}
  Video Section - Displays a video with optional looping
{%- endcomment -%}

{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width
  endcapture

  # Content alignment classes (includes flex items alignment for video overlay)
  case section.settings.header_alignment
    when 'left'
      assign content_align_class = 'items-start text-left'
    when 'right'
      assign content_align_class = 'items-end text-right'
    else
      assign content_align_class = 'items-center text-center'
  endcase
-%}

<div
  class="video-section{% unless section.settings.remove_padding %} section-padding{% endunless %} color-{{ section.settings.color_scheme }}"
  data-video-section="{{ section.id }}"
  style="--video-aspect-ratio: {{ section.settings.aspect_ratio }}; --video-border-radius: {{ section.settings.border_radius }}px;"
>
  <div class="{{ container_class }}">
    <div class="video-container{% if section.settings.show_controls %} show-controls{% endif %}">
      {% if section.settings.video != blank %}
        {{ section.settings.video | video_tag:
          autoplay: true,
          muted: true,
          playsinline: true,
          preload: 'auto',
          loop: section.settings.loop,
          controls: section.settings.show_controls
        }}
      {% else %}
        <div class="video-placeholder">
          <div class="video-placeholder-pattern"></div>
          <div class="video-placeholder-grid"></div>
          <div class="video-placeholder-glow"></div>
          <div class="video-placeholder-content">
            <div class="video-placeholder-icon">
              <i class="ph ph-play"></i>
            </div>
            <div class="video-placeholder-text">
              <p class="text-label-sm" style="color: rgba(255, 255, 255, 0.5);">Select a video</p>
              <div class="video-placeholder-bars">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>
      {% endif %}

      {% if section.settings.overlay_opacity > 0 %}
        <div class="video-overlay" style="background: {{ section.settings.overlay_color }}; opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};"></div>
      {% endif %}

      {% if section.settings.title != blank or section.settings.description != blank or section.settings.button_text != blank %}
        <div class="video-content {{ content_align_class }}" style="justify-content: {{ section.settings.content_position }};" data-tween-group="video-content-{{ section.id }}">
          {% if section.settings.label != blank %}
            <span class="section-label" data-tween data-tween-type="fade-up">
              {{ section.settings.label }}
            </span>
          {% endif %}

          {% if section.settings.title != blank %}
            <h2 class="section-title" data-tween data-tween-type="split-text">
              {{ section.settings.title }}
            </h2>
          {% endif %}

          {% if section.settings.description != blank %}
            <p class="section-description" data-tween data-tween-type="fade-up">
              {{ section.settings.description }}
            </p>
          {% endif %}

          {% if section.settings.button_text != blank and section.settings.button_link != blank %}
            {% render 'button',
              text: section.settings.button_text,
              url: section.settings.button_link,
              style: section.settings.button_style,
              color: section.settings.button_color,
              size: section.settings.button_size,
              extra_class: 'mt-8',
              animate: true
            %}
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{%- comment -%} Animations handled by global TweenManager via data-tween attributes {%- endcomment -%}

{% schema %}
{
  "name": "Video",
  "tag": "section",
  "class": "video-section",
  "settings": [
    {
      "type": "header",
      "content": "Video"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Video",
      "info": "Video will autoplay and be muted"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "default": true,
      "label": "Loop video"
    },
    {
      "type": "checkbox",
      "id": "show_controls",
      "default": false,
      "label": "Show video controls"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "options": [
        { "value": "16/9", "label": "Landscape (16:9)" },
        { "value": "21/9", "label": "Cinematic (21:9)" },
        { "value": "4/3", "label": "Standard (4:3)" },
        { "value": "1/1", "label": "Square (1:1)" },
        { "value": "9/16", "label": "Portrait (9:16)" }
      ],
      "default": "16/9",
      "label": "Aspect ratio"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "default": 0,
      "unit": "px",
      "label": "Border radius"
    },
    {
      "type": "header",
      "content": "Overlay"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "default": "#000000",
      "label": "Overlay color"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "default": 30,
      "unit": "%",
      "label": "Overlay opacity"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "label",
      "label": "Label"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "default": "outline",
      "options": [
        { "value": "solid", "label": "Solid" },
        { "value": "outline", "label": "Outline" }
      ]
    },
    {
      "type": "select",
      "id": "button_color",
      "label": "Button color",
      "default": "primary",
      "options": [
        { "value": "primary", "label": "Primary (accent)" },
        { "value": "secondary", "label": "Secondary (neutral)" }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button size",
      "default": "large",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "default", "label": "Default" },
        { "value": "large", "label": "Large" }
      ]
    },
    {
      "type": "select",
      "id": "content_position",
      "options": [
        { "value": "flex-start", "label": "Top" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Bottom" }
      ],
      "default": "center",
      "label": "Content vertical position"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": true,
      "label": "Full width"
    },
    {
      "type": "text_alignment",
      "id": "header_alignment",
      "label": "Content alignment",
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "remove_padding",
      "default": true,
      "label": "Remove vertical padding"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Video",
      "category": "Image & media"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
  }
{% endschema %}
