{%- comment -%}
  Featured Product Section - Tailwind Version
  Product showcase for homepage or landing pages
{%- endcomment -%}

{%- liquid
  assign product = section.settings.product
  if product == null
    assign placeholder = true
  endif
-%}

<product-info
  id="FeaturedProduct-{{ section.id }}"
  class="py-12 lg:py-16"
  data-section="{{ section.id }}"
  data-product-id="{{ product.id }}"
  data-update-url="false"
  data-url="{{ product.url }}"
  {% if section.settings.image_zoom == 'hover' %}data-zoom-on-hover{% endif %}
>
  <script src="{{ 'product-info.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
  {%- if product.quantity_price_breaks_configured? -%}
    <script src="{{ 'show-more.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'price-per-item.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}
  {% if section.settings.image_zoom == 'hover' %}
    <script id="EnableZoomOnHover-featured" src="{{ 'magnify.js' | asset_url }}" defer="defer"></script>
  {% endif %}
  {%- if request.design_mode -%}
    <script src="{{ 'theme-editor.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}

  {%- assign first_3d_model = product.media | where: 'media_type', 'model' | first -%}
  {%- if first_3d_model -%}
    <link
      id="ModelViewerStyle"
      rel="stylesheet"
      href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
      media="print"
      onload="this.media='all'"
    >
  {%- endif -%}

  {% assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src' %}

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start">
      {%- comment -%} Product Media {%- endcomment -%}
      <div class="{% if section.settings.media_position == 'right' %}lg:order-2{% endif %}">
        {%- unless placeholder -%}
          {% render 'product-media-gallery', product: product, variant_images: variant_images, limit: 1 %}
        {%- else -%}
          <div class="aspect-square rounded-xl bg-neutral-100 flex items-center justify-center">
            {{ 'product-apparel-1' | placeholder_svg_tag: 'w-full h-full text-neutral-300' }}
          </div>
        {%- endunless -%}
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div class="{% if section.settings.media_position == 'right' %}lg:order-1{% endif %}">
        <section
          id="ProductInfo-{{ section.id }}"
          class="space-y-6"
          data-section="{{ section.id }}"
          data-url="{{ product.url }}"
        >
          {%- assign product_form_id = 'product-form-' | append: section.id -%}

          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when '@app' -%}
                <div {{ block.shopify_attributes }}>
                  {% render block %}
                </div>

              {%- when 'text' -%}
                <p
                  class="{% if block.settings.text_style == 'uppercase' %}text-xs uppercase tracking-wider text-neutral-500{% elsif block.settings.text_style == 'subtitle' %}text-lg text-neutral-600{% else %}text-base text-neutral-700{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{- block.settings.text -}}
                </p>

              {%- when 'title' -%}
                <h2
                  class="
                    {% case block.settings.heading_size %}
                      {% when 'h2' %}text-2xl lg:text-3xl
                      {% when 'h1' %}text-3xl lg:text-4xl
                      {% when 'h0' %}text-4xl lg:text-5xl
                      {% when 'hxl' %}text-5xl lg:text-6xl
                      {% when 'hxxl' %}text-6xl lg:text-7xl
                    {% endcase %}
                    font-semibold text-neutral-900 leading-tight
                  "
                  {{ block.shopify_attributes }}
                >
                  {%- unless placeholder -%}
                    {{ product.title | escape }}
                  {%- else -%}
                    {{ 'onboarding.product_title' | t }}
                  {%- endunless -%}
                </h2>

              {%- when 'price' -%}
                <div id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}>
                  {%- render 'price',
                    product: product,
                    placeholder: placeholder,
                    use_variant: true,
                    show_badges: true,
                    price_class: 'text-xl font-semibold'
                  -%}
                </div>
                {%- if product.quantity_price_breaks_configured? -%}
                  <p class="text-sm text-neutral-500" id="Volume-Note-{{ section.id }}">
                    {{ 'products.product.volume_pricing.note' | t }}
                  </p>
                {%- endif -%}
                {%- if cart.taxes_included or cart.duties_included or shop.shipping_policy.body != blank -%}
                  <p class="text-xs text-neutral-500">
                    {%- if cart.duties_included and cart.taxes_included -%}
                      {{ 'products.product.duties_and_taxes_included' | t }}
                    {%- elsif cart.taxes_included -%}
                      {{ 'products.product.taxes_included' | t }}
                    {%- elsif cart.duties_included -%}
                      {{ 'products.product.duties_included' | t }}
                    {%- endif -%}
                    {%- if shop.shipping_policy.body != blank -%}
                      {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                    {%- endif -%}
                  </p>
                {%- endif -%}
                {%- unless placeholder -%}
                  <div {{ block.shopify_attributes }}>
                    {%- form 'product', product -%}
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                      {{ form | payment_terms }}
                    {%- endform -%}
                  </div>
                {%- endunless -%}

              {%- when 'sku' -%}
                <p
                  class="text-xs text-neutral-400 {% if product.selected_or_first_available_variant.sku.size == 0 %}hidden{% endif %}"
                  id="Sku-{{ section.id }}"
                  role="status"
                  {{ block.shopify_attributes }}
                >
                  <span class="sr-only">{{ 'products.product.sku' | t }}:</span>
                  SKU: {{ product.selected_or_first_available_variant.sku }}
                </p>

              {%- when 'quantity_selector' -%}
                <div
                  id="Quantity-Form-{{ section.id }}"
                  class="space-y-2"
                  {{ block.shopify_attributes }}
                >
                  {% assign cart_qty = cart | item_count_for_variant: product.selected_or_first_available_variant.id %}
                  <label class="text-sm font-medium text-neutral-700" for="Quantity-{{ section.id }}">
                    {{ 'products.product.quantity.label' | t }}
                    {%- if cart_qty > 0 -%}
                      <span class="text-neutral-500 font-normal">({{ 'products.product.quantity.in_cart_html' | t: quantity: cart_qty }})</span>
                    {%- endif -%}
                  </label>
                  <quantity-input class="flex items-center border border-neutral-300 rounded-lg w-32" data-url="{{ product.url }}" data-section="{{ section.id }}">
                    <button class="w-10 h-10 flex items-center justify-center text-neutral-600 hover:text-neutral-900 transition-colors" name="minus" type="button">
                      {%- render 'icon', name: 'minus', size: '16' -%}
                    </button>
                    <input
                      class="w-12 h-10 text-center text-sm font-medium border-0 focus:ring-0 bg-transparent"
                      type="number"
                      name="quantity"
                      id="Quantity-{{ section.id }}"
                      data-cart-quantity="{{ cart_qty }}"
                      min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                      {% if product.selected_or_first_available_variant.quantity_rule.max != null %}
                        max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                      {% endif %}
                      step="{{ product.selected_or_first_available_variant.quantity_rule.increment }}"
                      value="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                      form="{{ product_form_id }}"
                    >
                    <button class="w-10 h-10 flex items-center justify-center text-neutral-600 hover:text-neutral-900 transition-colors" name="plus" type="button">
                      {%- render 'icon', name: 'plus', size: '16' -%}
                    </button>
                  </quantity-input>
                  {%- if product.quantity_price_breaks_configured? -%}
                    <volume-pricing class="block mt-4 p-4 bg-neutral-50 rounded-lg" id="Volume-{{ section.id }}">
                      {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                        <p class="text-sm font-medium text-neutral-900 mb-2">{{ 'products.product.volume_pricing.title' | t }}</p>
                        <ul class="space-y-1 text-sm text-neutral-600">
                          <li class="flex justify-between">
                            <span>{{ product.selected_or_first_available_variant.quantity_rule.min }}+</span>
                            <span>{{ product.selected_or_first_available_variant.price | money_with_currency }} {{ 'sections.quick_order_list.each' | t }}</span>
                          </li>
                          {%- for price_break in product.selected_or_first_available_variant.quantity_price_breaks -%}
                            <li class="flex justify-between">
                              <span>{{ price_break.minimum_quantity }}+</span>
                              <span>{{ price_break.price | money_with_currency }} {{ 'sections.quick_order_list.each' | t }}</span>
                            </li>
                          {%- endfor -%}
                        </ul>
                      {%- endif -%}
                    </volume-pricing>
                  {%- endif -%}
                </div>

              {%- when 'share' -%}
                {% liquid
                  assign share_url = product.selected_variant.url | default: product.url | prepend: request.origin
                  render 'share-button', block: block, share_link: share_url
                %}

              {%- when 'variant_picker' -%}
                {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}

              {%- when 'buy_buttons' -%}
                {%- render 'buy-buttons',
                  block: block,
                  product: product,
                  product_form_id: product_form_id,
                  section_id: section.id
                -%}

              {%- when 'custom_liquid' -%}
                <div {{ block.shopify_attributes }}>
                  {{ block.settings.custom_liquid }}
                </div>

              {%- when 'rating' -%}
                {%- if product.metafields.reviews.rating.value != blank -%}
                  <div class="flex items-center gap-2" {{ block.shopify_attributes }}>
                    <div class="flex text-amber-400">
                      {%- assign rating = product.metafields.reviews.rating.value.rating | floor -%}
                      {%- for i in (1..5) -%}
                        {%- if i <= rating -%}
                          {%- render 'icon', name: 'star-fill', size: '16' -%}
                        {%- else -%}
                          {%- render 'icon', name: 'star', size: '16' -%}
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                    <span class="text-sm text-neutral-600">
                      {{ product.metafields.reviews.rating.value }} / {{ product.metafields.reviews.rating.value.scale_max }}
                    </span>
                    <span class="text-sm text-neutral-400">({{ product.metafields.reviews.rating_count }})</span>
                  </div>
                {%- endif -%}

              {%- when 'icon-with-text' -%}
                {% render 'icon-with-text', block: block %}

            {%- endcase -%}
          {%- endfor -%}

          {%- comment -%} View Full Details Link {%- endcomment -%}
          <a
            {% if product == blank %}role="link" aria-disabled="true"{% else %}href="{{ product.url }}"{% endif %}
            class="inline-flex items-center gap-2 text-sm font-medium text-neutral-900 hover:text-neutral-600 transition-colors"
          >
            {{ 'products.product.view_full_details' | t }}
            {%- render 'icon', name: 'arrow-right', size: '16' -%}
          </a>
        </section>
      </div>
    </div>

    {% render 'product-media-modal', product: product, variant_images: variant_images %}
  </div>

  {%- if first_3d_model -%}
    <script type="application/json" id="ProductJSON-{{ product.id }}">
      {{ product.media | where: 'media_type', 'model' | json }}
    </script>
    <script src="{{ 'product-model.js' | asset_url }}" defer></script>
  {%- endif -%}

  {% if product.media.size > 0 %}
    <script src="{{ 'product-modal.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'media-gallery.js' | asset_url }}" defer="defer"></script>
  {% endif %}

  <script type="application/ld+json">
    {{ product | structured_data }}
  </script>
</product-info>

{% schema %}
{
  "name": "t:sections.featured-product.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "text",
      "name": "t:sections.featured-product.blocks.text.name",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "text",
          "default": "t:sections.featured-product.blocks.text.settings.text.default",
          "label": "t:sections.featured-product.blocks.text.settings.text.label"
        },
        {
          "type": "select",
          "id": "text_style",
          "options": [
            { "value": "body", "label": "t:sections.featured-product.blocks.text.settings.text_style.options__1.label" },
            { "value": "subtitle", "label": "t:sections.featured-product.blocks.text.settings.text_style.options__2.label" },
            { "value": "uppercase", "label": "t:sections.featured-product.blocks.text.settings.text_style.options__3.label" }
          ],
          "default": "body",
          "label": "t:sections.featured-product.blocks.text.settings.text_style.label"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.featured-product.blocks.title.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "heading_size",
          "options": [
            { "value": "h2", "label": "t:sections.all.heading_size.options__1.label" },
            { "value": "h1", "label": "t:sections.all.heading_size.options__2.label" },
            { "value": "h0", "label": "t:sections.all.heading_size.options__3.label" },
            { "value": "hxl", "label": "t:sections.all.heading_size.options__4.label" },
            { "value": "hxxl", "label": "t:sections.all.heading_size.options__5.label" }
          ],
          "default": "h1",
          "label": "t:sections.all.heading_size.label"
        }
      ]
    },
    {
      "type": "price",
      "name": "t:sections.featured-product.blocks.price.name",
      "limit": 1
    },
    {
      "type": "sku",
      "name": "t:sections.featured-product.blocks.sku.name",
      "limit": 1
    },
    {
      "type": "quantity_selector",
      "name": "t:sections.featured-product.blocks.quantity_selector.name",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "t:sections.featured-product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "options": [
            { "value": "dropdown", "label": "t:sections.featured-product.blocks.variant_picker.settings.picker_type.options__1.label" },
            { "value": "button", "label": "t:sections.featured-product.blocks.variant_picker.settings.picker_type.options__2.label" }
          ],
          "default": "button",
          "label": "t:sections.featured-product.blocks.variant_picker.settings.picker_type.label"
        },
        {
          "id": "swatch_shape",
          "label": "t:sections.featured-product.blocks.variant_picker.settings.swatch_shape.label",
          "type": "select",
          "info": "t:sections.featured-product.blocks.variant_picker.settings.swatch_shape.info",
          "options": [
            { "value": "circle", "label": "t:sections.featured-product.blocks.variant_picker.settings.swatch_shape.options__1.label" },
            { "value": "square", "label": "t:sections.featured-product.blocks.variant_picker.settings.swatch_shape.options__2.label" },
            { "value": "none", "label": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.options__3.label" }
          ],
          "default": "circle"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.featured-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "t:sections.featured-product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "info": "t:sections.featured-product.blocks.buy_buttons.settings.show_dynamic_checkout.info"
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient",
          "default": true,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.info"
        }
      ]
    },
    {
      "type": "share",
      "name": "t:sections.featured-product.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "t:sections.featured-product.blocks.share.settings.text.label",
          "default": "t:sections.featured-product.blocks.share.settings.text.default"
        }
      ]
    },
    {
      "type": "custom_liquid",
      "name": "t:sections.custom-liquid.name",
      "settings": [
        {
          "type": "liquid",
          "id": "custom_liquid",
          "label": "t:sections.custom-liquid.settings.custom_liquid.label",
          "info": "t:sections.custom-liquid.settings.custom_liquid.info"
        }
      ]
    },
    {
      "type": "rating",
      "name": "t:sections.featured-product.blocks.rating.name",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "t:sections.featured-product.blocks.rating.settings.paragraph.content"
        }
      ]
    },
    {
      "type": "icon-with-text",
      "name": "t:sections.main-product.blocks.icon_with_text.name",
      "settings": [
        {
          "type": "select",
          "id": "layout",
          "options": [
            { "value": "horizontal", "label": "Horizontal" },
            { "value": "vertical", "label": "Vertical" }
          ],
          "default": "horizontal",
          "label": "Layout"
        },
        {
          "type": "select",
          "id": "icon_1",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "truck", "label": "Truck" },
            { "value": "return", "label": "Return" },
            { "value": "check_mark", "label": "Check mark" }
          ],
          "default": "truck",
          "label": "Icon 1"
        },
        {
          "type": "inline_richtext",
          "id": "heading_1",
          "default": "Free shipping",
          "label": "Heading 1"
        },
        {
          "type": "select",
          "id": "icon_2",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "truck", "label": "Truck" },
            { "value": "return", "label": "Return" },
            { "value": "check_mark", "label": "Check mark" }
          ],
          "default": "return",
          "label": "Icon 2"
        },
        {
          "type": "inline_richtext",
          "id": "heading_2",
          "default": "Easy returns",
          "label": "Heading 2"
        },
        {
          "type": "select",
          "id": "icon_3",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "truck", "label": "Truck" },
            { "value": "return", "label": "Return" },
            { "value": "check_mark", "label": "Check mark" }
          ],
          "default": "check_mark",
          "label": "Icon 3"
        },
        {
          "type": "inline_richtext",
          "id": "heading_3",
          "default": "Secure checkout",
          "label": "Heading 3"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "t:sections.featured-product.settings.product.label"
    },
    {
      "type": "select",
      "id": "media_position",
      "options": [
        { "value": "left", "label": "t:sections.featured-product.settings.media_position.options__1.label" },
        { "value": "right", "label": "t:sections.featured-product.settings.media_position.options__2.label" }
      ],
      "default": "left",
      "label": "t:sections.featured-product.settings.media_position.label"
    },
    {
      "type": "select",
      "id": "image_zoom",
      "options": [
        { "value": "lightbox", "label": "t:sections.main-product.settings.image_zoom.options__1.label" },
        { "value": "hover", "label": "t:sections.main-product.settings.image_zoom.options__2.label" },
        { "value": "none", "label": "t:sections.main-product.settings.image_zoom.options__3.label" }
      ],
      "default": "lightbox",
      "label": "t:sections.main-product.settings.image_zoom.label"
    },
    {
      "type": "checkbox",
      "id": "hide_variants",
      "default": false,
      "label": "t:sections.main-product.settings.hide_variants.label"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": false,
      "label": "t:sections.featured-product.settings.enable_video_looping.label"
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured-product.presets.name",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "{{ section.settings.product.vendor }}",
            "text_style": "uppercase"
          }
        },
        {
          "type": "title"
        },
        {
          "type": "price"
        },
        {
          "type": "variant_picker"
        },
        {
          "type": "quantity_selector"
        },
        {
          "type": "buy_buttons"
        },
        {
          "type": "share"
        }
      ]
    }
  ]
}
{% endschema %}
