{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width, full_class: 'container-fluid'
  endcapture
-%}

<style>
  .article-progress-bar { transition: width 0.1s ease-out; }
  .article-title { font-family: var(--font-heading); font-size: calc(clamp(1.75rem, 5vw, 2.75rem) * var(--heading-font-scale, 1)); font-weight: var(--font-heading-weight, 700); letter-spacing: calc(-0.03em + var(--heading-letter-spacing, 0em)); line-height: 1.05; text-wrap: balance; }
  @media (min-width: 1024px) { .article-title { font-size: calc(clamp(2.5rem, 4vw, 3.5rem) * var(--heading-font-scale, 1)); } }
  @media (min-width: 1536px) { .article-title { font-size: calc(clamp(3rem, 3.5vw, 4rem) * var(--heading-font-scale, 1)); } }
  .tween-split-line:nth-child(2) { margin-left: clamp(1rem, 6vw, 4rem); }
  .tween-split-line:nth-child(3) { margin-left: clamp(2rem, 10vw, 6rem); }
  .article-hero-date::before, .article-hero-reading-time::before { content: ''; display: inline-block; width: 4px; height: 4px; border-radius: 50%; background: var(--color-text-secondary); }
  /* article-image animation handled by TweenManager */
</style>

<article class="article-wrapper section-padding{% unless section.settings.padding == 'default' %}-{{ section.settings.padding }}{% endunless %}" data-article-wrapper{% unless section.settings.show_progress_bar %} data-hide-progress{% endunless %}>
  <header class="section-header-spacing" data-tween-group="article-header-{{ section.id }}">
    <div class="{{ container_class }}">
      {% if section.settings.show_breadcrumbs %}
        {% render 'breadcrumbs' %}
      {% endif %}
      {%- capture back_text -%}{{ 'blog.back_to_blog' | t: blog: blog.title }}{%- endcapture -%}
      <div class="mb-[clamp(1rem,2vw,1.5rem)]" data-tween data-tween-type="fade-up">
        <a href="{{ blog.url }}" class="arrow-link arrow-link--uppercase">
          <i class="ph ph-arrow-left" aria-hidden="true"></i>
          <span data-hover="{{ back_text }}">{{ back_text }}</span>
        </a>
      </div>

      <h1 class="article-title" data-tween data-tween-type="split-text">
        {{ article.title }}
      </h1>

      {% if section.settings.show_author or section.settings.show_date or section.settings.show_reading_time %}
        <div class="flex flex-wrap items-center gap-6 mt-6 text-[0.8125rem] text-(--color-text-secondary)" data-tween data-tween-type="fade-up">
          {% if section.settings.show_author %}
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-(--color-background-secondary) flex items-center justify-center font-semibold text-sm text-(--color-text)">
                {{ article.author | slice: 0 | upcase }}
              </div>
              <p class="font-semibold text-(--color-text)">{{ article.author }}</p>
            </div>
          {% endif %}
          {% if section.settings.show_date %}
            <time class="article-hero-date flex items-center gap-2" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
              {{ article.published_at | date: '%B %d, %Y' }}
            </time>
          {% endif %}
          {% if section.settings.show_reading_time %}
            {% assign words = article.content | strip_html | split: ' ' | size %}
            {% assign reading_time = words | divided_by: 200 | plus: 1 %}
            <span class="article-hero-reading-time flex items-center gap-2">{{ 'blog.min_read' | t: minutes: reading_time }}</span>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </header>

  {% if article.image %}
    <div class="article-image relative mx-auto mb-16 overflow-hidden {{ container_class }}" data-tween data-tween-type="clip-right" data-tween-start="top bottom">
      {{ article.image | image_url: width: 1600 | image_tag:
        class: 'w-full h-auto block',
        loading: 'eager',
        decoding: 'async',
        sizes: '100vw',
        widths: '600, 900, 1200, 1600',
        alt: article.image.alt | default: article.title
      }}
    </div>
  {% endif %}

  <div class="{{ container_class }}">
    <div data-article-content>
      <div class="prose max-w-none">
        {{ article.content }}
      </div>

      {% if section.settings.show_tags and article.tags.size > 0 %}
        <div class="flex flex-wrap gap-2 mt-16 pt-8 border-t border-(--color-border)">
          {% for tag in article.tags %}
            <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="tag-pill">{{ tag }}</a>
          {% endfor %}
        </div>
      {% endif %}

      {% if section.settings.show_share %}
        <div class="flex items-center gap-4 mt-8">
          <span class="text-sm font-semibold uppercase tracking-widest text-(--color-text-secondary)">{{ 'general.share' | t }}</span>
          <div class="flex gap-3">
            <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ article.url }}&text={{ article.title | url_encode }}" target="_blank" rel="noopener" class="share-btn" aria-label="{{ 'accessibility.share_on_twitter' | t }}">
              <i class="ph ph-x-logo"></i>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ article.url }}" target="_blank" rel="noopener" class="share-btn" aria-label="{{ 'accessibility.share_on_facebook' | t }}">
              <i class="ph ph-facebook-logo"></i>
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ shop.url }}{{ article.url }}&title={{ article.title | url_encode }}" target="_blank" rel="noopener" class="share-btn" aria-label="{{ 'accessibility.share_on_linkedin' | t }}">
              <i class="ph ph-linkedin-logo"></i>
            </a>
            <button type="button" class="share-btn" aria-label="{{ 'accessibility.copy_link' | t }}" data-copy-link="{{ shop.url }}{{ article.url }}">
              <i class="ph ph-link"></i>
            </button>
          </div>
        </div>
      {% endif %}

      {% if section.settings.show_prev_next and blog.previous_article or section.settings.show_prev_next and blog.next_article %}
        <nav class="grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8 mt-16 pt-16 border-t border-(--color-border)">
          {% if blog.previous_article %}
            <a href="{{ blog.previous_article.url }}" class="flex flex-col gap-2 no-underline group">
              <span class="arrow-link arrow-link--uppercase">
                <i class="ph ph-arrow-left" aria-hidden="true"></i>
                <span data-hover="{{ 'general.previous' | t }}">{{ 'general.previous' | t }}</span>
              </span>
              <span class="text-base font-semibold text-(--color-text) group-hover:text-(--color-primary) transition-colors">{{ blog.previous_article.title | truncate: 50 }}</span>
            </a>
          {% else %}
            <div class="hidden sm:block"></div>
          {% endif %}

          {% if blog.next_article %}
            <a href="{{ blog.next_article.url }}" class="flex flex-col gap-2 sm:text-right sm:items-end no-underline group">
              <span class="arrow-link arrow-link--uppercase">
                <span data-hover="{{ 'general.next' | t }}">{{ 'general.next' | t }}</span>
                <i class="ph ph-arrow-right" aria-hidden="true"></i>
              </span>
              <span class="text-base font-semibold text-(--color-text) group-hover:text-(--color-primary) transition-colors">{{ blog.next_article.title | truncate: 50 }}</span>
            </a>
          {% endif %}
        </nav>
      {% endif %}

      {% if blog.comments_enabled? %}
        <div class="mt-24 pt-16 border-t border-(--color-border)">
          <h2 class="section-title">
            {{ 'blog.article_comments' | t }}{% if article.comments_count > 0 %} ({{ article.comments_count }}){% endif %}
          </h2>

          {% if article.comments_count > 0 %}
            <div>
              {% paginate article.comments by 10 %}
                {% for comment in article.comments %}
                  <div class="py-6 border-b border-(--color-border) last:border-b-0">
                    <div class="flex items-center gap-3 mb-3">
                      <div class="w-8 h-8 rounded-full bg-(--color-background-secondary) flex items-center justify-center font-semibold text-xs">
                        {{ comment.author | slice: 0 | upcase }}
                      </div>
                      <span class="font-semibold text-sm">{{ comment.author }}</span>
                      <span class="text-xs text-(--color-text-secondary)">{{ comment.created_at | date: '%b %d, %Y' }}</span>
                    </div>
                    <div class="text-[0.9375rem] leading-relaxed text-(--color-text-secondary)">
                      {{ comment.content }}
                    </div>
                  </div>
                {% endfor %}
              {% endpaginate %}
            </div>
          {% endif %}

          {% form 'new_comment', article %}
            <div class="mt-12">
              <h3 class="card-title mb-6">{{ 'blog.comment_form_title' | t }}</h3>

              {{ form.errors | default_errors }}

              <div class="grid gap-6">
                <div class="grid gap-6 sm:grid-cols-2">
                  <div>
                    <label for="comment-author" class="block text-sm font-semibold uppercase tracking-widest text-(--color-text-secondary) mb-2">{{ 'blog.comment_form_name' | t }}</label>
                    <input type="text" name="comment[author]" id="comment-author" value="{{ form.author }}" required class="w-full p-4 text-[0.9375rem] bg-transparent border border-(--color-border) text-(--color-text) focus:border-(--color-primary) focus:outline-none transition-colors duration-300">
                  </div>
                  <div>
                    <label for="comment-email" class="block text-sm font-semibold uppercase tracking-widest text-(--color-text-secondary) mb-2">{{ 'blog.comment_form_email' | t }}</label>
                    <input type="email" name="comment[email]" id="comment-email" value="{{ form.email }}" required class="w-full p-4 text-[0.9375rem] bg-transparent border border-(--color-border) text-(--color-text) focus:border-(--color-primary) focus:outline-none transition-colors duration-300">
                  </div>
                </div>

                <div>
                  <label for="comment-body" class="block text-sm font-semibold uppercase tracking-widest text-(--color-text-secondary) mb-2">{{ 'blog.comment_form_body' | t }}</label>
                  <textarea name="comment[body]" id="comment-body" required class="w-full p-4 text-[0.9375rem] bg-transparent border border-(--color-border) text-(--color-text) focus:border-(--color-primary) focus:outline-none transition-colors duration-300 min-h-[150px] resize-y">{{ form.body }}</textarea>
                </div>

                <div>
                  {%- assign btn_submit = 'blog.comment_form_submit' | t -%}
                  <button type="submit" class="btn btn--primary">
                    {% render 'button-text', text: btn_submit %}
                  </button>
                </div>
              </div>
            </div>
          {% endform %}
        </div>
      {% endif %}
    </div>
  </div>
</article>

<script>
(function() {
  // Copy link functionality
  function initCopyLink() {
    const copyButtons = document.querySelectorAll('[data-copy-link]');
    copyButtons.forEach(btn => {
      btn.addEventListener('click', async () => {
        const url = btn.dataset.copyLink;
        try {
          await navigator.clipboard.writeText(url);
          const icon = btn.querySelector('i');
          if (icon) {
            icon.className = 'ph ph-check';
            setTimeout(() => {
              icon.className = 'ph ph-link';
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCopyLink);
  } else {
    initCopyLink();
  }
})();
</script>

{% schema %}
{
  "name": "Article",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "label": "Show breadcrumbs",
      "default": false
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    },
    {
      "type": "select",
      "id": "padding",
      "label": "Section padding",
      "info": "Default padding is set in global theme settings",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "small", "label": "Small" },
        { "value": "large", "label": "Large" },
        { "value": "none", "label": "None" }
      ]
    },
    {
      "type": "header",
      "content": "Article details"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "default": true,
      "label": "Show date"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "default": true,
      "label": "Show author"
    },
    {
      "type": "checkbox",
      "id": "show_reading_time",
      "default": true,
      "label": "Show reading time"
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "default": true,
      "label": "Show tags"
    },
    {
      "type": "checkbox",
      "id": "show_share",
      "default": true,
      "label": "Show share buttons"
    },
    {
      "type": "checkbox",
      "id": "show_prev_next",
      "default": true,
      "label": "Show previous/next navigation"
    },
    {
      "type": "checkbox",
      "id": "show_progress_bar",
      "default": true,
      "label": "Show reading progress bar"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
  }
{% endschema %}
