{%- comment -%}
  Password Section - Modern design with GSAP animations
  Used when password protection is applied to a store.
{%- endcomment -%}

<div class="password-wrapper is-loading min-h-screen flex" data-password-wrapper>
  {%- comment -%} Left Side - Form {%- endcomment -%}
  <div class="w-full lg:w-1/2 flex items-center justify-center px-6 py-12 lg:px-12">
    <div class="w-full max-w-md">
      {%- comment -%} Logo {%- endcomment -%}
      <div class="password-logo mb-12">
        {% render 'logo', loading: 'eager' %}
      </div>

      {%- comment -%} Lock Icon {%- endcomment -%}
      <div class="password-animate mb-6">
        <div class="w-16 h-16 bg-(--color-background-secondary) flex items-center justify-center">
          <i class="ph ph-lock-simple text-3xl text-(--color-text)"></i>
        </div>
      </div>

      {%- comment -%} Title {%- endcomment -%}
      <h1 class="password-animate page-title">
        {% if section.settings.heading != blank %}
          {{ section.settings.heading }}
        {% else %}
          {{ 'password.title' | t }}
        {% endif %}
      </h1>

      {%- comment -%} Message {%- endcomment -%}
      <div class="password-animate mt-6">
        {% if shop.password_message != blank %}
          <p class="text-lg text-(--color-text-secondary) leading-relaxed">
            {{ shop.password_message }}
          </p>
        {% elsif section.settings.subheading != blank %}
          <p class="text-lg text-(--color-text-secondary) leading-relaxed">
            {{ section.settings.subheading }}
          </p>
        {% else %}
          <p class="text-lg text-(--color-text-secondary) leading-relaxed">
            {{ 'password.subtitle' | t }}
          </p>
        {% endif %}
      </div>

      {%- comment -%} Password Form {%- endcomment -%}
      <div class="password-animate mt-10">
        {% form 'storefront_password' %}
          {% if form.errors %}
            <div class="mb-6 p-4 bg-red-50 border border-red-200 text-red-700 text-sm flex items-center gap-3">
              <i class="ph ph-warning-circle text-lg flex-shrink-0"></i>
              <span>{{ form.errors | default_errors }}</span>
            </div>
          {% endif %}

          <div class="space-y-4">
            <div>
              <label for="password-input" class="block text-sm uppercase tracking-wider font-medium text-(--color-text-secondary) mb-2">
                {{ 'password.password' | t }}
              </label>
              <input
                type="password"
                name="password"
                id="password-input"
                autocomplete="current-password"
                placeholder="{{ 'password.placeholder' | t }}"
                class="password-form-input w-full px-5 py-4 text-base bg-transparent border border-(--color-border) text-(--color-text) placeholder-(--color-text-secondary) focus:outline-none"
              >
            </div>

            {%- capture password_btn_text -%}{{ 'password.enter' | t }}{%- endcapture -%}
            <button type="submit" class="btn btn--primary btn--lg btn--full">
              <i class="ph ph-key"></i>
              {%- if settings.button_hover_slide_text -%}
                <span data-hover="{{ password_btn_text }}"><span>{{ password_btn_text }}</span></span>
              {%- else -%}
                <span>{{ password_btn_text }}</span>
              {%- endif -%}
            </button>
          </div>
        {% endform %}
      </div>

      {%- comment -%} Newsletter Signup {%- endcomment -%}
      {% if section.settings.show_newsletter %}
        <div class="password-animate mt-12 pt-12 border-t border-(--color-border)">
          <h3 class="card-title mb-2">
            {% if section.settings.newsletter_heading != blank %}
              {{ section.settings.newsletter_heading }}
            {% else %}
              {{ 'password.newsletter_heading' | t }}
            {% endif %}
          </h3>
          <p class="text-sm text-(--color-text-secondary) mb-5">
            {% if section.settings.newsletter_text != blank %}
              {{ section.settings.newsletter_text }}
            {% else %}
              {{ 'password.newsletter_text' | t }}
            {% endif %}
          </p>

          {% form 'customer', class: 'newsletter-form' %}
            <input type="hidden" name="contact[tags]" value="newsletter,password-page">
            <div class="flex gap-2">
              <input
                type="email"
                name="contact[email]"
                placeholder="{{ 'general.newsletter.label' | t }}"
                required
                class="password-form-input flex-1 h-10 px-4 text-sm bg-transparent border border-(--color-border) text-(--color-text) placeholder-(--color-text-secondary) focus:outline-none"
              >
              <button type="submit" class="btn btn--primary btn--sm">
                <i class="ph ph-paper-plane-tilt"></i>
              </button>
            </div>
            {% if form.posted_successfully? %}
              <p class="mt-3 text-sm text-green-600 flex items-center gap-2">
                <i class="ph ph-check-circle"></i>
                {{ 'general.newsletter.success' | t }}
              </p>
            {% endif %}
          {% endform %}
        </div>
      {% endif %}

      {%- comment -%} Social Links {%- endcomment -%}
      {% if section.settings.show_social %}
        <div class="password-animate mt-10 flex items-center gap-4">
          {% if settings.social_twitter_link != blank %}
            <a href="{{ settings.social_twitter_link }}" target="_blank" rel="noopener" class="text-(--color-text-secondary) hover:text-(--color-text) transition-colors" aria-label="{{ 'social.twitter' | t }}">
              <i class="ph ph-x-logo text-xl"></i>
            </a>
          {% endif %}
          {% if settings.social_instagram_link != blank %}
            <a href="{{ settings.social_instagram_link }}" target="_blank" rel="noopener" class="text-(--color-text-secondary) hover:text-(--color-text) transition-colors" aria-label="{{ 'social.instagram' | t }}">
              <i class="ph ph-instagram-logo text-xl"></i>
            </a>
          {% endif %}
          {% if settings.social_facebook_link != blank %}
            <a href="{{ settings.social_facebook_link }}" target="_blank" rel="noopener" class="text-(--color-text-secondary) hover:text-(--color-text) transition-colors" aria-label="{{ 'social.facebook' | t }}">
              <i class="ph ph-facebook-logo text-xl"></i>
            </a>
          {% endif %}
          {% if settings.social_tiktok_link != blank %}
            <a href="{{ settings.social_tiktok_link }}" target="_blank" rel="noopener" class="text-(--color-text-secondary) hover:text-(--color-text) transition-colors" aria-label="{{ 'social.tiktok' | t }}">
              <i class="ph ph-tiktok-logo text-xl"></i>
            </a>
          {% endif %}
          {% if settings.social_pinterest_link != blank %}
            <a href="{{ settings.social_pinterest_link }}" target="_blank" rel="noopener" class="text-(--color-text-secondary) hover:text-(--color-text) transition-colors" aria-label="{{ 'social.pinterest' | t }}">
              <i class="ph ph-pinterest-logo text-xl"></i>
            </a>
          {% endif %}
        </div>
      {% endif %}

      {%- comment -%} Footer {%- endcomment -%}
      <div class="password-animate mt-12 pt-8 border-t border-(--color-border)">
        <p class="text-xs text-(--color-text-secondary)">
          {{ 'password.admin_link_html' | t }}
          <a href="/admin" class="text-(--color-text) hover:text-(--color-primary) underline ml-1">
            {{ 'password.login' | t }}
          </a>
        </p>
      </div>
    </div>
  </div>

  {%- comment -%} Right Side - Visual {%- endcomment -%}
  <div class="password-visual hidden lg:block lg:w-1/2 bg-(--color-background-secondary)">
    <div class="password-visual-pattern"></div>
    {% if section.settings.image %}
      <div class="relative h-full" data-password-image>
        {{ section.settings.image | image_url: width: 1600 | image_tag:
          class: 'w-full h-full object-cover',
          loading: 'eager',
          decoding: 'async',
          alt: section.settings.image.alt | default: shop.name
        }}
      </div>
    {% else %}
      <div class="h-full flex items-center justify-center">
        <div class="text-center">
          <i class="ph ph-lock-simple text-[10rem] text-(--color-text) opacity-5"></i>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script>
(function() {
  const wrapper = document.querySelector('[data-password-wrapper]');
  if (!wrapper) return;
  if (wrapper.dataset.passwordInitialized) return;
  wrapper.dataset.passwordInitialized = 'true';

  // If animations disabled, just show content
  if (typeof window.shouldAnimate === 'function' && !window.shouldAnimate()) {
    wrapper.classList.remove('is-loading');
    wrapper.classList.add('is-ready');
    return;
  }

  function initPassword() {
    let gsap = window.gsap;
    if (!gsap && window.pieces && window.pieces.gsap) {
      gsap = window.pieces.gsap;
    }

    if (!gsap) {
      // Fallback without GSAP
      wrapper.classList.remove('is-loading');
      wrapper.classList.add('is-ready');
      return;
    }

    const tl = gsap.timeline({
      onComplete: () => wrapper.classList.add('is-ready')
    });

    // Logo reveal
    const logo = wrapper.querySelector('.password-logo');
    if (logo) {
      gsap.set(logo, { opacity: 0, scale: 0.9 });
      tl.to(logo, {
        opacity: 1,
        scale: 1,
        duration: 0.6,
        ease: 'power3.out'
      }, 0);
    }

    // Content reveal (staggered)
    const animateEls = wrapper.querySelectorAll('.password-animate');
    if (animateEls.length) {
      gsap.set(animateEls, { opacity: 0, y: 30 });
      tl.to(animateEls, {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: 'power3.out',
        stagger: 0.1
      }, 0.2);
    }

    // Image reveal (clip-path)
    const imageContainer = wrapper.querySelector('[data-password-image]');
    if (imageContainer) {
      gsap.set(imageContainer, { clipPath: 'inset(0 100% 0 0)' });
      tl.to(imageContainer, {
        clipPath: 'inset(0 0% 0 0)',
        duration: 1.2,
        ease: 'power4.inOut'
      }, 0.3);
    }

    wrapper.classList.remove('is-loading');
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initPassword);
  } else {
    initPassword();
  }
})();
</script>

{% schema %}
{
  "name": "t:sections.password.name",
  "tag": "section",
  "class": "password-section no-header-offset",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "t:shared.settings.heading.label",
      "default": "t:sections.password.settings.heading.default"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "t:sections.password.settings.subheading.label",
      "default": "t:sections.password.settings.subheading.default"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:shared.settings.image.label",
      "info": "t:sections.password.settings.image.info"
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__newsletter.content"
    },
    {
      "type": "checkbox",
      "id": "show_newsletter",
      "label": "t:sections.password.settings.show_newsletter.label",
      "default": true
    },
    {
      "type": "text",
      "id": "newsletter_heading",
      "label": "t:sections.password.settings.newsletter_heading.label",
      "default": "t:sections.password.settings.newsletter_heading.default"
    },
    {
      "type": "textarea",
      "id": "newsletter_text",
      "label": "t:sections.password.settings.newsletter_text.label",
      "default": "t:sections.password.settings.newsletter_text.default"
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__social.content"
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "t:sections.password.settings.show_social.label",
      "default": true,
      "info": "t:sections.password.settings.show_social.info"
    }
  ],
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  }
}
{% endschema %}
