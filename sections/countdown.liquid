{%- comment -%}
  Countdown Section
  Animated countdown timer to a specific date
  Hides automatically when the target date has passed

  Designs:
  - Hero: Large dramatic countdown with title, subtitle, and CTA
  - Compact: Medium-sized countdown, good for mid-page placement
  - Minimal: Inline countdown perfect for headers and announcement bars
{%- endcomment -%}

{%- liquid
  assign design = section.settings.design

  if section.settings.full_width or design == 'minimal'
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif
-%}

<style>
  .countdown-{{ section.id }} {
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
  }

  .countdown-{{ section.id }}.is-expired {
    display: none;
  }

  {% case design %}
  {% when 'hero' %}
  /* ============================================
     HERO DESIGN - Large dramatic countdown
     ============================================ */
  .countdown-{{ section.id }} {
    padding: var(--section-vertical-padding) 0;
  }

  .countdown-grid-{{ section.id }} {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .countdown-grid-{{ section.id }} {
      grid-template-columns: repeat(4, 1fr);
      gap: 2rem;
    }
  }

  @media (min-width: 1024px) {
    .countdown-grid-{{ section.id }} {
      gap: 4rem;
    }
  }

  .countdown-item-{{ section.id }} {
    text-align: center;
    opacity: 0;
    transform: translateY(30px);
  }

  .countdown-item-{{ section.id }}.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .countdown-value-{{ section.id }} {
    display: flex;
    align-items: baseline;
    justify-content: center;
    font-size: calc(clamp(3rem, 12vw, 7rem) * var(--heading-font-scale, 1));
    font-weight: 700;
    font-family: var(--font-heading);
    line-height: 1;
    letter-spacing: -0.03em;
    min-width: 2ch;
  }

  .countdown-label-{{ section.id }} {
    margin-top: 0.75rem;
    font-size: clamp(0.65rem, 1.5vw, 0.75rem);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    opacity: 0.5;
  }

  .countdown-header-{{ section.id }} {
    text-align: {{ section.settings.content_alignment }};
    margin-bottom: 4rem;
  }

  /* Title uses global .section-title, subtitle uses .section-description from utilities.css */
  .countdown-header-{{ section.id }} .section-description {
    max-width: 600px;
    {% if section.settings.content_alignment == 'center' %}
    margin-left: auto;
    margin-right: auto;
    {% elsif section.settings.content_alignment == 'right' %}
    margin-left: auto;
    {% endif %}
  }

  .countdown-cta-{{ section.id }} {
    margin-top: 3rem;
    text-align: {{ section.settings.content_alignment }};
  }

  .countdown-cta-{{ section.id }} .btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 2rem;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    {% if section.settings.button_style == 'solid' %}
    color: {{ section.settings.background_color }};
    background: {{ section.settings.text_color }};
    border: var(--button-border-width) solid {{ section.settings.text_color }};
    {% else %}
    color: {{ section.settings.text_color }};
    background: transparent;
    border: var(--button-border-width) solid {{ section.settings.text_color }};
    {% endif %}
    box-shadow: {% case settings.button_shadow %}{% when 'sm' %}0 1px 2px 0 rgb(0 0 0 / 0.05){% when 'md' %}0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1){% when 'hard' %}4px 4px 0 0 {{ section.settings.text_color }}{% else %}none{% endcase %};
    border-radius: var(--button-radius, 4px);
    overflow: hidden;
    transition: color 0.4s ease;
  }

  .countdown-cta-{{ section.id }} .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    {% if section.settings.button_style == 'solid' %}
    background: {{ section.settings.background_color }};
    {% else %}
    background: {{ section.settings.text_color }};
    {% endif %}
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
    pointer-events: none;
  }

  .countdown-cta-{{ section.id }} .btn:hover::before {
    transform: scaleX(1);
    transform-origin: left;
  }

  .countdown-cta-{{ section.id }} .btn:hover {
    {% if section.settings.button_style == 'solid' %}
    color: {{ section.settings.text_color }};
    {% else %}
    color: {{ section.settings.background_color }};
    {% endif %}
  }

  .countdown-cta-{{ section.id }} .btn span,
  .countdown-cta-{{ section.id }} .btn i {
    position: relative;
    z-index: 1;
  }

  /* Email signup form for hero */
  .countdown-form-{{ section.id }} {
    margin-top: 3rem;
    {% if section.settings.content_alignment == 'center' %}
    display: flex;
    justify-content: center;
    {% endif %}
  }

  .countdown-form-{{ section.id }} .countdown-form-inner {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    width: 100%;
    max-width: 400px;
  }

  @media (min-width: 640px) {
    .countdown-form-{{ section.id }} .countdown-form-inner {
      flex-direction: row;
      gap: 0.5rem;
    }
  }

  .countdown-form-{{ section.id }} input[type="email"] {
    flex: 1;
    min-width: 0;
    padding: 0.875rem 1rem;
    font-size: 0.875rem;
    background: transparent;
    border: 1px solid {{ section.settings.text_color }}40;
    border-radius: var(--input-radius, 4px);
    color: {{ section.settings.text_color }};
    caret-color: {{ section.settings.text_color }};
    transition: border-color 0.2s ease;
  }

  .countdown-form-{{ section.id }} input[type="email"]::placeholder {
    color: {{ section.settings.text_color }};
    opacity: 0.5;
  }

  .countdown-form-{{ section.id }} input[type="email"]:focus {
    outline: none;
    border-color: {{ section.settings.text_color }};
  }

  .countdown-form-{{ section.id }} .countdown-form-btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    white-space: nowrap;
    color: {{ section.settings.text_color }};
    background: transparent;
    border: 1px solid {{ section.settings.text_color }};
    border-radius: var(--button-radius, 4px);
    cursor: pointer;
    overflow: hidden;
    transition: color 0.4s ease;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: {{ section.settings.text_color }};
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
    pointer-events: none;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn:hover::before {
    transform: scaleX(1);
    transform-origin: left;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn:hover {
    color: {{ section.settings.background_color }};
  }

  .countdown-form-{{ section.id }} .countdown-form-btn span,
  .countdown-form-{{ section.id }} .countdown-form-btn i {
    position: relative;
    z-index: 1;
  }

  .countdown-form-{{ section.id }} .countdown-form-message {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    {% if section.settings.content_alignment == 'center' %}
    text-align: center;
    {% endif %}
  }

  .countdown-form-{{ section.id }} .countdown-form-message.success {
    color: #22c55e;
  }

  .countdown-form-{{ section.id }} .countdown-form-message.error {
    color: #ef4444;
  }

  /* Divider style for hero */
  {% if section.settings.show_dividers %}
  .countdown-item-{{ section.id }} {
    position: relative;
  }

  .countdown-item-{{ section.id }}:not(:last-child)::after {
    content: ':';
    position: absolute;
    right: -0.75rem;
    top: 0;
    font-size: calc(clamp(2rem, 8vw, 4rem) * var(--heading-font-scale, 1));
    font-weight: 700;
    font-family: var(--font-heading);
    opacity: 0.3;
  }

  @media (max-width: 639px) {
    .countdown-item-{{ section.id }}:nth-child(2)::after {
      display: none;
    }
  }

  @media (min-width: 640px) {
    .countdown-item-{{ section.id }}:not(:last-child)::after {
      right: -1rem;
    }
  }

  @media (min-width: 1024px) {
    .countdown-item-{{ section.id }}:not(:last-child)::after {
      right: -2rem;
    }
  }
  {% endif %}

  {% when 'compact' %}
  /* ============================================
     COMPACT DESIGN - Medium-sized countdown
     ============================================ */
  .countdown-{{ section.id }} {
    padding: clamp(2rem, 4vw, 3rem) 0;
  }

  .countdown-inner-{{ section.id }} {
    display: flex;
    flex-direction: column;
    align-items: {{ section.settings.content_alignment }};
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .countdown-inner-{{ section.id }} {
      flex-direction: row;
      justify-content: {{ section.settings.content_alignment }};
      align-items: center;
      gap: 3rem;
    }
  }

  .countdown-header-{{ section.id }} {
    text-align: {{ section.settings.content_alignment }};
  }

  @media (min-width: 768px) {
    .countdown-header-{{ section.id }} {
      text-align: left;
    }
  }

  .countdown-title-{{ section.id }} {
    font-size: calc(clamp(1.25rem, 3vw, 1.75rem) * var(--heading-font-scale, 1));
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .countdown-subtitle-{{ section.id }} {
    margin-top: 0.5rem;
    font-size: clamp(0.75rem, 1.2vw, 0.875rem);
    opacity: 0.7;
  }

  .countdown-grid-{{ section.id }} {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
  }

  @media (min-width: 640px) {
    .countdown-grid-{{ section.id }} {
      gap: 0.75rem;
    }
  }

  .countdown-item-{{ section.id }} {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0;
    transform: translateY(20px);
  }

  .countdown-item-inner-{{ section.id }} {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .countdown-item-{{ section.id }}.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .countdown-value-{{ section.id }} {
    font-size: calc(clamp(1.25rem, 3.5vw, 1.75rem) * var(--heading-font-scale, 1));
    font-weight: 700;
    font-family: var(--font-heading);
    line-height: 1;
    letter-spacing: -0.02em;
    min-width: 2ch;
  }

  .countdown-label-{{ section.id }} {
    margin-top: 0.2rem;
    font-size: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    opacity: 0.5;
  }

  .countdown-cta-{{ section.id }} .btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: {{ section.settings.text_color }};
    background: transparent;
    border: 1px solid {{ section.settings.text_color }};
    border-radius: var(--button-radius, 4px);
    overflow: hidden;
    transition: color 0.4s ease;
  }

  .countdown-cta-{{ section.id }} .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: {{ section.settings.text_color }};
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
    pointer-events: none;
  }

  .countdown-cta-{{ section.id }} .btn:hover::before {
    transform: scaleX(1);
    transform-origin: left;
  }

  .countdown-cta-{{ section.id }} .btn:hover {
    color: {{ section.settings.background_color }};
  }

  .countdown-cta-{{ section.id }} .btn span,
  .countdown-cta-{{ section.id }} .btn i {
    position: relative;
    z-index: 1;
  }

  /* Divider style for compact */
  .countdown-divider-{{ section.id }} {
    font-size: calc(clamp(1rem, 2.5vw, 1.25rem) * var(--heading-font-scale, 1));
    font-weight: 600;
    opacity: 0.3;
    line-height: 1;
    align-self: flex-start;
    padding-top: 0.1em;
  }

  /* Email signup form for compact */
  .countdown-form-{{ section.id }} {
    flex-shrink: 0;
  }

  .countdown-form-{{ section.id }} .countdown-form-inner {
    display: flex;
    gap: 0.5rem;
  }

  .countdown-form-{{ section.id }} input[type="email"] {
    width: 200px;
    padding: 0.625rem 0.875rem;
    font-size: 0.8rem;
    background: transparent;
    border: 1px solid {{ section.settings.text_color }}40;
    border-radius: var(--input-radius, 4px);
    color: {{ section.settings.text_color }};
    caret-color: {{ section.settings.text_color }};
    transition: border-color 0.2s ease;
  }

  .countdown-form-{{ section.id }} input[type="email"]::placeholder {
    color: {{ section.settings.text_color }};
    opacity: 0.5;
  }

  .countdown-form-{{ section.id }} input[type="email"]:focus {
    outline: none;
    border-color: {{ section.settings.text_color }};
  }

  .countdown-form-{{ section.id }} .countdown-form-btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    white-space: nowrap;
    color: {{ section.settings.text_color }};
    background: transparent;
    border: 1px solid {{ section.settings.text_color }};
    border-radius: var(--button-radius, 4px);
    cursor: pointer;
    overflow: hidden;
    transition: color 0.4s ease;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: {{ section.settings.text_color }};
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
    pointer-events: none;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn:hover::before {
    transform: scaleX(1);
    transform-origin: left;
  }

  .countdown-form-{{ section.id }} .countdown-form-btn:hover {
    color: {{ section.settings.background_color }};
  }

  .countdown-form-{{ section.id }} .countdown-form-btn span {
    position: relative;
    z-index: 1;
  }

  .countdown-form-{{ section.id }} .countdown-form-message {
    position: absolute;
    margin-top: 0.5rem;
    font-size: 0.75rem;
  }

  .countdown-form-{{ section.id }} .countdown-form-message.success {
    color: #22c55e;
  }

  .countdown-form-{{ section.id }} .countdown-form-message.error {
    color: #ef4444;
  }

  {% when 'minimal' %}
  /* ============================================
     MINIMAL DESIGN - Inline for headers/announcements
     ============================================ */
  .countdown-{{ section.id }} {
    padding: 0.75rem 0;
  }

  .countdown-inner-{{ section.id }} {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 0.5rem 1rem;
  }

  .countdown-text-{{ section.id }} {
    font-size: clamp(0.7rem, 1.2vw, 0.8rem);
    font-weight: 500;
    letter-spacing: 0.05em;
  }

  .countdown-grid-{{ section.id }} {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-family: var(--font-heading);
    font-weight: 600;
    font-size: clamp(0.75rem, 1.2vw, 0.875rem);
    letter-spacing: 0.02em;
  }

  .countdown-item-{{ section.id }} {
    display: flex;
    align-items: center;
    gap: 0.15rem;
  }

  .countdown-value-{{ section.id }} {
    font-variant-numeric: tabular-nums;
    min-width: 1.5ch;
  }

  .countdown-label-{{ section.id }} {
    font-size: 0.65em;
    text-transform: uppercase;
    opacity: 0.7;
  }

  .countdown-separator-{{ section.id }} {
    opacity: 0.4;
    margin: 0 0.15rem;
  }

  .countdown-cta-{{ section.id }} .btn {
    font-size: clamp(0.65rem, 1vw, 0.75rem);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    text-decoration: underline;
    text-underline-offset: 2px;
    color: {{ section.settings.text_color }};
    opacity: 0.9;
    transition: opacity 0.2s ease;
  }

  .countdown-cta-{{ section.id }} .btn:hover {
    opacity: 1;
  }
  {% endcase %}

  /* Reduced motion fallback */
  @media (prefers-reduced-motion: reduce) {
    .countdown-item-{{ section.id }} {
      opacity: 1;
      transform: none;
    }
  }
</style>

{% case design %}
{% when 'hero' %}
{%- comment -%} HERO DESIGN {%- endcomment -%}
<section class="countdown-{{ section.id }}" data-countdown="{{ section.id }}" data-target-date="{{ section.settings.target_date }}" data-design="hero">
  <div class="{{ container_class }}">
    {% if section.settings.title != blank or section.settings.subtitle != blank %}
      <header class="countdown-header-{{ section.id }}" data-tween-group="countdown-header-{{ section.id }}">
        {% if section.settings.title != blank %}
          <h2 class="section-title font-heading" data-tween data-tween-type="split-text">{{ section.settings.title }}</h2>
        {% endif %}
        {% if section.settings.subtitle != blank %}
          <p class="section-description mt-4" data-tween data-tween-type="fade-up">{{ section.settings.subtitle }}</p>
        {% endif %}
      </header>
    {% endif %}

    <div class="countdown-grid-{{ section.id }}">
      <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 0ms;">
        <div class="countdown-value-{{ section.id }}" data-countdown-days>00</div>
        <p class="countdown-label-{{ section.id }}">{{ section.settings.days_label }}</p>
      </div>
      <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 150ms;">
        <div class="countdown-value-{{ section.id }}" data-countdown-hours>00</div>
        <p class="countdown-label-{{ section.id }}">{{ section.settings.hours_label }}</p>
      </div>
      <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 300ms;">
        <div class="countdown-value-{{ section.id }}" data-countdown-minutes>00</div>
        <p class="countdown-label-{{ section.id }}">{{ section.settings.minutes_label }}</p>
      </div>
      <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 450ms;">
        <div class="countdown-value-{{ section.id }}" data-countdown-seconds>00</div>
        <p class="countdown-label-{{ section.id }}">{{ section.settings.seconds_label }}</p>
      </div>
    </div>

    {% if section.settings.cta_type == 'link' and section.settings.button_text != blank and section.settings.button_link != blank %}
      <div class="countdown-cta-{{ section.id }}" data-tween data-tween-type="fade-up">
        <a href="{{ section.settings.button_link }}" class="btn">
          <span>{{ section.settings.button_text }}</span>
          <i class="ph ph-arrow-right"></i>
        </a>
      </div>
    {% elsif section.settings.cta_type == 'email_form' %}
      <div class="countdown-form-{{ section.id }}" data-countdown-form data-tween data-tween-type="fade-up">
        {% form 'customer', id: 'countdown-form-hero' %}
          <div class="countdown-form-inner">
            <input
              type="email"
              name="contact[email]"
              placeholder="{{ section.settings.form_placeholder | default: 'Enter your email' }}"
              required
              autocomplete="email"
            >
            <input type="hidden" name="contact[tags]" value="countdown,notify">
            <button type="submit" class="countdown-form-btn">
              <span>{{ section.settings.button_text | default: 'Notify Me' }}</span>
            </button>
          </div>
          <div class="countdown-form-message" style="display: none;" data-form-message></div>
          {% if form.posted_successfully? %}
            <p class="countdown-form-message success">{{ 'general.newsletter.success' | t }}</p>
          {% endif %}
          {% if form.errors %}
            <p class="countdown-form-message error">{{ form.errors.messages['email'] }}</p>
          {% endif %}
        {% endform %}
      </div>
    {% endif %}
  </div>
</section>

{% when 'compact' %}
{%- comment -%} COMPACT DESIGN {%- endcomment -%}
<section class="countdown-{{ section.id }}" data-countdown="{{ section.id }}" data-target-date="{{ section.settings.target_date }}" data-design="compact">
  <div class="{{ container_class }}">
    <div class="countdown-inner-{{ section.id }}" data-tween-group="countdown-compact-{{ section.id }}">
      {% if section.settings.title != blank or section.settings.subtitle != blank %}
        <div class="countdown-header-{{ section.id }}">
          {% if section.settings.title != blank %}
            <h2 class="countdown-title-{{ section.id }} font-heading" data-tween data-tween-type="fade-up">{{ section.settings.title }}</h2>
          {% endif %}
          {% if section.settings.subtitle != blank %}
            <p class="countdown-subtitle-{{ section.id }}" data-tween data-tween-type="fade-up">{{ section.settings.subtitle }}</p>
          {% endif %}
        </div>
      {% endif %}

      <div class="countdown-grid-{{ section.id }}">
        <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 0ms;">
          <div class="countdown-item-inner-{{ section.id }}">
            <div class="countdown-value-{{ section.id }}" data-countdown-days>00</div>
            <p class="countdown-label-{{ section.id }}">{{ section.settings.days_label }}</p>
          </div>
          {% if section.settings.show_dividers %}<span class="countdown-divider-{{ section.id }}">:</span>{% endif %}
        </div>
        <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 100ms;">
          <div class="countdown-item-inner-{{ section.id }}">
            <div class="countdown-value-{{ section.id }}" data-countdown-hours>00</div>
            <p class="countdown-label-{{ section.id }}">{{ section.settings.hours_label }}</p>
          </div>
          {% if section.settings.show_dividers %}<span class="countdown-divider-{{ section.id }}">:</span>{% endif %}
        </div>
        <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 200ms;">
          <div class="countdown-item-inner-{{ section.id }}">
            <div class="countdown-value-{{ section.id }}" data-countdown-minutes>00</div>
            <p class="countdown-label-{{ section.id }}">{{ section.settings.minutes_label }}</p>
          </div>
          {% if section.settings.show_dividers %}<span class="countdown-divider-{{ section.id }}">:</span>{% endif %}
        </div>
        <div class="countdown-item-{{ section.id }}" data-countdown-item style="transition-delay: 300ms;">
          <div class="countdown-item-inner-{{ section.id }}">
            <div class="countdown-value-{{ section.id }}" data-countdown-seconds>00</div>
            <p class="countdown-label-{{ section.id }}">{{ section.settings.seconds_label }}</p>
          </div>
        </div>
      </div>

      {% if section.settings.cta_type == 'link' and section.settings.button_text != blank and section.settings.button_link != blank %}
        <div class="countdown-cta-{{ section.id }}" data-tween data-tween-type="fade-up">
          <a href="{{ section.settings.button_link }}" class="btn">
            <span>{{ section.settings.button_text }}</span>
            <i class="ph ph-arrow-right"></i>
          </a>
        </div>
      {% elsif section.settings.cta_type == 'email_form' %}
        <div class="countdown-form-{{ section.id }}" data-countdown-form data-tween data-tween-type="fade-up">
          {% form 'customer', id: 'countdown-form-compact' %}
            <div class="countdown-form-inner">
              <input
                type="email"
                name="contact[email]"
                placeholder="{{ section.settings.form_placeholder | default: 'Enter your email' }}"
                required
                autocomplete="email"
              >
              <input type="hidden" name="contact[tags]" value="countdown,notify">
              <button type="submit" class="countdown-form-btn">
                <span>{{ section.settings.button_text | default: 'Notify Me' }}</span>
              </button>
            </div>
            {% if form.posted_successfully? %}
              <p class="countdown-form-message success">{{ 'general.newsletter.success' | t }}</p>
            {% endif %}
            {% if form.errors %}
              <p class="countdown-form-message error">{{ form.errors.messages['email'] }}</p>
            {% endif %}
          {% endform %}
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% when 'minimal' %}
{%- comment -%} MINIMAL DESIGN - for headers/announcements {%- endcomment -%}
<div class="countdown-{{ section.id }}" data-countdown="{{ section.id }}" data-target-date="{{ section.settings.target_date }}" data-design="minimal">
  <div class="{{ container_class }}">
    <div class="countdown-inner-{{ section.id }}">
      {% if section.settings.title != blank %}
        <span class="countdown-text-{{ section.id }}">{{ section.settings.title }}</span>
      {% endif %}

      <div class="countdown-grid-{{ section.id }}">
        <div class="countdown-item-{{ section.id }}">
          <span class="countdown-value-{{ section.id }}" data-countdown-days>00</span>
          <span class="countdown-label-{{ section.id }}">{{ section.settings.days_label | slice: 0 }}</span>
        </div>
        <span class="countdown-separator-{{ section.id }}">:</span>
        <div class="countdown-item-{{ section.id }}">
          <span class="countdown-value-{{ section.id }}" data-countdown-hours>00</span>
          <span class="countdown-label-{{ section.id }}">{{ section.settings.hours_label | slice: 0 }}</span>
        </div>
        <span class="countdown-separator-{{ section.id }}">:</span>
        <div class="countdown-item-{{ section.id }}">
          <span class="countdown-value-{{ section.id }}" data-countdown-minutes>00</span>
          <span class="countdown-label-{{ section.id }}">{{ section.settings.minutes_label | slice: 0 }}</span>
        </div>
        <span class="countdown-separator-{{ section.id }}">:</span>
        <div class="countdown-item-{{ section.id }}">
          <span class="countdown-value-{{ section.id }}" data-countdown-seconds>00</span>
          <span class="countdown-label-{{ section.id }}">{{ section.settings.seconds_label | slice: 0 }}</span>
        </div>
      </div>

      {% comment %} Minimal design only supports link (not email form - too small) {% endcomment %}
      {% if section.settings.button_text != blank and section.settings.button_link != blank %}
        <div class="countdown-cta-{{ section.id }}">
          <a href="{{ section.settings.button_link }}" class="btn">{{ section.settings.button_text }}</a>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endcase %}

<script>
  (function() {
    const section = document.querySelector('[data-countdown="{{ section.id }}"]');
    if (!section || section.dataset.initialized) return;
    section.dataset.initialized = 'true';

    const targetDateStr = section.dataset.targetDate;
    const design = section.dataset.design;

    if (!targetDateStr) {
      section.classList.add('is-expired');
      return;
    }

    const targetDate = new Date(targetDateStr + 'T00:00:00').getTime();
    const items = section.querySelectorAll('[data-countdown-item]');
    const daysEl = section.querySelector('[data-countdown-days]');
    const hoursEl = section.querySelector('[data-countdown-hours]');
    const minutesEl = section.querySelector('[data-countdown-minutes]');
    const secondsEl = section.querySelector('[data-countdown-seconds]');

    // Check if already expired
    if (Date.now() >= targetDate) {
      section.classList.add('is-expired');
      return;
    }

    // Check if animations should run
    const shouldAnimate = typeof window.shouldAnimate === 'function' ? window.shouldAnimate() : true;

    // Minimal design doesn't need entrance animations
    if (design === 'minimal' || !shouldAnimate) {
      items.forEach(item => item.classList.add('is-visible'));
      updateCountdown();
      startCountdown();

      if (design !== 'minimal' && !shouldAnimate) return;
      if (design === 'minimal') return;
    }

    // Title animations handled by global TweenManager via data-tween attributes

    // Intersection observer for items animation
    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -10% 0px',
      threshold: 0.1
    };

    let hasAnimated = false;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !hasAnimated) {
          hasAnimated = true;

          items.forEach(item => {
            item.classList.add('is-visible');
          });

          // Start countdown after animation
          setTimeout(() => {
            startCountdown();
          }, design === 'hero' ? 600 : 400);

          observer.disconnect();
        }
      });
    }, observerOptions);

    observer.observe(section);

    // Update countdown display
    function updateCountdown() {
      const now = Date.now();
      const distance = targetDate - now;

      if (distance <= 0) {
        section.classList.add('is-expired');
        return false;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
      if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
      if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
      if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');

      return true;
    }

    // Start the countdown interval
    function startCountdown() {
      updateCountdown();
      const interval = setInterval(() => {
        if (!updateCountdown()) {
          clearInterval(interval);
        }
      }, 1000);
    }

    // Initial update
    updateCountdown();
  })();
</script>

{% schema %}
{
  "name": "Countdown",
  "tag": "section",
  "class": "countdown-section",
  "settings": [
    {
      "type": "header",
      "content": "Design"
    },
    {
      "type": "select",
      "id": "design",
      "label": "Design style",
      "options": [
        { "value": "hero", "label": "Hero - Large dramatic" },
        { "value": "compact", "label": "Compact - Medium size" },
        { "value": "minimal", "label": "Minimal - Inline (for headers)" }
      ],
      "default": "hero",
      "info": "Minimal is perfect for announcement bars and headers"
    },
    {
      "type": "header",
      "content": "Countdown"
    },
    {
      "type": "text",
      "id": "target_date",
      "label": "Target date",
      "info": "Format: YYYY-MM-DD (e.g., 2025-12-25)",
      "default": "2025-12-31"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Coming Soon"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Something exciting is on the way. Stay tuned!",
      "info": "Not shown in minimal design"
    },
    {
      "type": "text_alignment",
      "id": "content_alignment",
      "default": "center",
      "label": "Content alignment"
    },
    {
      "type": "header",
      "content": "Labels"
    },
    {
      "type": "text",
      "id": "days_label",
      "label": "Days label",
      "default": "Days",
      "info": "Minimal design shows only first letter"
    },
    {
      "type": "text",
      "id": "hours_label",
      "label": "Hours label",
      "default": "Hours"
    },
    {
      "type": "text",
      "id": "minutes_label",
      "label": "Minutes label",
      "default": "Minutes"
    },
    {
      "type": "text",
      "id": "seconds_label",
      "label": "Seconds label",
      "default": "Seconds"
    },
    {
      "type": "header",
      "content": "Call to action"
    },
    {
      "type": "select",
      "id": "cta_type",
      "label": "CTA type",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "link", "label": "Link button" },
        { "value": "email_form", "label": "Email signup form" }
      ],
      "default": "email_form",
      "info": "Email form collects emails as Shopify customers with 'countdown' and 'notify' tags. Minimal design only supports link."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Notify Me"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link",
      "info": "Required when using 'Link button' type"
    },
    {
      "type": "text",
      "id": "form_placeholder",
      "label": "Email placeholder",
      "default": "Enter your email",
      "info": "Placeholder text for email input (email form only)"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "options": [
        { "value": "outline", "label": "Outline" },
        { "value": "solid", "label": "Solid" }
      ],
      "default": "outline",
      "info": "Not applicable to minimal design"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "default": "#0a0a0a",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "text_color",
      "default": "#ffffff",
      "label": "Text color"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width",
      "info": "Minimal design is always full width"
    },
    {
      "type": "checkbox",
      "id": "show_dividers",
      "default": true,
      "label": "Show dividers between items",
      "info": "Hero and Compact designs only"
    }
  ],
  "presets": [
    {
      "name": "Countdown",
      "category": "Text & content",
      "settings": {
        "design": "hero",
        "target_date": "2025-12-31",
        "title": "Coming Soon",
        "subtitle": "Something exciting is on the way. Stay tuned!",
        "cta_type": "email_form",
        "button_text": "Notify Me",
        "form_placeholder": "Enter your email"
      }
    }
  ]
}
{% endschema %}
