{%- comment -%}
  Banner Section - Dismissable announcement banner with customizable styling
{%- endcomment -%}

{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width
  endcapture

  # Use global card settings
  assign card_radius = settings.card_radius | default: 8
  assign card_shadow = settings.card_shadow | default: 'none'
-%}

<section
  class="banner section-padding color-{{ section.settings.color_scheme }}"
  style="--banner-card-radius: {{ card_radius }}px;{% if card_shadow != 'none' %} --banner-card-shadow: {{ card_shadow }};{% endif %}"
  data-banner-section="{{ section.id }}"
  {% if section.settings.remember_dismissal %}data-remember-dismissal="true"{% endif %}
>
  <div class="{{ container_class }}">
    <div class="banner-content p-4 md:p-6">
      {% if section.settings.show_close_button %}
        <button
          type="button"
          class="banner-close"
          data-banner-close
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <i class="ph ph-x text-lg"></i>
        </button>
      {% endif %}

      <div class="{% if section.settings.show_close_button %}pr-8{% endif %}" data-banner-content data-tween-group="banner-{{ section.id }}">
        {% if section.settings.heading != blank %}
          <h2 class="banner-heading font-heading mb-3" data-tween data-tween-type="fade-up">
            {{ section.settings.heading }}
          </h2>
        {% endif %}

        {% if section.settings.text != blank %}
          <div class="banner-text text-base md:text-lg" data-tween data-tween-type="fade-up">
            {{ section.settings.text }}
          </div>
        {% endif %}

        {% if section.settings.button_text != blank %}
          <div class="mt-4" data-tween data-tween-type="fade-up">
            {% render 'button',
              text: section.settings.button_text,
              url: section.settings.button_link,
              style: section.settings.button_style,
              color: section.settings.button_color,
              size: section.settings.button_size,
              show_arrow: true
            %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<script>
(function() {
  'use strict';

  const sectionId = '{{ section.id }}';
  const section = document.querySelector('[data-banner-section="' + sectionId + '"]');
  if (!section) return;

  // Prevent duplicate initialization
  if (section.dataset.initialized) return;
  section.dataset.initialized = 'true';

  const closeBtn = section.querySelector('[data-banner-close]');
  const rememberDismissal = section.dataset.rememberDismissal === 'true';
  const storageKey = 'banner_dismissed_' + sectionId;

  // Check if banner was previously dismissed
  if (rememberDismissal && localStorage.getItem(storageKey) === 'true') {
    section.classList.add('banner-hidden');
    return;
  }

  // Dismiss banner function
  function dismissBanner() {
    section.classList.add('banner-hidden');

    if (rememberDismissal) {
      localStorage.setItem(storageKey, 'true');
    }
  }

  // Close button click
  if (closeBtn) {
    closeBtn.addEventListener('click', dismissBanner);
  }
})();
</script>

{% schema %}
{
  "name": "Banner",
  "tag": "section",
  "class": "banner-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Important Announcement"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>This is an important message for your customers.</p>"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "default": "solid",
      "options": [
        { "value": "solid", "label": "Solid" },
        { "value": "outline", "label": "Outline" }
      ]
    },
    {
      "type": "select",
      "id": "button_color",
      "label": "Button color",
      "default": "primary",
      "options": [
        { "value": "primary", "label": "Primary (accent)" },
        { "value": "secondary", "label": "Secondary (neutral)" }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button size",
      "default": "default",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "default", "label": "Default" },
        { "value": "large", "label": "Large" }
      ]
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Behavior"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show close button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "remember_dismissal",
      "label": "Remember when dismissed",
      "info": "Banner will stay hidden permanently after being closed",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Banner",
      "category": "Text & content"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
  }
{% endschema %}
