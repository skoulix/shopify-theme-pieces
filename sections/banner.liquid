{%- comment -%}
  Banner Section - Dismissable announcement banner with customizable styling
{%- endcomment -%}

{%- liquid
  if section.settings.full_width
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif

  # Use global card settings
  assign card_radius = settings.card_radius | default: 8
  assign card_border_width = settings.card_border_width | default: 0
  assign card_shadow = settings.card_shadow | default: 'none'
-%}

<style>
  .banner-{{ section.id }} {
    padding: var(--section-vertical-padding) 0;
  }

  .banner-{{ section.id }}.banner-hidden {
    display: none;
  }

  .banner-content-{{ section.id }} {
    background-color: var(--color-background);
    color: var(--color-text);
    border-radius: {{ card_radius }}px;
    border: 1px solid var(--color-border);
    {% if card_shadow != 'none' %}
    box-shadow: {{ card_shadow }};
    {% endif %}
  }

  .banner-heading-{{ section.id }} {
    font-size: calc(clamp(1.25rem, 3vw, 1.75rem) * var(--heading-font-scale, 1));
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .banner-text-{{ section.id }} a {
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .banner-text-{{ section.id }} a:hover {
    opacity: 0.7;
  }

  .banner-close-{{ section.id }} {
    color: var(--color-text);
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .banner-close-{{ section.id }}:hover {
    opacity: 1;
  }
</style>

<section
  class="banner-{{ section.id }} color-{{ section.settings.color_scheme }}"
  data-banner-section="{{ section.id }}"
  {% if section.settings.remember_dismissal %}data-remember-dismissal="true"{% endif %}
>
  <div class="{{ container_class }}">
    <div class="banner-content-{{ section.id }} relative p-4 md:p-6">
      {% if section.settings.show_close_button %}
        <button
          type="button"
          class="banner-close-{{ section.id }} absolute top-3 right-3 w-8 h-8 flex items-center justify-center hover:bg-black/5 rounded-full transition-colors"
          data-banner-close
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <i class="ph ph-x text-lg"></i>
        </button>
      {% endif %}

      <div class="{% if section.settings.show_close_button %}pr-8{% endif %}" data-banner-content data-tween-group="banner-{{ section.id }}">
        {% if section.settings.heading != blank %}
          <h2 class="banner-heading-{{ section.id }} font-heading mb-3" data-tween data-tween-type="fade-up">
            {{ section.settings.heading }}
          </h2>
        {% endif %}

        {% if section.settings.text != blank %}
          <div class="banner-text-{{ section.id }} text-base md:text-lg" data-tween data-tween-type="fade-up">
            {{ section.settings.text }}
          </div>
        {% endif %}

        {% if section.settings.button_text != blank %}
          <div class="mt-4" data-tween data-tween-type="fade-up">
            <a
              href="{{ section.settings.button_link | default: '#' }}"
              class="btn btn--secondary"
            >
              <span>{{ section.settings.button_text }}</span>
              <i class="ph ph-arrow-right"></i>
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<script>
(function() {
  'use strict';

  const sectionId = '{{ section.id }}';
  const section = document.querySelector('[data-banner-section="' + sectionId + '"]');
  if (!section) return;

  // Prevent duplicate initialization
  if (section.dataset.initialized) return;
  section.dataset.initialized = 'true';

  const closeBtn = section.querySelector('[data-banner-close]');
  const rememberDismissal = section.dataset.rememberDismissal === 'true';
  const storageKey = 'banner_dismissed_' + sectionId;

  // Check if banner was previously dismissed
  if (rememberDismissal && localStorage.getItem(storageKey) === 'true') {
    section.classList.add('banner-hidden');
    return;
  }

  // Dismiss banner function
  function dismissBanner() {
    section.classList.add('banner-hidden');

    if (rememberDismissal) {
      localStorage.setItem(storageKey, 'true');
    }
  }

  // Close button click
  if (closeBtn) {
    closeBtn.addEventListener('click', dismissBanner);
  }
})();
</script>

{% schema %}
{
  "name": "Banner",
  "tag": "section",
  "class": "banner-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Important Announcement"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>This is an important message for your customers.</p>"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-3"
    },
    {
      "type": "header",
      "content": "Behavior"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show close button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "remember_dismissal",
      "label": "Remember when dismissed",
      "info": "Banner will stay hidden permanently after being closed",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Banner",
      "category": "Text & content"
    }
  ]
}
{% endschema %}
