{%- comment -%}
  Banner Section - Dismissable announcement banner with customizable styling
{%- endcomment -%}

{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width, full_class: 'container-fluid'
  endcapture

  # Use global card settings
  assign card_radius = settings.card_radius | default: 8
  assign card_shadow = settings.card_shadow | default: 'none'
-%}

<div
  class="banner section-padding{% unless section.settings.padding == 'default' %}-{{ section.settings.padding }}{% endunless %}"
  style="--banner-card-radius: {{ card_radius }}px;{% if card_shadow != 'none' %} --banner-card-shadow: {{ card_shadow }};{% endif %}"
  data-banner-section="{{ section.id }}"
  {% if section.settings.remember_dismissal %}data-remember-dismissal="true"{% endif %}
>
  <div class="{{ container_class }}">
    <div class="banner-content color-{{ section.settings.color_scheme }} p-4 md:p-6">
      {% if section.settings.show_close_button %}
        <button
          type="button"
          class="banner-close"
          data-banner-close
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <i class="ph ph-x text-lg"></i>
        </button>
      {% endif %}

      <div class="{% if section.settings.show_close_button %}pr-8{% endif %}" data-banner-content data-tween-group="banner-{{ section.id }}">
        {% if section.settings.heading != blank %}
          <h2 class="banner-heading font-heading mb-3" data-tween data-tween-type="fade-up">
            {{ section.settings.heading }}
          </h2>
        {% endif %}

        {% if section.settings.text != blank %}
          <div class="banner-text text-base md:text-lg" data-tween data-tween-type="fade-up">
            {{ section.settings.text }}
          </div>
        {% endif %}

        {% if section.settings.button_text != blank %}
          <div class="mt-4" data-tween data-tween-type="fade-up">
            {% render 'button',
              text: section.settings.button_text,
              url: section.settings.button_link,
              style: section.settings.button_style,
              color: section.settings.button_color,
              size: section.settings.button_size,
              show_arrow: true
            %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  const sectionId = '{{ section.id }}';
  const section = document.querySelector('[data-banner-section="' + sectionId + '"]');
  if (!section) return;

  // Prevent duplicate initialization
  if (section.dataset.initialized) return;
  section.dataset.initialized = 'true';

  const closeBtn = section.querySelector('[data-banner-close]');
  const rememberDismissal = section.dataset.rememberDismissal === 'true';
  const storageKey = 'banner_dismissed_' + sectionId;

  // Check if banner was previously dismissed
  if (rememberDismissal && localStorage.getItem(storageKey) === 'true') {
    section.classList.add('banner-hidden');
    return;
  }

  // Dismiss banner function
  function dismissBanner() {
    section.classList.add('banner-hidden');

    if (rememberDismissal) {
      localStorage.setItem(storageKey, 'true');
    }
  }

  // Close button click
  if (closeBtn) {
    closeBtn.addEventListener('click', dismissBanner);
  }
})();
</script>

{% schema %}
{
  "name": "t:sections.banner.name",
  "tag": "section",
  "class": "banner-section",
  "settings": [
    {
      "type": "header",
      "content": "t:shared.headers.content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:shared.settings.heading.label",
      "default": "t:sections.banner.settings.heading.default"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "t:shared.settings.text.label",
      "default": "t:sections.banner.settings.text.default"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "t:shared.settings.button_text.label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:shared.settings.button_link.label"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:shared.settings.button_style.label",
      "default": "solid",
      "options": [
        {
          "value": "solid",
          "label": "t:shared.settings.button_style.options__0.label"
        },
        {
          "value": "outline",
          "label": "t:shared.settings.button_style.options__1.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "button_color",
      "label": "t:shared.settings.button_color.label",
      "default": "primary",
      "options": [
        {
          "value": "primary",
          "label": "t:shared.settings.button_color.options__0.label"
        },
        {
          "value": "secondary",
          "label": "t:shared.settings.button_color.options__1.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "t:shared.settings.button_size.label",
      "default": "default",
      "options": [
        {
          "value": "small",
          "label": "t:shared.settings.button_size.options__0.label"
        },
        {
          "value": "default",
          "label": "t:shared.settings.button_size.options__1.label"
        },
        {
          "value": "large",
          "label": "t:shared.settings.button_size.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.banner.settings.header__behavior.content"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "t:sections.banner.settings.show_close_button.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "remember_dismissal",
      "label": "t:sections.banner.settings.remember_dismissal.label",
      "info": "t:sections.banner.settings.remember_dismissal.info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:shared.headers.layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "t:shared.settings.full_width.label",
      "default": false
    },
    {
      "type": "select",
      "id": "padding",
      "label": "t:shared.settings.padding.label",
      "info": "t:shared.settings.padding.info",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "t:shared.settings.padding.options__2.label"
        },
        {
          "value": "small",
          "label": "t:shared.settings.padding.options__1.label"
        },
        {
          "value": "large",
          "label": "t:shared.settings.padding.options__3.label"
        },
        {
          "value": "none",
          "label": "t:shared.settings.padding.options__0.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:shared.headers.colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:shared.settings.color_scheme.label",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "t:sections.banner.presets.banner.name",
      "category": "t:sections.banner.presets.banner.category"
    }
  ],
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  }
}
{% endschema %}
