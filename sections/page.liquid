{%- comment -%}
  Page Section - Large typography header matching collection template
{%- endcomment -%}

{%- liquid
  case section.settings.header_alignment
    when 'center'
      assign header_align_class = 'text-center'
    else
      assign header_align_class = 'text-left'
  endcase
-%}

<style>
  .page-header-title { font-size: calc(clamp(2.5rem, 10vw, 4.5rem) * var(--heading-font-scale, 1)); letter-spacing: -0.03em; line-height: 0.9; }
  @media (min-width: 1024px) { .page-header-title { font-size: calc(clamp(3.5rem, 7vw, 6rem) * var(--heading-font-scale, 1)); } }
  @media (min-width: 1536px) { .page-header-title { font-size: calc(clamp(4.5rem, 6vw, 8rem) * var(--heading-font-scale, 1)); } }
  .page-header-title-line:nth-child(2) { margin-left: clamp(1.5rem, 10vw, 8rem); }
  .page-header-title-line:nth-child(3) { margin-left: clamp(3rem, 18vw, 14rem); }
  .page-header-title.text-center .page-header-title-line:nth-child(2),
  .page-header-title.text-center .page-header-title-line:nth-child(3) { margin-left: 0; }
</style>

<section class="page-wrapper is-loading bg-[--color-background] py-[--page-vertical-padding]" data-page-wrapper>
  <header class="mb-12 lg:mb-16 page-container {{ header_align_class }}">
    <h1 class="page-header-title font-bold text-[--color-text] font-heading {{ header_align_class }}" data-page-title>
      {{ page.title }}
    </h1>
  </header>

  <div class="page-container">
    <div class="prose max-w-none text-[--color-text]">
      {{ page.content }}
    </div>
  </div>
</section>

<script>
(function() {
  const wrapper = document.querySelector('[data-page-wrapper]');
  if (!wrapper || wrapper.dataset.pageInitialized) return;
  wrapper.dataset.pageInitialized = 'true';

  // If animations disabled, just show content
  if (typeof window.shouldAnimate === 'function' && !window.shouldAnimate()) {
    wrapper.classList.remove('is-loading');
    return;
  }

  function initAnimation() {
    const title = wrapper.querySelector('[data-page-title]');

    // Get GSAP and SplitText from pieces or window
    let gsap = window.gsap;
    if (!gsap && window.pieces && window.pieces.gsap) {
      gsap = window.pieces.gsap;
    }

    let SplitText = window.SplitText;
    if (!SplitText && window.pieces && window.pieces.SplitText) {
      SplitText = window.pieces.SplitText;
    }

    if (!gsap || !SplitText) {
      requestAnimationFrame(initAnimation);
      return;
    }

    wrapper.classList.remove('is-loading');

    if (!title) return;

    // Split title into lines
    const split = new SplitText(title, { type: 'lines', linesClass: 'page-header-title-line' });

    // Wrap each line in an overflow-hidden container for the reveal effect
    split.lines.forEach(line => {
      const lineWrapper = document.createElement('div');
      lineWrapper.style.overflow = 'hidden';
      lineWrapper.style.display = 'block';
      line.parentNode.insertBefore(lineWrapper, line);
      lineWrapper.appendChild(line);
    });

    // Set initial state and animate
    gsap.set(split.lines, { yPercent: 120 });
    gsap.to(split.lines, {
      yPercent: 0,
      duration: 1.2,
      ease: 'power4.out',
      stagger: 0.1
    });
  }

  // Run on load
  if (document.readyState === 'complete') {
    initAnimation();
  } else {
    window.addEventListener('load', initAnimation);
  }
})();
</script>

{% schema %}
{
  "name": "Page",
  "settings": [
    {
      "type": "select",
      "id": "header_alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left",
      "label": "Header alignment"
    }
  ]
}
{% endschema %}
