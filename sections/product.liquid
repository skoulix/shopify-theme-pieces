{% assign current_variant = product.selected_or_first_available_variant %}

<style>
  .product-section-wrapper { max-width: var(--page-max-width); margin: 0 auto; padding: 0; }
  @media (min-width: 1024px) { .product-section-wrapper { padding: 0 var(--page-padding); } }
  .product-section-wrapper.is-full-width { max-width: none; padding: 0; }
  .product-hero { display: grid; grid-template-columns: 1fr; position: relative; }
  @media (min-width: 1024px) { .product-hero { grid-template-columns: 1.2fr 1fr; } }
  .product-info { container-type: inline-size; display: flex; flex-direction: column; justify-content: center; padding: 6rem var(--page-padding) 3rem; }
  @media (min-width: 1024px) { .product-info { padding: 4rem 0 4rem 4rem; } }
  .product-info.is-full-width { padding: 6rem var(--page-padding) 3rem; }
  @media (min-width: 1024px) { .product-info.is-full-width { padding: 4rem 4rem 4rem 4rem; } }
  .product-title { font-size: calc(clamp(1.75rem, 10cqw, 3rem) * var(--heading-font-scale, 1)); font-weight: 700; letter-spacing: -0.04em; line-height: 0.85; color: var(--color-text); }
  @container (min-width: 400px) { .product-title { font-size: calc(clamp(2rem, 8cqw, 3.5rem) * var(--heading-font-scale, 1)); } }
  @container (min-width: 600px) { .product-title { font-size: calc(clamp(2.5rem, 7cqw, 4.5rem) * var(--heading-font-scale, 1)); } }
  @media (min-width: 1400px) { .product-title { font-size: calc(clamp(3rem, 3.5vw, 4.5rem) * var(--heading-font-scale, 1)); } }
  @media (min-width: 1800px) { .product-title { font-size: calc(clamp(3.5rem, 3vw, 5rem) * var(--heading-font-scale, 1)); } }
  .product-title-line { display: block; overflow: hidden; }
  .product-title-line:nth-child(2) { margin-left: clamp(1rem, 8cqw, 4rem); }
  .product-title-line:nth-child(3) { margin-left: clamp(2rem, 12cqw, 7rem); }
  .product-price-display { font-size: clamp(1rem, 5cqw, 1.75rem); font-weight: 300; letter-spacing: 0.02em; color: var(--color-text); }
  .product-price-display.intro-visible { opacity: 0.6; }
  @container (min-width: 400px) { .product-price-display { font-size: clamp(1.25rem, 4cqw, 2rem); } }
  .product-price-display .compare-price { font-size: 0.75em; text-decoration: line-through; opacity: 0.6; margin-right: 0.5em; }
  .product-gallery { position: relative; height: 100%; }
  @media (max-width: 1023px) { .product-gallery { min-height: 50vh; } }
  .product-gallery-main { position: relative; width: 100%; height: 100%; overflow: hidden; clip-path: inset(0 100% 0 0); }
  .product-gallery-image { position: absolute; inset: 0; opacity: 0; transition: opacity 0.6s ease; }
  .product-gallery-image.is-active { opacity: 1; }
  .product-gallery-image img { width: 100%; height: 100%; object-fit: cover; }
  .product-image-counter { position: absolute; bottom: 2rem; left: 2rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.2em; color: var(--color-text); mix-blend-mode: difference; z-index: 10; }
  .product-image-counter-current { font-size: 2rem; font-weight: 700; letter-spacing: -0.02em; }
  .product-thumbnails { position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 0.75rem; z-index: 10; }
  .product-thumbnail { position: relative; width: 50px; height: 65px; overflow: hidden; cursor: pointer; opacity: 0.4; transition: opacity 0.3s ease; border: 2px solid transparent; }
  .product-thumbnail:hover, .product-thumbnail.is-active { opacity: 1; }
  .product-thumbnail.is-active { border-color: var(--color-text); }
  .product-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
  .product-description { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; line-height: 1.8; color: var(--color-text-secondary); max-width: 420px; margin-top: 2rem; }
  .product-form { margin-top: 1.5rem; }
  .product-form-group { margin-bottom: 1.5rem; }
  .product-form-label { display: block; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; color: var(--color-text-secondary); margin-bottom: 0.75rem; }
  .product-form-select { width: 100%; padding: 1rem 0; font-size: 0.875rem; background: transparent; border: none; border-bottom: 1px solid var(--color-border); color: var(--color-text); cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0 center; background-size: 1.25rem; }
  .product-form-select:focus { outline: none; border-color: var(--color-text); }
  .product-quantity { display: inline-flex; align-items: center; background: transparent; border-radius: var(--input-radius); padding: 0; position: relative; overflow: hidden; border: var(--input-border-width) solid var(--color-border); }
  .product-quantity-btn { width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; background: transparent; border: none; cursor: pointer; color: var(--color-text); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  .product-quantity-btn:hover { background: var(--color-primary); color: var(--color-primary-contrast); }
  .product-quantity-btn:active { transform: scale(0.95); }
  .product-quantity-value { width: 3.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; }
  .product-quantity-input { width: 100%; height: 100%; text-align: center; font-size: 1rem; font-weight: 600; background: transparent; border: none; color: var(--color-text); -moz-appearance: textfield; }
  .product-quantity-input::-webkit-outer-spin-button, .product-quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .product-quantity-input:focus { outline: none; }
  .product-quantity:focus-within { border-color: var(--color-primary); }
  .product-quantity.is-changing .product-quantity-input { animation: quantityPop 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  @keyframes quantityPop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
  .product-add-btn { margin-top: 2rem; }
  .product-add-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .product-add-btn:disabled:hover::before { transform: scaleX(0); }
  .product-add-btn-text { position: relative; z-index: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
  .shopify-payment-button { margin-top: 0.75rem !important; }
  .shopify-payment-button__button, .shopify-payment-button__button--unbranded { position: relative !important; width: 100% !important; height: 2.75rem !important; min-height: 2.75rem !important; max-height: unset !important; padding: 0 1.75rem !important; font-size: 0.75rem !important; font-weight: 600 !important; {% if settings.buttons_uppercase %}text-transform: uppercase !important;{% endif %} letter-spacing: 0.15em !important; line-height: 1 !important; color: var(--color-primary) !important; background: var(--color-primary-contrast) !important; border: var(--button-border-width) solid var(--color-primary) !important; border-radius: var(--button-radius) !important; box-shadow: var(--button-shadow) !important; overflow: hidden !important; transition: color 0.4s ease !important; }
  .shopify-payment-button__button::before, .shopify-payment-button__button--unbranded::before { content: '' !important; position: absolute !important; inset: 0 !important; background: var(--color-primary) !important; transform: scaleX(0) !important; transform-origin: right !important; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important; z-index: 0 !important; pointer-events: none !important; }
  .shopify-payment-button__button:hover::before, .shopify-payment-button__button--unbranded:hover::before { transform: scaleX(1) !important; transform-origin: left !important; }
  .shopify-payment-button__button:hover, .shopify-payment-button__button--unbranded:hover, .shopify-payment-button__button:hover *, .shopify-payment-button__button--unbranded:hover * { color: var(--color-primary-contrast) !important; fill: var(--color-primary-contrast) !important; -webkit-text-fill-color: var(--color-primary-contrast) !important; }
  .shopify-payment-button__button:active, .shopify-payment-button__button--unbranded:active { transform: scale(0.98) !important; }
  .shopify-payment-button__button *, .shopify-payment-button__button--unbranded * { position: relative !important; z-index: 1 !important; transition: color 0.4s ease, fill 0.4s ease !important; }
  .product-vendor { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.2em; color: var(--color-text-secondary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; }
  .product-vendor::before { content: ''; width: 2rem; height: 1px; background: var(--color-text-secondary); }
  @media (max-width: 1023px) { .product-thumbnails { position: relative; right: auto; top: auto; transform: none; flex-direction: row; justify-content: center; padding: 1rem; gap: 0.5rem; } .product-thumbnail { width: 40px; height: 52px; } .product-image-counter { bottom: auto; top: 1rem; left: 1rem; } }
  [data-thumbnails], [data-image-counter] { opacity: 0; }

  /* Variant picker styles */
  .variant-picker__option { margin-bottom: 1.5rem; border: none; padding: 0; }
  .variant-picker__option:last-child { margin-bottom: 0; }
  .variant-picker__label { display: block; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; color: var(--color-text-secondary); margin-bottom: 0.75rem; }
  .variant-picker__selected { font-weight: 400; opacity: 0.7; }

  /* Swatch styles */
  .swatch { --swatch-size: 2.75rem; display: block; width: var(--swatch-size); height: var(--swatch-size); background: var(--swatch-bg); background-position: var(--swatch-focal-point, center); background-size: cover; background-origin: border-box; border: 1px solid var(--color-border); border-radius: 50%; transition: transform 0.2s ease; }
  .swatch--square { border-radius: 0.25rem; }
  .swatch--sm { --swatch-size: 1.5rem; }
  .swatch--lg { --swatch-size: 3.5rem; }
  .swatch--unavailable { border-style: dashed; opacity: 0.5; }

  /* Swatch input styles */
  .swatch-input { position: absolute; opacity: 0; width: 0; height: 0; }
  .swatch-input-label { display: inline-block; cursor: pointer; border-radius: 50%; outline: 2px solid transparent; outline-offset: 2px; transition: outline-color 0.2s ease; }
  .swatch-input-label--square { border-radius: 0.25rem; }
  .swatch-input:checked + .swatch-input-label { outline-color: var(--color-text); }
  .swatch-input:hover + .swatch-input-label { outline-color: var(--color-text-secondary); }
  .swatch-input:checked:hover + .swatch-input-label { outline-color: var(--color-text); }
  .swatch-input-label--disabled { opacity: 0.5; cursor: not-allowed; }
  .swatch-input-label--disabled .swatch { position: relative; overflow: hidden; }
  .swatch-input-label--disabled .swatch::after { content: ''; position: absolute; top: 50%; left: -10%; width: 120%; height: 1px; background: var(--color-text); transform: rotate(-45deg); }

  .variant-picker__swatches { display: flex; flex-wrap: wrap; gap: 0.75rem; }

  /* Button picker styles */
  .variant-picker__input { position: absolute; opacity: 0; width: 0; height: 0; }
  .variant-picker__buttons { display: flex; flex-wrap: wrap; gap: 0.5rem; }
  .variant-picker__button { display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.25rem; font-size: 0.75rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; border: 1px solid var(--color-border); background: transparent; color: var(--color-text); cursor: pointer; transition: all 0.2s ease; }
  .variant-picker__input:checked + .variant-picker__button { background: var(--color-text); color: var(--color-background); border-color: var(--color-text); }
  .variant-picker__input:hover + .variant-picker__button { border-color: var(--color-text); }
  .variant-picker__button--disabled { opacity: 0.5; cursor: not-allowed; text-decoration: line-through; }

  /* Dropdown picker styles */
  .variant-picker__select-wrapper { position: relative; display: flex; align-items: center; }
  .variant-picker__dropdown-swatch { position: absolute; left: 0; pointer-events: none; z-index: 1; }
  .variant-picker__select { width: 100%; padding: 1rem 2.5rem 1rem 0; font-size: 0.875rem; background: transparent; border: none; border-bottom: 1px solid var(--color-border); color: var(--color-text); cursor: pointer; appearance: none; }
  .variant-picker__select--with-swatch { padding-left: 2.5rem; }
  .variant-picker__select:focus { outline: none; border-color: var(--color-text); }
  .variant-picker__select-icon { position: absolute; right: 0; pointer-events: none; color: var(--color-text-secondary); }
  .product-hero.is-ready .product-gallery-main { clip-path: none; }
  .product-hero.is-ready [data-thumbnails], .product-hero.is-ready [data-image-counter] { opacity: 1; }
  /* Show elements immediately when animations disabled */
  html.animations-disabled .product-gallery-main { clip-path: none; }
  html.animations-disabled [data-thumbnails], html.animations-disabled [data-image-counter] { opacity: 1; }
  /* Image fit modes - controls how images display within gallery */
  .product-gallery .product-gallery-image { display: flex; align-items: center; justify-content: center; }
  .product-gallery .product-gallery-image img { object-fit: cover; object-position: center; }
  .product-gallery.fit-contain .product-gallery-image img { object-fit: contain; }
  .product-gallery.fit-cover .product-gallery-image img { object-fit: cover; }
  .product-gallery.fit-square .product-gallery-image img { object-fit: cover; aspect-ratio: 1/1; width: auto; height: 100%; max-width: 100%; }
  .product-gallery.fit-portrait .product-gallery-image img { object-fit: cover; aspect-ratio: 3/4; width: auto; height: 100%; max-width: 100%; }
  .product-gallery.fit-landscape .product-gallery-image img { object-fit: cover; aspect-ratio: 4/3; width: 100%; height: auto; max-height: 100%; }

  /* Rich Media Styles - 3D Models, Videos */
  .product-gallery-media { position: absolute; inset: 0; opacity: 0; transition: opacity 0.6s ease; display: flex; align-items: center; justify-content: center; background: var(--color-background-secondary); }
  .product-gallery-media.is-active { opacity: 1; }
  .product-gallery-media model-viewer { width: 100%; height: 100%; }
  .product-gallery-media video { width: 100%; height: 100%; object-fit: contain; }
  .product-gallery-media iframe { width: 100%; height: 100%; border: none; }
  .product-media-wrapper { position: relative; width: 100%; height: 100%; }
  .product-media-poster { position: absolute; inset: 0; z-index: 1; cursor: pointer; display: flex; align-items: center; justify-content: center; }
  .product-media-poster img { width: 100%; height: 100%; object-fit: cover; }
  .product-media-poster::after { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.2); }
  .product-media-poster .play-icon { position: absolute; z-index: 2; width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center; background: var(--color-background); border-radius: 50%; color: var(--color-text); transition: transform 0.3s ease; }
  .product-media-poster:hover .play-icon { transform: scale(1.1); }
  .product-media-poster.is-hidden { display: none; }
  .product-thumbnail-icon { position: absolute; bottom: 0.25rem; right: 0.25rem; width: 1.25rem; height: 1.25rem; display: flex; align-items: center; justify-content: center; background: var(--color-background); border-radius: 50%; font-size: 0.625rem; color: var(--color-text); }
  .model-viewer-ui { position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); display: flex; gap: 0.5rem; z-index: 10; }
  .model-viewer-ui button { width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; background: var(--color-background); border: 1px solid var(--color-border); border-radius: 50%; cursor: pointer; color: var(--color-text); transition: all 0.3s ease; }
  .model-viewer-ui button:hover { background: var(--color-text); color: var(--color-background); }
</style>

<div class="product-section-wrapper{% if section.settings.full_width %} is-full-width{% endif %}">
<section class="product-hero" data-product-section>
  <div class="product-gallery{% if section.settings.image_fit != 'cover' %} fit-{{ section.settings.image_fit }}{% endif %}" data-product-gallery>
    <div class="product-gallery-main" data-gallery-main>
      {% for media in product.media %}
        {%- case media.media_type -%}
          {%- when 'image' -%}
            <div class="product-gallery-image{% if forloop.first %} is-active{% endif %}" data-gallery-image="{{ forloop.index0 }}" data-media-id="{{ media.id }}" data-media-type="image">
              {%- if forloop.first -%}
                {{ media | image_url: width: 1800 | image_tag:
                  class: '',
                  loading: 'eager',
                  fetchpriority: 'high',
                  decoding: 'async',
                  sizes: '(max-width: 1024px) 100vw, 55vw',
                  widths: '600, 900, 1200, 1800'
                }}
              {%- else -%}
                {{ media | image_url: width: 1800 | image_tag:
                  class: '',
                  loading: 'lazy',
                  decoding: 'async',
                  sizes: '(max-width: 1024px) 100vw, 55vw',
                  widths: '600, 900, 1200, 1800'
                }}
              {%- endif -%}
            </div>

          {%- when 'video' -%}
            <div class="product-gallery-media{% if forloop.first %} is-active{% endif %}" data-gallery-image="{{ forloop.index0 }}" data-media-id="{{ media.id }}" data-media-type="video">
              <div class="product-media-wrapper">
                <div class="product-media-poster" data-video-poster>
                  {{ media.preview_image | image_url: width: 1800 | image_tag:
                    loading: 'lazy',
                    alt: media.alt | default: product.title
                  }}
                  <span class="play-icon" aria-hidden="true">
                    <i class="ph ph-play text-xl"></i>
                  </span>
                </div>
                {{ media | video_tag:
                  controls: true,
                  loop: section.settings.video_loop,
                  muted: section.settings.video_autoplay,
                  autoplay: false,
                  preload: 'metadata',
                  class: 'product-video'
                }}
              </div>
            </div>

          {%- when 'external_video' -%}
            <div class="product-gallery-media{% if forloop.first %} is-active{% endif %}" data-gallery-image="{{ forloop.index0 }}" data-media-id="{{ media.id }}" data-media-type="external_video" data-external-video-id="{{ media.external_id }}" data-external-video-host="{{ media.host }}">
              <div class="product-media-wrapper">
                <div class="product-media-poster" data-video-poster>
                  {{ media.preview_image | image_url: width: 1800 | image_tag:
                    loading: 'lazy',
                    alt: media.alt | default: product.title
                  }}
                  <span class="play-icon" aria-hidden="true">
                    <i class="ph ph-play text-xl"></i>
                  </span>
                </div>
                <template data-external-video-template>
                  {%- if media.host == 'youtube' -%}
                    <iframe
                      src="https://www.youtube.com/embed/{{ media.external_id }}?enablejsapi=1&autoplay=1"
                      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen
                      loading="lazy"
                    ></iframe>
                  {%- elsif media.host == 'vimeo' -%}
                    <iframe
                      src="https://player.vimeo.com/video/{{ media.external_id }}?autoplay=1"
                      allow="autoplay; fullscreen; picture-in-picture"
                      allowfullscreen
                      loading="lazy"
                    ></iframe>
                  {%- endif -%}
                </template>
              </div>
            </div>

          {%- when 'model' -%}
            <div class="product-gallery-media{% if forloop.first %} is-active{% endif %}" data-gallery-image="{{ forloop.index0 }}" data-media-id="{{ media.id }}" data-media-type="model">
              <div class="product-media-wrapper">
                {{ media | model_viewer_tag:
                  reveal: 'interaction',
                  toggleable: true,
                  image_size: '1800x',
                  ar: true,
                  ar-modes: 'webxr scene-viewer quick-look',
                  camera-controls: true,
                  touch-action: 'pan-y',
                  interaction-prompt: 'auto',
                  poster: media.preview_image | image_url: width: 1800
                }}
                <div class="model-viewer-ui">
                  <button type="button" data-model-reset aria-label="{{ 'products.product.media.reset_3d_model' | t }}">
                    <i class="ph ph-arrows-counter-clockwise"></i>
                  </button>
                  {%- if media.sources[0].url contains 'usdz' or media.sources[1].url contains 'usdz' -%}
                    <button type="button" data-model-ar aria-label="{{ 'products.product.media.view_in_ar' | t }}">
                      <i class="ph ph-cube"></i>
                    </button>
                  {%- endif -%}
                </div>
              </div>
            </div>
        {%- endcase -%}
      {% else %}
        <div class="product-gallery-image is-active">
          <div class="w-full h-full flex items-center justify-center bg-[--color-background-secondary]">
            <i class="ph ph-image text-8xl text-[--color-text-secondary] opacity-30"></i>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if product.media.size > 1 %}
      <div class="product-image-counter" data-image-counter>
        <span class="product-image-counter-current" data-counter-current>01</span>
        <span>/</span>
        <span>{{ product.media.size | prepend: '00' | slice: -2, 2 }}</span>
      </div>

      <div class="product-thumbnails" data-thumbnails>
        {% for media in product.media %}
          <button class="product-thumbnail{% if forloop.first %} is-active{% endif %}" data-thumbnail="{{ forloop.index0 }}" data-media-id="{{ media.id }}" data-media-type="{{ media.media_type }}" aria-label="{{ 'accessibility.view_media' | t: index: forloop.index, total: product.media.size }}">
            {{ media.preview_image | image_url: width: 150 | image_tag: alt: media.alt | default: product.title }}
            {%- if media.media_type == 'video' or media.media_type == 'external_video' -%}
              <span class="product-thumbnail-icon"><i class="ph ph-play"></i></span>
            {%- elsif media.media_type == 'model' -%}
              <span class="product-thumbnail-icon"><i class="ph ph-cube"></i></span>
            {%- endif -%}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="product-info {% if section.settings.full_width %} is-full-width{% endif %}">
    <div class="{% if section.settings.full_width %}lg:max-w-2xl{% endif %}">
      {%- assign product_form_id = 'product-form-' | append: section.id -%}

      {%- for block in section.blocks -%}
        {%- case block.type -%}

          {%- when 'breadcrumbs' -%}
            <div class="mb-4" {{ block.shopify_attributes }}>
              {% render 'breadcrumbs',
                separator: block.settings.separator,
                show_home_icon: block.settings.show_home_icon
              %}
            </div>

          {%- when 'vendor' -%}
            {% if product.vendor != blank %}
              <div class="product-vendor overflow-hidden" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                <span class="inline-block">{{ product.vendor }}</span>
              </div>
            {% endif %}

          {%- when 'title' -%}
            <h1 class="product-title font-heading" {{ block.shopify_attributes }}>
              {%- assign title_words = product.title | split: ' ' -%}
              {%- for word in title_words -%}
                <span class="product-title-line">
                  <span class="inline-block">{{ word }}</span>
                </span>
              {%- endfor -%}
            </h1>

          {%- when 'price' -%}
            <div class="product-price-display mt-6" data-tween data-tween-type="fade-up" data-price-display {{ block.shopify_attributes }}>
              {% if current_variant.compare_at_price > current_variant.price %}
                <span class="compare-price" data-compare-price>{{ current_variant.compare_at_price | money }}</span>
              {% endif %}
              <span data-product-price>{{ current_variant.price | money }}</span>
              {%- if current_variant.unit_price_measurement -%}
                <div class="unit-price text-sm text-[--color-text-secondary] mt-1" data-unit-price>
                  <span class="visually-hidden">{{ 'accessibility.unit_price_separator' | t }}</span>
                  <span data-unit-price-value>{{ current_variant.unit_price | money }}</span>/<span data-unit-price-unit>{{ current_variant.unit_price_measurement.reference_value }}{{ current_variant.unit_price_measurement.reference_unit }}</span>
                </div>
              {%- endif -%}
            </div>

          {%- when 'inventory_countdown' -%}
            <div class="mt-4" data-tween data-tween-type="fade-up" data-inventory-block {{ block.shopify_attributes }}>
              {% render 'inventory-countdown',
                variant: current_variant,
                threshold: block.settings.threshold,
                show_exact: block.settings.show_exact_count,
                style: block.settings.style,
                icon: block.settings.show_icon
              %}
            </div>

          {%- when 'description' -%}
            {% if product.description != blank %}
              {%- assign desc_text = product.description | strip_html | truncate: block.settings.truncate_length -%}
              <div class="product-description" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                {{ desc_text }}
              </div>
            {% endif %}

          {%- when 'variant_picker' -%}
            {% if product.variants.size > 1 %}
              <div class="mt-8" data-tween data-tween-type="fade-up">
                {% render 'product-variant-picker',
                  product: product,
                  block: block,
                  product_form_id: product_form_id,
                  section_id: section.id
                %}
              </div>
            {% endif %}

          {%- when 'quantity_selector' -%}
            <div class="product-form-group mt-8" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              <label class="product-form-label">{% if block.settings.label != blank %}{{ block.settings.label }}{% else %}{{ 'products.product.quantity' | t }}{% endif %}</label>
              <div class="product-quantity" data-quantity-wrapper>
                <button type="button" class="product-quantity-btn" data-quantity-minus aria-label="{{ 'products.product.decrease_quantity' | t }}">
                  <i class="ph ph-minus"></i>
                </button>
                <div class="product-quantity-value !border-none">
                  <input type="number" id="quantity-{{ section.id }}" name="quantity" form="{{ product_form_id }}" value="1" min="1" class="product-quantity-input !border-none" data-quantity-input aria-label="{{ 'products.product.quantity' | t }}">
                </div>
                <button type="button" class="product-quantity-btn" data-quantity-plus aria-label="{{ 'products.product.increase_quantity' | t }}">
                  <i class="ph ph-plus"></i>
                </button>
              </div>
            </div>

          {%- when 'buy_buttons' -%}
            <div class="product-form" data-tween data-tween-type="fade-up" data-product-form {{ block.shopify_attributes }}>
              {% form 'product', product, id: product_form_id %}
                {%- comment -%} Hidden variant input if no variant picker block {%- endcomment -%}
                {% unless product.has_only_default_variant %}
                  {%- assign has_variant_picker = false -%}
                  {%- for b in section.blocks -%}
                    {%- if b.type == 'variant_picker' -%}
                      {%- assign has_variant_picker = true -%}
                      {%- break -%}
                    {%- endif -%}
                  {%- endfor -%}
                  {% unless has_variant_picker %}
                    <input type="hidden" name="id" value="{{ current_variant.id }}">
                  {% endunless %}
                {% else %}
                  <input type="hidden" name="id" value="{{ current_variant.id }}">
                {% endunless %}

                {%- comment -%} Gift Card Recipient - Required for Theme Store {%- endcomment -%}
                {%- render 'gift-card-recipient', product: product, form: form, section: section -%}

                <button type="submit" class="btn btn--primary btn--full product-add-btn" data-add-to-cart {% unless current_variant.available %}disabled{% endunless %}>
                  <span class="product-add-btn-text">
                    {% if current_variant.available %}
                      <i class="ph ph-bag"></i>
                      <span>{% if block.settings.add_to_cart_text != blank %}{{ block.settings.add_to_cart_text }}{% else %}{{ 'products.product.add_to_cart' | t }}{% endif %}</span>
                    {% else %}
                      <span>{% if block.settings.sold_out_text != blank %}{{ block.settings.sold_out_text }}{% else %}{{ 'products.product.sold_out' | t }}{% endif %}</span>
                    {% endif %}
                  </span>
                </button>

                {% if block.settings.show_dynamic_checkout %}
                  <div>
                    {{ form | payment_button }}
                  </div>
                {% endif %}

                {%- comment -%} Shop Pay Installments - Required for Theme Store {%- endcomment -%}
                {{ form | payment_terms }}
              {% endform %}
            </div>

          {%- when 'pickup_availability' -%}
            <div data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {%- render 'pickup-availability', product: product -%}
            </div>

          {%- when 'delivery_estimator' -%}
            <div data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {%- render 'delivery-estimator' -%}
            </div>

          {%- when 'social_proof' -%}
            <div data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {%- render 'social-proof', product: product -%}
            </div>

          {%- when 'text' -%}
            <div class="product-custom-text mt-4 text-sm text-[--color-text-secondary]" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {{ block.settings.text }}
            </div>

          {%- when 'collapsible_tab' -%}
            <details class="product-accordion border-t border-[--color-border] group first-of-type:mt-4" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              <summary class="flex items-center justify-between py-4 cursor-pointer list-none [&::-webkit-details-marker]:hidden">
                <span class="text-sm font-medium">{{ block.settings.heading }}</span>
                <i class="ph ph-plus text-sm group-open:hidden"></i>
                <i class="ph ph-minus text-sm hidden group-open:inline"></i>
              </summary>
              <div class="pb-4 text-sm text-[--color-text-secondary] leading-relaxed">
                {{ block.settings.content }}
              </div>
            </details>

          {%- when 'size_chart' -%}
            {%- comment -%} Size chart link and modal - excluded from gift cards {%- endcomment -%}
            {%- liquid
              assign has_size_option = false
              unless product.gift_card?
                for option in product.options
                  assign option_downcase = option | downcase
                  if option_downcase contains 'size' or option_downcase contains 'taille'
                    assign has_size_option = true
                    break
                  endif
                endfor
              endunless
            -%}
            {% unless product.gift_card? %}
            {% if has_size_option or block.settings.show_always %}
              {%- liquid
                assign link_text = block.settings.link_text
                if link_text == blank
                  assign link_text = 'products.size_chart.title' | t
                endif
                assign drawer_heading = block.settings.drawer_heading
                if drawer_heading == blank
                  assign drawer_heading = 'products.size_chart.title' | t
                endif
              -%}
              <div class="size-chart-trigger mt-4" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                <button
                  type="button"
                  class="inline-flex items-center gap-2 text-sm text-[--color-text-secondary] hover:text-[--color-primary] transition-colors"
                  data-size-chart-open
                  aria-haspopup="dialog"
                >
                  <i class="ph ph-ruler text-lg"></i>
                  <span class="underline underline-offset-2">{{ link_text }}</span>
                </button>
              </div>

              {%- comment -%} Update global size chart drawer content {%- endcomment -%}
              <script>
                (function() {
                  const drawer = document.getElementById('size-chart-drawer');
                  if (!drawer) return;

                  const titleEl = drawer.querySelector('[data-size-chart-title]');
                  const bodyEl = drawer.querySelector('[data-size-chart-body]');

                  if (titleEl) {
                    titleEl.textContent = {{ drawer_heading | json }};
                  }

                  if (bodyEl) {
                    {% if block.settings.page != blank and block.settings.page.content != blank %}
                      bodyEl.innerHTML = '<div class="prose prose-sm max-w-none">{{ block.settings.page.content | escape }}</div>';
                    {% elsif block.settings.content != blank %}
                      bodyEl.innerHTML = '<div class="prose prose-sm max-w-none">{{ block.settings.content | escape }}</div>';
                    {% endif %}
                  }
                })();
              </script>
            {% endif %}
            {% endunless %}

          {%- when 'back_in_stock' -%}
            {%- comment -%} Back in stock notification form {%- endcomment -%}
            <div data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {% render 'back-in-stock-form', product: product, variant: current_variant %}
            </div>

          {%- when 'complementary_products' -%}
            {%- comment -%} Complementary Products Block - Horizontal Layout {%- endcomment -%}
            {%- liquid
              assign block_title = block.settings.title
              if block_title == blank
                assign block_title = 'products.complementary.title' | t
              endif
            -%}
            <div
              class="mt-6"
              data-complementary-block
              data-product-id="{{ product.id }}"
              data-limit="{{ block.settings.products_to_show }}"
              data-show-add-all="{{ block.settings.show_add_all }}"
              data-title="{{ block_title | escape }}"
              style="display: none;"
              {{ block.shopify_attributes }}
            >
              <h3 class="text-[0.75rem] font-semibold uppercase tracking-[0.15em] text-secondary mb-3" data-tween data-tween-type="fade-up">{{ block_title }}</h3>
              {%- comment -%} Skeleton Loading State {%- endcomment -%}
              <div class="flex flex-col gap-3" data-complementary-loading data-tween data-tween-type="fade-up">
                {% for i in (1..block.settings.products_to_show) %}
                  <div class="flex items-center gap-3 p-2 border border-[--color-border] rounded-lg animate-pulse">
                    <div class="shrink-0 w-12 h-12 rounded bg-[--color-text] opacity-10"></div>
                    <div class="flex-1">
                      <div class="h-3.5 w-3/4 bg-[--color-text] opacity-10 rounded"></div>
                      <div class="h-3 w-1/3 bg-[--color-text] opacity-10 rounded mt-1.5"></div>
                    </div>
                    <div class="shrink-0 w-8 h-8 rounded-full bg-[--color-text] opacity-10"></div>
                  </div>
                {% endfor %}
              </div>
              {%- comment -%} Products List {%- endcomment -%}
              <div class="flex flex-col gap-3" data-complementary-list data-tween data-tween-type="fade-up" style="display: none;">
              </div>
              {%- if block.settings.show_add_all -%}
                <button type="button" class="btn btn--secondary btn--sm w-full mt-3 hidden" data-complementary-add-all data-tween data-tween-type="fade-up">
                  <i class="ph ph-plus"></i>
                  <span data-add-all-text>{{ 'products.complementary.add_all' | t }}</span>
                </button>
              {%- endif -%}
            </div>

          {%- when 'wishlist_button' -%}
            {%- if settings.enable_wishlist -%}
              {%- capture wishlist_product_json -%}
                {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
              {%- endcapture -%}
              <div class="mt-4" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                {%- assign wb_icon_size = 'text-base' -%}
                {%- assign wb_btn_class = 'btn btn--secondary btn--sm' -%}
                {%- if block.settings.style == 'icon_only' -%}
                  {%- assign wb_icon_size = 'text-xl' -%}
                  {%- assign wb_btn_class = 'w-11 h-11 flex items-center justify-center rounded-full border border-[--color-border] text-[--color-text] transition-all duration-300 hover:bg-[--color-text] hover:text-[--color-background] hover:border-[--color-text]' -%}
                {%- endif -%}
                <button
                  type="button"
                  class="product-wishlist-btn {{ wb_btn_class }} [&.is-active]:bg-[--color-sale] [&.is-active]:text-white [&.is-active]:border-[--color-sale]"
                  data-wishlist-toggle="{{ product.id }}"
                  data-product-json='{{ wishlist_product_json | strip_newlines }}'
                  aria-label="{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to wishlist' }}"
                  aria-pressed="false"
                >
                  {%- if block.settings.style != 'text_only' -%}
                    <i class="ph ph-heart {{ wb_icon_size }}" aria-hidden="true"></i>
                  {%- endif -%}
                  {%- if block.settings.style != 'icon_only' -%}
                    <span data-wishlist-btn-text>{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to Wishlist' }}</span>
                  {%- endif -%}
                </button>
              </div>
            {%- endif -%}

          {%- when 'compare_button' -%}
            {%- if settings.enable_compare -%}
              {%- capture compare_product_json -%}
                {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
              {%- endcapture -%}
              <div class="mt-4" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                {%- assign cb_icon_size = 'text-base' -%}
                {%- assign cb_btn_class = 'btn btn--secondary btn--sm' -%}
                {%- if block.settings.style == 'icon_only' -%}
                  {%- assign cb_icon_size = 'text-xl' -%}
                  {%- assign cb_btn_class = 'w-11 h-11 flex items-center justify-center rounded-full border border-[--color-border] text-[--color-text] transition-all duration-300 hover:bg-[--color-text] hover:text-[--color-background] hover:border-[--color-text]' -%}
                {%- endif -%}
                <button
                  type="button"
                  class="product-compare-btn {{ cb_btn_class }} [&.is-active]:bg-[--color-text] [&.is-active]:text-[--color-background]"
                  data-compare-toggle="{{ product.id }}"
                  data-product-json='{{ compare_product_json | strip_newlines }}'
                  aria-label="{{ 'products.compare.add_to_compare' | t | default: 'Add to compare' }}"
                  aria-pressed="false"
                >
                  {%- if block.settings.style != 'text_only' -%}
                    <i class="ph ph-scales {{ cb_icon_size }}" aria-hidden="true"></i>
                  {%- endif -%}
                  {%- if block.settings.style != 'icon_only' -%}
                    <span data-compare-btn-text>{{ 'products.compare.add_to_compare' | t | default: 'Add to Compare' }}</span>
                  {%- endif -%}
                </button>
              </div>
            {%- endif -%}

          {%- when 'wc_buttons' -%}
            {%- if settings.enable_wishlist or settings.enable_compare -%}
              {%- capture wc_wishlist_json -%}
                {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
              {%- endcapture -%}
              {%- capture wc_compare_json -%}
                {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
              {%- endcapture -%}
              {%- assign wc_display_style = block.settings.display_style | default: 'icon_text' -%}
              {%- assign wc_show_icon = true -%}
              {%- assign wc_show_text = true -%}
              {%- assign wc_icon_size = 'text-base' -%}
              {%- assign wc_btn_class = 'btn btn--secondary btn--sm' -%}
              {%- if wc_display_style == 'icon_only' -%}
                {%- assign wc_show_text = false -%}
                {%- assign wc_icon_size = 'text-xl' -%}
                {%- assign wc_btn_class = 'w-11 h-11 flex items-center justify-center rounded-full border border-[--color-border] text-[--color-text] transition-all duration-300 hover:bg-[--color-text] hover:text-[--color-background] hover:border-[--color-text]' -%}
              {%- elsif wc_display_style == 'text_only' -%}
                {%- assign wc_show_icon = false -%}
              {%- endif -%}
              <div class="mt-4 flex justify-start gap-3" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
                {%- if settings.enable_wishlist -%}
                  <button
                    type="button"
                    class="{{ wc_btn_class }} product-wishlist-btn [&.is-active]:bg-[--color-sale] [&.is-active]:text-white [&.is-active]:border-[--color-sale]"
                    data-wishlist-toggle="{{ product.id }}"
                    data-product-json='{{ wc_wishlist_json | strip_newlines }}'
                    aria-label="{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to wishlist' }}"
                    aria-pressed="false"
                  >
                    {%- if wc_show_icon -%}<i class="ph ph-heart {{ wc_icon_size }}" aria-hidden="true"></i>{%- endif -%}
                    {%- if wc_show_text -%}<span data-wishlist-btn-text>{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to Wishlist' }}</span>{%- endif -%}
                  </button>
                {%- endif -%}
                {%- if settings.enable_compare -%}
                  <button
                    type="button"
                    class="{{ wc_btn_class }} product-compare-btn [&.is-active]:bg-[--color-text] [&.is-active]:text-[--color-background]"
                    data-compare-toggle="{{ product.id }}"
                    data-product-json='{{ wc_compare_json | strip_newlines }}'
                    aria-label="{{ 'products.compare.add_to_compare' | t | default: 'Add to compare' }}"
                    aria-pressed="false"
                  >
                    {%- if wc_show_icon -%}<i class="ph ph-scales {{ wc_icon_size }}" aria-hidden="true"></i>{%- endif -%}
                    {%- if wc_show_text -%}<span data-compare-btn-text>{{ 'products.compare.add_to_compare' | t | default: 'Add to Compare' }}</span>{%- endif -%}
                  </button>
                {%- endif -%}
              </div>
            {%- endif -%}

          {%- when 'social_actions' -%}
            {%- capture social_wishlist_json -%}
              {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
            {%- endcapture -%}
            {%- capture social_compare_json -%}
              {"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}
            {%- endcapture -%}
            <div class="mt-4 flex flex-wrap items-center gap-3" data-tween data-tween-type="fade-up" {{ block.shopify_attributes }}>
              {%- if settings.enable_wishlist -%}
                <button
                  type="button"
                  class="product-wishlist-btn inline-flex items-center justify-center w-10 h-10 border border-[--color-border] rounded-full text-sm transition-all duration-300 hover:border-[--color-text] [&.is-active]:bg-[--color-sale] [&.is-active]:text-white [&.is-active]:border-[--color-sale]"
                  data-wishlist-toggle="{{ product.id }}"
                  data-product-json='{{ social_wishlist_json | strip_newlines }}'
                  aria-label="{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to wishlist' }}"
                  aria-pressed="false"
                >
                  <i class="ph ph-heart text-lg" aria-hidden="true"></i>
                </button>
              {%- endif -%}
              {%- if settings.enable_compare -%}
                <button
                  type="button"
                  class="product-compare-btn inline-flex items-center justify-center w-10 h-10 border border-[--color-border] rounded-full text-sm transition-all duration-300 hover:border-[--color-text] [&.is-active]:bg-[--color-text] [&.is-active]:text-[--color-background]"
                  data-compare-toggle="{{ product.id }}"
                  data-product-json='{{ social_compare_json | strip_newlines }}'
                  aria-label="{{ 'products.compare.add_to_compare' | t | default: 'Add to compare' }}"
                  aria-pressed="false"
                >
                  <i class="ph ph-scales text-lg" aria-hidden="true"></i>
                </button>
              {%- endif -%}
              {%- if block.settings.show_share -%}
                <button
                  type="button"
                  class="product-share-btn inline-flex items-center justify-center w-10 h-10 border border-[--color-border] rounded-full text-sm transition-all duration-300 hover:border-[--color-text] hover:bg-[--color-text] hover:text-[--color-background]"
                  data-share-trigger
                  aria-label="{{ 'products.product.share' | t | default: 'Share' }}"
                >
                  <i class="ph ph-share-network text-lg" aria-hidden="true"></i>
                </button>
              {%- endif -%}
            </div>

        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</section>

{% if section.settings.show_sticky_bar %}
  {% render 'sticky-product-bar', product: product, current_variant: current_variant %}
{% endif %}
</div>

<script>
(function() {
  const section = document.querySelector('[data-product-section]');
  if (!section) return;

  // Variant handling
  const variants = {{ product.variants | json }};
  const moneyFormat = {{ shop.money_format | json }};
  const variantPicker = section.querySelector('[data-variant-picker]');
  const hiddenSelect = section.querySelector('[data-variant-select]');
  const priceEl = section.querySelector('[data-product-price]');
  const compareEl = section.querySelector('[data-compare-price]');
  const addButton = section.querySelector('[data-add-to-cart]');
  const galleryImages = section.querySelectorAll('[data-gallery-image]');
  const thumbnails = section.querySelectorAll('[data-thumbnail]');
  const counterCurrent = section.querySelector('[data-counter-current]');

  function formatMoney(cents) {
    const amount = (cents / 100).toFixed(2);
    return moneyFormat.replace(/\{\{\s*amount\s*\}\}/, amount)
                      .replace(/\{\{\s*amount_no_decimals\s*\}\}/, Math.round(cents / 100))
                      .replace(/\{\{\s*amount_with_comma_separator\s*\}\}/, amount.replace('.', ','));
  }

  // Show media by index (used by both thumbnails and variant switching)
  function showImageByIndex(index) {
    galleryImages.forEach((media, i) => {
      const isActive = i === index;
      media.classList.toggle('is-active', isActive);

      // Pause/stop media when switching away
      if (!isActive) {
        // Pause native videos
        const video = media.querySelector('video');
        if (video) {
          video.pause();
        }

        // Remove external video iframes (they will reload when shown again)
        const iframe = media.querySelector('iframe');
        if (iframe && media.dataset.mediaType === 'external_video') {
          iframe.remove();
          const poster = media.querySelector('[data-video-poster]');
          if (poster) poster.classList.remove('is-hidden');
        }
      }
    });
    thumbnails.forEach((thumb, i) => {
      thumb.classList.toggle('is-active', i === index);
    });
    if (counterCurrent) {
      counterCurrent.textContent = String(index + 1).padStart(2, '0');
    }
  }

  function updateVariant(variant) {
    if (!variant) return;

    // Update hidden select for form submission
    if (hiddenSelect) {
      hiddenSelect.value = variant.id;
    }

    // Update price
    if (priceEl) {
      priceEl.textContent = formatMoney(variant.price);
    }

    // Update compare price
    if (compareEl) {
      if (variant.compare_at_price && variant.compare_at_price > variant.price) {
        compareEl.textContent = formatMoney(variant.compare_at_price);
        compareEl.style.display = '';
      } else {
        compareEl.style.display = 'none';
      }
    }

    // Update button state
    if (addButton) {
      if (variant.available) {
        addButton.disabled = false;
        addButton.querySelector('.product-add-btn-text').innerHTML = '<i class="ph ph-bag"></i><span>{{ 'products.product.add_to_cart' | t }}</span>';
      } else {
        addButton.disabled = true;
        addButton.querySelector('.product-add-btn-text').innerHTML = '<span>{{ 'products.product.sold_out' | t }}</span>';
      }
    }

    // Update URL
    const url = new URL(window.location);
    url.searchParams.set('variant', variant.id);
    window.history.replaceState({}, '', url);

    // Update image if variant has a featured image
    if (variant.featured_media && galleryImages.length > 0) {
      const variantMediaId = variant.featured_media.id;
      // Find the gallery media with matching media ID
      const matchingMedia = Array.from(galleryImages).find(media =>
        parseInt(media.dataset.mediaId) === variantMediaId
      );
      if (matchingMedia) {
        const index = parseInt(matchingMedia.dataset.galleryImage);
        showImageByIndex(index);
      }
    } else if (variant.featured_image && galleryImages.length > 0) {
      // Fallback to featured_image for backwards compatibility
      const variantImageId = variant.featured_image.id;
      const matchingMedia = Array.from(galleryImages).find(media =>
        parseInt(media.dataset.mediaId) === variantImageId
      );
      if (matchingMedia) {
        const index = parseInt(matchingMedia.dataset.galleryImage);
        showImageByIndex(index);
      }
    }

    // Dispatch event for other components (e.g., sticky bar)
    document.dispatchEvent(new CustomEvent('variant:change', {
      detail: { variant: variant }
    }));
  }

  function getSelectedOptions() {
    const options = [];
    if (!variantPicker) return options;

    // Get from radio buttons (button/swatch pickers)
    const radioInputs = variantPicker.querySelectorAll('input[type="radio"]:checked');
    radioInputs.forEach(input => {
      const position = parseInt(input.dataset.optionPosition);
      if (position) {
        options[position - 1] = input.value;
      }
    });

    // Get from select dropdowns
    const selects = variantPicker.querySelectorAll('.variant-picker__select');
    selects.forEach(select => {
      const position = parseInt(select.dataset.optionPosition);
      if (position) {
        options[position - 1] = select.value;
      }
    });

    return options;
  }

  function findVariantFromOptions(options) {
    return variants.find(variant => {
      return variant.options.every((opt, index) => opt === options[index]);
    });
  }

  function updateSelectedLabels() {
    if (!variantPicker) return;
    const selectedLabels = variantPicker.querySelectorAll('[data-option-selected]');
    selectedLabels.forEach(label => {
      const optionIndex = parseInt(label.dataset.optionSelected);
      const options = getSelectedOptions();
      if (options[optionIndex]) {
        label.textContent = options[optionIndex];
      }
    });
  }

  function updateDropdownSwatches() {
    if (!variantPicker) return;
    const dropdownSwatches = variantPicker.querySelectorAll('[data-dropdown-swatch]');
    dropdownSwatches.forEach(swatchWrapper => {
      const optionIndex = parseInt(swatchWrapper.dataset.dropdownSwatch);
      const select = variantPicker.querySelector(`.variant-picker__select[data-option-position="${optionIndex + 1}"]`);
      if (!select) return;

      const selectedOption = select.options[select.selectedIndex];
      const swatch = swatchWrapper.querySelector('.swatch');
      if (!swatch) return;

      const swatchColor = selectedOption.dataset.swatchColor;
      const swatchImage = selectedOption.dataset.swatchImage;

      if (swatchImage) {
        swatch.style.setProperty('--swatch-bg', `url(${swatchImage})`);
        swatch.classList.remove('swatch--unavailable');
      } else if (swatchColor) {
        swatch.style.setProperty('--swatch-bg', swatchColor);
        swatch.classList.remove('swatch--unavailable');
      } else {
        swatch.style.removeProperty('--swatch-bg');
        swatch.classList.add('swatch--unavailable');
      }
    });
  }

  function handleOptionChange() {
    const options = getSelectedOptions();
    const variant = findVariantFromOptions(options);
    updateVariant(variant);
    updateSelectedLabels();
    updateDropdownSwatches();
  }

  if (variantPicker) {
    // Listen for radio button changes (button/swatch pickers)
    variantPicker.addEventListener('change', (e) => {
      if (e.target.matches('input[type="radio"]') || e.target.matches('.variant-picker__select')) {
        handleOptionChange();
      }
    });
  }

  // Fallback: Listen for changes on hidden select (if no variant picker)
  if (hiddenSelect && !variantPicker) {
    hiddenSelect.addEventListener('change', function() {
      const variant = variants.find(v => v.id === parseInt(this.value));
      updateVariant(variant);
    });
  }

  // Quantity buttons with animation
  const quantityWrapper = section.querySelector('[data-quantity-wrapper]');
  const quantityInput = section.querySelector('[data-quantity-input]');
  const minusBtn = section.querySelector('[data-quantity-minus]');
  const plusBtn = section.querySelector('[data-quantity-plus]');

  function animateQuantityChange() {
    if (quantityWrapper) {
      quantityWrapper.classList.remove('is-changing');
      // Trigger reflow
      void quantityWrapper.offsetWidth;
      quantityWrapper.classList.add('is-changing');
    }
  }

  if (minusBtn && plusBtn && quantityInput) {
    minusBtn.addEventListener('click', () => {
      const val = parseInt(quantityInput.value) || 1;
      if (val > 1) {
        quantityInput.value = val - 1;
        animateQuantityChange();
      }
    });

    plusBtn.addEventListener('click', () => {
      const val = parseInt(quantityInput.value) || 1;
      quantityInput.value = val + 1;
      animateQuantityChange();
    });

    // Also animate on direct input change
    quantityInput.addEventListener('change', animateQuantityChange);
  }

  // Image gallery - uses showImageByIndex defined above
  let currentImageIndex = 0;

  function showImage(index) {
    showImageByIndex(index);
    currentImageIndex = index;
  }

  thumbnails.forEach((thumb, index) => {
    thumb.addEventListener('click', () => showImage(index));
  });

  // Click on main image to cycle (only for images, not videos/models)
  const galleryMain = section.querySelector('[data-gallery-main]');
  if (galleryMain && galleryImages.length > 1) {
    galleryMain.addEventListener('click', (e) => {
      // Don't cycle if clicking on video/model controls or interactive elements
      if (e.target.closest('video, model-viewer, iframe, button, [data-video-poster], .model-viewer-ui')) {
        return;
      }
      const currentMedia = galleryImages[currentImageIndex];
      if (currentMedia && currentMedia.dataset.mediaType === 'image') {
        const nextIndex = (currentImageIndex + 1) % galleryImages.length;
        showImage(nextIndex);
      }
    });
  }

  // Video poster click - play video
  section.querySelectorAll('[data-video-poster]').forEach(poster => {
    poster.addEventListener('click', () => {
      const mediaWrapper = poster.closest('[data-gallery-image]');
      if (!mediaWrapper) return;

      const mediaType = mediaWrapper.dataset.mediaType;

      if (mediaType === 'video') {
        // Native video - just play it
        const video = mediaWrapper.querySelector('video');
        if (video) {
          poster.classList.add('is-hidden');
          video.play();
        }
      } else if (mediaType === 'external_video') {
        // External video - load iframe from template
        const template = mediaWrapper.querySelector('[data-external-video-template]');
        if (template) {
          const wrapper = poster.closest('.product-media-wrapper');
          poster.classList.add('is-hidden');
          wrapper.insertAdjacentHTML('beforeend', template.innerHTML);
        }
      }
    });
  });

  // 3D Model controls
  section.querySelectorAll('[data-model-reset]').forEach(btn => {
    btn.addEventListener('click', () => {
      const modelViewer = btn.closest('.product-media-wrapper')?.querySelector('model-viewer');
      if (modelViewer) {
        modelViewer.cameraOrbit = modelViewer.getAttribute('camera-orbit') || 'auto auto auto';
        modelViewer.fieldOfView = 'auto';
      }
    });
  });

  section.querySelectorAll('[data-model-ar]').forEach(btn => {
    btn.addEventListener('click', () => {
      const modelViewer = btn.closest('.product-media-wrapper')?.querySelector('model-viewer');
      if (modelViewer && modelViewer.canActivateAR) {
        modelViewer.activateAR();
      }
    });
  });
})();
</script>

<script>
(function() {
  function initProductAnimation() {
    const section = document.querySelector('[data-product-section]');
    if (!section) return;
    if (section.dataset.animInitialized) return;

    // If animations disabled, skip
    if (typeof window.shouldAnimate === 'function' && !window.shouldAnimate()) {
      section.dataset.animInitialized = 'true';
      return;
    }

    // Check for GSAP
    let gsap = window.gsap;
    if (!gsap && window.pieces && window.pieces.gsap) {
      gsap = window.pieces.gsap;
    }

    if (!gsap) {
      setTimeout(initProductAnimation, 50);
      return;
    }

    section.dataset.animInitialized = 'true';

    const galleryMain = section.querySelector('[data-gallery-main]');
    const titleLines = section.querySelectorAll('.product-title-line > span');
    const thumbnails = section.querySelector('[data-thumbnails]');
    const counter = section.querySelector('[data-image-counter]');

    // Set initial animation states
    if (galleryMain) {
      gsap.set(galleryMain, { clipPath: 'inset(0 100% 0 0)' });
    }
    if (titleLines.length) {
      gsap.set(titleLines, { yPercent: 100 });
    }
    if (thumbnails) {
      gsap.set(thumbnails, { opacity: 0 });
    }
    if (counter) {
      gsap.set(counter, { opacity: 0 });
    }

    const tl = gsap.timeline({
      onComplete: () => {
        section.classList.add('is-ready');
      }
    });

    // Image reveal and title reveal together - both start at 0
    if (galleryMain) {
      tl.to(galleryMain, {
        clipPath: 'inset(0 0% 0 0)',
        duration: 1.2,
        ease: 'power3.out'
      }, 0);
    }

    // Title reveal - starts at same time as image
    if (titleLines.length) {
      tl.to(titleLines, {
        yPercent: 0,
        duration: 1.2,
        ease: 'power4.out',
        stagger: 0.1
      }, 0);
    }

    // Thumbnails and counter - appear after main animations
    if (thumbnails) {
      tl.to(thumbnails, {
        opacity: 1,
        duration: 0.6,
        ease: 'power3.out'
      }, 0.8);
    }

    if (counter) {
      tl.to(counter, {
        opacity: 1,
        duration: 0.6,
        ease: 'power3.out'
      }, 0.8);
    }
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProductAnimation);
  } else {
    initProductAnimation();
  }

  // Reinitialize after Swup (use helper to prevent duplicate listeners)
  if (window.onSwupContentReplaced) {
    window.onSwupContentReplaced('product-animation', () => {
      requestAnimationFrame(initProductAnimation);
    });
  }
})();
</script>

<script>
(function() {
  function setupBuyButton() {
    const buyButtonWrapper = document.querySelector('shopify-buy-it-now-button');
    if (!buyButtonWrapper) {
      setTimeout(setupBuyButton, 100);
      return;
    }

    const button = buyButtonWrapper.querySelector('button');
    if (!button) {
      setTimeout(setupBuyButton, 100);
      return;
    }

    // Check if already set up
    if (button.dataset.piecesHover) return;
    button.dataset.piecesHover = 'true';

    // Create the fill overlay element
    const fillOverlay = document.createElement('span');
    fillOverlay.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-primary);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 0;
      pointer-events: none;
    `;

    // Wrap button text in a span for z-index control
    const buttonText = button.textContent;
    button.textContent = '';

    const textSpan = document.createElement('span');
    textSpan.textContent = buttonText;
    textSpan.style.cssText = `
      position: relative;
      z-index: 1;
      transition: color 0.4s ease;
    `;

    button.appendChild(fillOverlay);
    button.appendChild(textSpan);

    // Add hover listeners
    button.addEventListener('mouseenter', () => {
      fillOverlay.style.transformOrigin = 'left';
      fillOverlay.style.transform = 'scaleX(1)';
      textSpan.style.color = 'var(--color-primary-contrast)';
    });

    button.addEventListener('mouseleave', () => {
      fillOverlay.style.transformOrigin = 'right';
      fillOverlay.style.transform = 'scaleX(0)';
      textSpan.style.color = '';
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupBuyButton);
  } else {
    setupBuyButton();
  }

  // Watch for dynamic insertion of the button
  const observer = new MutationObserver(() => {
    const buyButtonWrapper = document.querySelector('shopify-buy-it-now-button');
    if (buyButtonWrapper && buyButtonWrapper.querySelector('button')) {
      setupBuyButton();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Reinitialize after Swup page transitions
  if (window.onSwupContentReplaced) {
    window.onSwupContentReplaced('product-buy-button', () => {
      setTimeout(setupBuyButton, 100);
    });
  }
})();
</script>

<script>
/**
 * AJAX Add to Cart - Handles form submission and triggers drawer/notification
 */
(function() {
  function initAddToCart() {
    const section = document.querySelector('[data-product-section]');
    if (!section) return;

    const form = section.querySelector('form[action*="/cart/add"]');
    if (!form) return;
    if (form.dataset.ajaxInitialized) return;

    form.dataset.ajaxInitialized = 'true';

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const addButton = form.querySelector('[data-add-to-cart]');
      const originalText = addButton.innerHTML;

      // Loading state
      addButton.disabled = true;
      addButton.innerHTML = '<span class="product-add-btn-text"><i class="ph ph-spinner animate-spin"></i><span>{{ 'cart.adding' | t }}</span></span>';

      try {
        const formData = new FormData(form);
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error('Failed to add to cart');
        }

        const item = await response.json();

        // Get updated cart for count
        const cartResponse = await fetch('/cart.js');
        const cart = await cartResponse.json();

        // Update cart count in header
        document.querySelectorAll('[data-cart-count]').forEach(el => {
          el.textContent = cart.item_count;
        });

        // Dispatch cart updated event for reactive components (e.g., free shipping bar)
        document.dispatchEvent(new CustomEvent('cart:updated', { detail: { cart } }));

        // Get product info for notification
        const productInfo = {
          title: item.product_title,
          variant_title: item.variant_title !== 'Default Title' ? item.variant_title : null,
          image: item.image ? item.image.replace(/(\.[^.]+)$/, '_200x$1') : null
        };

        // Trigger appropriate cart behavior based on theme settings
        const cartType = window.themeSettings?.cartType || 'drawer';

        if (cartType === 'drawer') {
          // Refresh cart drawer content then open it
          if (window.refreshCartDrawer) {
            await window.refreshCartDrawer();
          }
          document.dispatchEvent(new CustomEvent('cart:open'));
        } else if (cartType === 'notification') {
          // Show notification
          document.dispatchEvent(new CustomEvent('cart:notification', {
            detail: {
              product: productInfo,
              cart: cart
            }
          }));
        } else {
          // cartType === 'page' - redirect to cart
          window.location.href = '/cart';
          return;
        }

        // Success state
        addButton.innerHTML = '<span class="product-add-btn-text"><i class="ph ph-check"></i><span>{{ 'cart.added' | t }}</span></span>';

        setTimeout(() => {
          addButton.innerHTML = originalText;
          addButton.disabled = false;
        }, 2000);

      } catch (error) {
        console.error('Add to cart error:', error);

        // Error state
        addButton.innerHTML = '<span class="product-add-btn-text"><i class="ph ph-x"></i><span>{{ 'cart.error' | t }}</span></span>';

        setTimeout(() => {
          addButton.innerHTML = originalText;
          addButton.disabled = false;
        }, 2000);
      }
    });
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAddToCart);
  } else {
    initAddToCart();
  }

  // Reinitialize after Swup
  if (window.onSwupContentReplaced) {
    window.onSwupContentReplaced('product-add-to-cart', () => {
      requestAnimationFrame(initAddToCart);
    });
  }
})();
</script>

<script>
/**
 * Complementary Products - Vanilla JS with JSON API
 */
(function() {
  const block = document.querySelector('[data-complementary-block]');
  if (!block) return;

  const i18n = {
    addAll: {{ 'products.complementary.add_all' | t | json }},
    adding: {{ 'products.complementary.adding' | t | json }},
    added: {{ 'products.complementary.added' | t | json }},
    error: {{ 'products.complementary.error' | t | json }}
  };

  const productId = block.dataset.productId;
  const limit = block.dataset.limit || 4;
  const showAddAll = block.dataset.showAddAll === 'true';
  const loading = block.querySelector('[data-complementary-loading]');
  const list = block.querySelector('[data-complementary-list]');
  const addAllBtn = block.querySelector('[data-complementary-add-all]');

  // Helpers
  function resizeImage(url, size) {
    if (!url) return '';
    return url.replace(/(\.[^.]+)$/, `_${size}$1`);
  }

  function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function formatMoney(cents) {
    const amount = (cents / 100).toFixed(2);
    const currency = window.Shopify?.currency?.active || 'USD';
    try {
      return new Intl.NumberFormat(document.documentElement.lang || 'en', {
        style: 'currency',
        currency
      }).format(amount);
    } catch {
      return `$${amount}`;
    }
  }

  async function addAllToCart() {
    const items = Array.from(block.querySelectorAll('[data-quick-add]')).map(btn => ({
      id: btn.dataset.quickAdd,
      quantity: 1
    }));

    if (items.length === 0) return;

    const textEl = addAllBtn.querySelector('[data-add-all-text]');
    const originalText = textEl?.textContent;
    addAllBtn.disabled = true;
    if (textEl) textEl.textContent = i18n.adding;

    try {
      const response = await fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ items })
      });

      if (!response.ok) throw new Error('Failed to add to cart');

      const cartResponse = await fetch('/cart.js');
      const cart = await cartResponse.json();
      document.querySelectorAll('[data-cart-count]').forEach(el => {
        el.textContent = cart.item_count;
      });

      // Dispatch cart updated event for reactive components (e.g., free shipping bar)
      document.dispatchEvent(new CustomEvent('cart:updated', { detail: { cart } }));

      const cartType = window.themeSettings?.cartType || 'drawer';
      if (cartType === 'drawer') {
        if (window.refreshCartDrawer) await window.refreshCartDrawer();
        document.dispatchEvent(new CustomEvent('cart:open'));
      }

      if (textEl) textEl.textContent = i18n.added;
      setTimeout(() => {
        if (textEl) textEl.textContent = originalText;
        addAllBtn.disabled = false;
      }, 2000);
    } catch (error) {
      console.error('Add all to cart error:', error);
      if (textEl) textEl.textContent = i18n.error;
      setTimeout(() => {
        if (textEl) textEl.textContent = originalText;
        addAllBtn.disabled = false;
      }, 2000);
    }
  }

  // Fetch and render products
  async function loadComplementaryProducts() {
    try {
      const url = `/recommendations/products.json?product_id=${productId}&limit=${limit}&intent=complementary`;
      const response = await fetch(url);
      const data = await response.json();

      if (!data.products || data.products.length === 0) {
        block.remove();
        return;
      }

      let allSingleVariant = true;

      data.products.forEach(product => {
        const href = product.url;
        const imgSrc = product.featured_image ? resizeImage(product.featured_image, '100x100') : '';
        const price = formatMoney(product.price);
        const comparePrice = product.compare_at_price > product.price ? formatMoney(product.compare_at_price) : null;
        const hasSingleVariant = product.variants.length === 1;
        const isAvailable = product.available;
        const variantId = product.variants[0]?.id;

        if (!hasSingleVariant || !isAvailable) allSingleVariant = false;

        const item = document.createElement('div');
        item.className = 'flex items-center gap-3 p-2 border border-primary/10 rounded-lg hover:border-primary/30 transition-colors';
        if (variantId) item.dataset.variantId = variantId;

        let actionHtml = '';
        if (isAvailable && hasSingleVariant && variantId) {
          actionHtml = `<button type="button" class="shrink-0 w-8 h-8 inline-flex items-center justify-center bg-transparent border border-primary/20 rounded-full text-primary hover:bg-primary hover:text-background hover:border-primary transition-all" data-quick-add="${variantId}" aria-label="{{ 'products.product.add_to_cart' | t }}"><span data-add-text class="flex items-center justify-center"><i class="ph ph-plus text-sm"></i></span><span data-adding-text class="hidden flex items-center justify-center"><i class="ph ph-spinner text-sm animate-spin"></i></span><span data-added-text class="hidden flex items-center justify-center"><i class="ph ph-check text-sm"></i></span></button>`;
        } else if (isAvailable) {
          actionHtml = `<a href="${href}" class="shrink-0 w-8 h-8 inline-flex items-center justify-center bg-transparent border border-primary/20 rounded-full text-primary hover:bg-primary hover:text-background hover:border-primary transition-all" aria-label="{{ 'products.product.select_options' | t }}"><i class="ph ph-eye text-sm"></i></a>`;
        }

        item.innerHTML = `
          <a href="${href}" class="shrink-0 w-12 h-12 rounded overflow-hidden bg-secondary/5">
            ${imgSrc ? `<img src="${imgSrc}" alt="${escapeHtml(product.title)}" loading="lazy" decoding="async" width="100" height="100" class="w-full h-full object-cover">` : ''}
          </a>
          <div class="flex-1 min-w-0">
            <a href="${href}" class="text-[0.8125rem] font-medium text-primary truncate block no-underline">${escapeHtml(product.title)}</a>
            <div class="text-xs text-secondary mt-0.5">
              ${comparePrice ? `<span class="line-through opacity-60 mr-1">${comparePrice}</span>` : ''}${price}
            </div>
          </div>
          ${actionHtml}
        `;

        list.appendChild(item);
      });

      // Hide loading, show list
      if (loading) loading.style.display = 'none';
      list.style.display = '';

      // Trigger intro animation after browser paint
      requestAnimationFrame(() => {
        list.classList.add('intro-visible');
      });

      // Show "Add all" button if applicable
      if (showAddAll && allSingleVariant && addAllBtn) {
        addAllBtn.classList.remove('hidden');
        addAllBtn.addEventListener('click', addAllToCart);
      }
    } catch (error) {
      console.error('[ComplementaryProducts] Error:', error);
      block.remove();
    }
  }

  // Show block with skeleton loaders immediately
  block.style.display = '';

  // Trigger tween animations after browser paint
  requestAnimationFrame(() => {
    if (window.pieces?.tween) {
      window.pieces.tween.reinit();
    }
  });

  // Load products
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadComplementaryProducts);
  } else {
    loadComplementaryProducts();
  }
})();
</script>

{%- comment -%} Track Recently Viewed Product {%- endcomment -%}
<script>
(function() {
  const STORAGE_KEY = 'pieces_recently_viewed';
  const MAX_PRODUCTS = 12;

  const productData = {
    id: '{{ product.id }}',
    handle: '{{ product.handle }}',
    title: {{ product.title | json }},
    url: '{{ product.url }}',
    image: '{{ product.featured_image | image_url: width: 800 }}',
    price: {{ product.price }},
    compareAtPrice: {{ product.compare_at_price | default: 0 }},
    vendor: {{ product.vendor | json }},
    available: {{ product.available }}
  };

  function addProduct() {
    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      let products = stored ? JSON.parse(stored) : [];

      // Remove if already exists
      products = products.filter(p => p.id !== productData.id);

      // Add to beginning
      products.unshift({
        ...productData,
        addedAt: Date.now()
      });

      // Limit to max products
      products = products.slice(0, MAX_PRODUCTS);

      localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
    } catch {
      // localStorage might be unavailable
    }
  }

  // Track after a short delay to ensure page has loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => setTimeout(addProduct, 100));
  } else {
    setTimeout(addProduct, 100);
  }
})();
</script>

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "default": "cover",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" },
        { "value": "square", "label": "Square" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "landscape", "label": "Landscape" }
      ]
    },
    {
      "type": "header",
      "content": "Video"
    },
    {
      "type": "checkbox",
      "id": "video_loop",
      "label": "Loop videos",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "video_autoplay",
      "label": "Autoplay videos when visible",
      "default": false,
      "info": "Videos will be muted when autoplay is enabled"
    },
    {
      "type": "header",
      "content": "Sticky add to cart"
    },
    {
      "type": "checkbox",
      "id": "show_sticky_bar",
      "default": true,
      "label": "Show sticky add to cart bar",
      "info": "Shows a bottom bar when the product form scrolls out of view"
    }
  ],
  "blocks": [
    {
      "type": "breadcrumbs",
      "name": "Breadcrumbs",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "separator",
          "label": "Separator",
          "default": "/"
        },
        {
          "type": "checkbox",
          "id": "show_home_icon",
          "label": "Show home icon",
          "default": false,
          "info": "Display an icon instead of 'Home' text"
        }
      ]
    },
    {
      "type": "vendor",
      "name": "Vendor",
      "limit": 1
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "inventory_countdown",
      "name": "Inventory countdown",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "threshold",
          "label": "Low stock threshold",
          "min": 3,
          "max": 20,
          "step": 1,
          "default": 10,
          "info": "Show warning when stock is at or below this number"
        },
        {
          "type": "select",
          "id": "style",
          "label": "Display style",
          "options": [
            { "value": "bar", "label": "Progress bar" },
            { "value": "minimal", "label": "Minimal text" },
            { "value": "badge", "label": "Badge" }
          ],
          "default": "bar"
        },
        {
          "type": "checkbox",
          "id": "show_exact_count",
          "label": "Show exact count",
          "default": true,
          "info": "Display exact number remaining vs generic 'Low stock'"
        },
        {
          "type": "checkbox",
          "id": "show_icon",
          "label": "Show icon",
          "default": true
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "truncate_length",
          "label": "Character limit",
          "min": 50,
          "max": 500,
          "step": 10,
          "default": 200
        }
      ]
    },
    {
      "type": "variant_picker",
      "name": "Variant picker",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "label": "Picker type",
          "options": [
            {
              "value": "dropdown",
              "label": "Dropdown"
            },
            {
              "value": "button",
              "label": "Buttons"
            }
          ],
          "default": "button"
        },
        {
          "type": "select",
          "id": "swatch_shape",
          "label": "Color swatch style",
          "info": "Options with color swatches will display as visual swatches instead of the picker type above.",
          "options": [
            {
              "value": "circle",
              "label": "Circle"
            },
            {
              "value": "square",
              "label": "Square"
            },
            {
              "value": "none",
              "label": "None (use picker type)"
            }
          ],
          "default": "circle"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "Quantity selector",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Quantity"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "add_to_cart_text",
          "label": "Add to cart text",
          "info": "Leave blank to use translation"
        },
        {
          "type": "text",
          "id": "sold_out_text",
          "label": "Sold out text",
          "info": "Leave blank to use translation"
        },
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout button",
          "info": "Using the payment methods available on your store, customers see their preferred option, like PayPal or Apple Pay.",
          "default": true
        }
      ]
    },
    {
      "type": "pickup_availability",
      "name": "Pickup availability",
      "limit": 1,
      "settings": []
    },
    {
      "type": "delivery_estimator",
      "name": "Delivery estimator",
      "limit": 1,
      "settings": []
    },
    {
      "type": "social_proof",
      "name": "Social proof",
      "limit": 1,
      "settings": []
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Add custom text like shipping info or care instructions.</p>"
        }
      ]
    },
    {
      "type": "collapsible_tab",
      "name": "Collapsible tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Shipping & Returns"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add content for this collapsible tab.</p>"
        }
      ]
    },
    {
      "type": "size_chart",
      "name": "Size chart",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "info": "Leave blank to use default translation"
        },
        {
          "type": "text",
          "id": "drawer_heading",
          "label": "Drawer heading",
          "info": "Leave blank to use default translation"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Size chart page",
          "info": "Select a page with your size chart content. Leave blank to use default table or custom content below."
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Custom content",
          "info": "Used if no page is selected. Leave blank for default size chart table."
        },
        {
          "type": "checkbox",
          "id": "show_always",
          "label": "Show for all products",
          "default": false,
          "info": "By default, only shows for products with a Size option"
        }
      ]
    },
    {
      "type": "back_in_stock",
      "name": "Back in stock",
      "limit": 1,
      "settings": []
    },
    {
      "type": "complementary_products",
      "name": "Complementary products",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Shows products frequently bought together. To set up complementary products, use the Search & Discovery app."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "info": "Leave blank to use default translation"
        },
        {
          "type": "range",
          "id": "products_to_show",
          "min": 1,
          "max": 4,
          "step": 1,
          "default": 2,
          "label": "Products to show"
        },
        {
          "type": "checkbox",
          "id": "show_add_all",
          "label": "Show add all button",
          "default": true,
          "info": "Only shows when all products have a single variant"
        }
      ]
    },
    {
      "type": "wishlist_button",
      "name": "Wishlist button",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Requires 'Enable wishlist' to be enabled in theme settings."
        },
        {
          "type": "select",
          "id": "style",
          "label": "Button style",
          "default": "icon_text",
          "options": [
            { "value": "icon_only", "label": "Icon only" },
            { "value": "icon_text", "label": "Icon with text" },
            { "value": "text_only", "label": "Text only" }
          ]
        }
      ]
    },
    {
      "type": "compare_button",
      "name": "Compare button",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Requires 'Enable compare' to be enabled in theme settings."
        },
        {
          "type": "select",
          "id": "style",
          "label": "Button style",
          "default": "icon_text",
          "options": [
            { "value": "icon_only", "label": "Icon only" },
            { "value": "icon_text", "label": "Icon with text" },
            { "value": "text_only", "label": "Text only" }
          ]
        }
      ]
    },
    {
      "type": "wc_buttons",
      "name": "Wishlist & Compare",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Shows wishlist and compare buttons side by side in a 50/50 layout. Individual buttons will only show if enabled in theme settings."
        },
        {
          "type": "select",
          "id": "display_style",
          "label": "Display style",
          "default": "icon_text",
          "options": [
            { "value": "icon_only", "label": "Icon only" },
            { "value": "icon_text", "label": "Icon with text" },
            { "value": "text_only", "label": "Text only" }
          ]
        }
      ]
    },
    {
      "type": "social_actions",
      "name": "Social actions",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Shows wishlist, compare, and share buttons in a row. Individual buttons will only show if enabled in theme settings."
        },
        {
          "type": "checkbox",
          "id": "show_share",
          "label": "Show share button",
          "default": true
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
