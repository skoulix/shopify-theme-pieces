{% assign current_variant = product.selected_or_first_available_variant %}

{%- liquid
  if section.settings.full_width
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif
-%}

<style>
  .product-section-wrapper { max-width: var(--page-max-width); margin: 0 auto; padding: 0; }
  @media (min-width: 1024px) { .product-section-wrapper { padding: 0 var(--page-padding); } }
  .product-section-wrapper.is-full-width { max-width: none; padding: 0; }
  .product-hero { min-height: 100vh; display: grid; grid-template-columns: 1fr; position: relative; overflow: hidden; }
  @media (min-width: 1024px) { .product-hero { grid-template-columns: 1.2fr 1fr; min-height: calc(100vh - 80px); } }
  .product-info { container-type: inline-size; display: flex; flex-direction: column; justify-content: center; padding: 6rem var(--page-padding) 3rem; }
  @media (min-width: 1024px) { .product-info { padding: 4rem 0 4rem 4rem; } }
  .product-info.is-full-width { padding: 6rem var(--page-padding) 3rem; }
  @media (min-width: 1024px) { .product-info.is-full-width { padding: 4rem 4rem 4rem 4rem; } }
  .product-title { font-size: clamp(2rem, 12cqw, 3.5rem); font-weight: 700; letter-spacing: -0.04em; line-height: 0.85; color: var(--color-text); }
  @container (min-width: 400px) { .product-title { font-size: clamp(2.5rem, 10cqw, 4.5rem); } }
  @container (min-width: 600px) { .product-title { font-size: clamp(3rem, 8cqw, 5.5rem); } }
  .product-title-line { display: block; overflow: hidden; }
  .product-title-line:nth-child(2) { margin-left: clamp(1rem, 8cqw, 4rem); }
  .product-title-line:nth-child(3) { margin-left: clamp(2rem, 12cqw, 7rem); }
  .product-price-display { font-size: clamp(1rem, 5cqw, 1.75rem); font-weight: 300; letter-spacing: 0.02em; color: var(--color-text); opacity: 0.6; }
  @container (min-width: 400px) { .product-price-display { font-size: clamp(1.25rem, 4cqw, 2rem); } }
  .product-price-display .compare-price { font-size: 0.5em; text-decoration: line-through; opacity: 0.5; margin-right: 0.5em; }
  .product-gallery { position: relative; height: 100%; min-height: 50vh; }
  @media (min-width: 1024px) { .product-gallery { min-height: calc(100vh - 80px); } }
  .product-gallery-main { position: relative; width: 100%; height: 100%; overflow: hidden; clip-path: inset(0 100% 0 0); }
  .product-gallery-image { position: absolute; inset: 0; opacity: 0; transition: opacity 0.6s ease; }
  .product-gallery-image.is-active { opacity: 1; }
  .product-gallery-image img { width: 100%; height: 100%; object-fit: cover; }
  .product-image-counter { position: absolute; bottom: 2rem; left: 2rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.2em; color: var(--color-text); mix-blend-mode: difference; z-index: 10; }
  .product-image-counter-current { font-size: 2rem; font-weight: 700; letter-spacing: -0.02em; }
  .product-thumbnails { position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 0.75rem; z-index: 10; }
  .product-thumbnail { width: 50px; height: 65px; overflow: hidden; cursor: pointer; opacity: 0.4; transition: opacity 0.3s ease; border: 2px solid transparent; }
  .product-thumbnail:hover, .product-thumbnail.is-active { opacity: 1; }
  .product-thumbnail.is-active { border-color: var(--color-text); }
  .product-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
  .product-description { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; line-height: 1.8; color: var(--color-text-secondary); max-width: 320px; margin-top: 2rem; }
  .product-form { margin-top: 3rem; }
  .product-form-group { margin-bottom: 1.5rem; }
  .product-form-label { display: block; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; color: var(--color-text-secondary); margin-bottom: 0.75rem; }
  .product-form-select { width: 100%; padding: 1rem 0; font-size: 0.875rem; background: transparent; border: none; border-bottom: 1px solid var(--color-border); color: var(--color-text); cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0 center; background-size: 1.25rem; }
  .product-form-select:focus { outline: none; border-color: var(--color-text); }
  .product-quantity { display: inline-flex; align-items: center; background: transparent; border-radius: var(--input-radius); padding: 0; position: relative; overflow: hidden; border: var(--input-border-width) solid var(--color-border); }
  .product-quantity-btn { width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; background: transparent; border: none; cursor: pointer; color: var(--color-text); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  .product-quantity-btn:hover { background: var(--color-primary); color: var(--color-primary-contrast); }
  .product-quantity-btn:active { transform: scale(0.95); }
  .product-quantity-value { width: 3.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; }
  .product-quantity-input { width: 100%; height: 100%; text-align: center; font-size: 1rem; font-weight: 600; background: transparent; border: none; color: var(--color-text); -moz-appearance: textfield; }
  .product-quantity-input::-webkit-outer-spin-button, .product-quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .product-quantity-input:focus { outline: none; }
  .product-quantity.is-changing .product-quantity-input { animation: quantityPop 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  @keyframes quantityPop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
  .product-add-btn { margin-top: 2rem; }
  .product-add-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .product-add-btn:disabled:hover::before { transform: scaleX(0); }
  .product-add-btn-text { position: relative; z-index: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
  .shopify-payment-button { margin-top: 0.75rem !important; }
  .shopify-payment-button__button, .shopify-payment-button__button--unbranded { position: relative !important; width: 100% !important; height: auto !important; min-height: unset !important; max-height: unset !important; padding: 1.25rem 2rem !important; font-size: 0.75rem !important; font-weight: 600 !important; {% if settings.buttons_uppercase %}text-transform: uppercase !important;{% endif %} letter-spacing: 0.2em !important; line-height: 1 !important; color: var(--color-primary) !important; background: var(--color-primary-contrast) !important; border: var(--button-border-width) solid var(--color-primary) !important; border-radius: var(--button-radius) !important; overflow: hidden !important; transition: color 0.4s ease !important; }
  .shopify-payment-button__button::before, .shopify-payment-button__button--unbranded::before { content: '' !important; position: absolute !important; inset: 0 !important; background: var(--color-primary) !important; transform: scaleX(0) !important; transform-origin: right !important; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important; z-index: 0 !important; pointer-events: none !important; }
  .shopify-payment-button__button:hover::before, .shopify-payment-button__button--unbranded:hover::before { transform: scaleX(1) !important; transform-origin: left !important; }
  .shopify-payment-button__button:hover, .shopify-payment-button__button--unbranded:hover, .shopify-payment-button__button:hover *, .shopify-payment-button__button--unbranded:hover * { color: var(--color-primary-contrast) !important; fill: var(--color-primary-contrast) !important; -webkit-text-fill-color: var(--color-primary-contrast) !important; }
  .shopify-payment-button__button:active, .shopify-payment-button__button--unbranded:active { transform: scale(0.98) !important; }
  .shopify-payment-button__button *, .shopify-payment-button__button--unbranded * { position: relative !important; z-index: 1 !important; transition: color 0.4s ease, fill 0.4s ease !important; }
  .product-vendor { font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.2em; color: var(--color-text-secondary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; }
  .product-vendor::before { content: ''; width: 2rem; height: 1px; background: var(--color-text-secondary); }
  @media (max-width: 1023px) { .product-thumbnails { position: relative; right: auto; top: auto; transform: none; flex-direction: row; justify-content: center; padding: 1rem; gap: 0.5rem; } .product-thumbnail { width: 40px; height: 52px; } .product-image-counter { bottom: auto; top: 1rem; left: 1rem; } }
  .product-vendor, .product-title, .product-price, [data-shuffle-text], [data-product-form], [data-thumbnails], [data-image-counter] { opacity: 0; }
  .product-hero.is-ready .product-gallery-main { clip-path: none; }
  .product-hero.is-ready .product-vendor, .product-hero.is-ready .product-title, .product-hero.is-ready .product-price, .product-hero.is-ready [data-shuffle-text], .product-hero.is-ready [data-product-form], .product-hero.is-ready [data-thumbnails], .product-hero.is-ready [data-image-counter] { opacity: 1; }
</style>

<div class="product-section-wrapper{% if section.settings.full_width %} is-full-width{% endif %}">
<section class="product-hero" data-product-section>
  <div class="product-gallery">
    <div class="product-gallery-main" data-gallery-main>
      {% for image in product.images %}
        <div class="product-gallery-image{% if forloop.first %} is-active{% endif %}" data-gallery-image="{{ forloop.index0 }}">
          {{ image | image_url: width: 1800 | image_tag:
            class: '',
            loading: forloop.first | default: 'lazy',
            sizes: '(max-width: 1024px) 100vw, 55vw',
            widths: '600, 900, 1200, 1800'
          }}
        </div>
      {% else %}
        <div class="product-gallery-image is-active">
          <div class="w-full h-full flex items-center justify-center bg-[--color-background-secondary]">
            <i class="ph ph-image text-8xl text-[--color-text-secondary] opacity-30"></i>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if product.images.size > 1 %}
      <div class="product-image-counter" data-image-counter>
        <span class="product-image-counter-current" data-counter-current>01</span>
        <span>/</span>
        <span>{{ product.images.size | prepend: '00' | slice: -2, 2 }}</span>
      </div>

      <div class="product-thumbnails" data-thumbnails>
        {% for image in product.images %}
          <button class="product-thumbnail{% if forloop.first %} is-active{% endif %}" data-thumbnail="{{ forloop.index0 }}">
            {{ image | image_url: width: 150 | image_tag }}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="product-info {% if section.settings.full_width %} is-full-width{% endif %}">
    <div class="{% if section.settings.full_width %}lg:max-w-2xl{% endif %}">
    {% if product.vendor != blank %}
      <div class="product-vendor overflow-hidden">
        <span class="inline-block">{{ product.vendor }}</span>
      </div>
    {% endif %}

    <h1 class="product-title font-heading">
      {%- assign title_words = product.title | split: ' ' -%}
      {%- for word in title_words -%}
        <span class="product-title-line">
          <span class="inline-block">{{ word }}</span>
        </span>
      {%- endfor -%}
    </h1>

    <div class="product-price-display mt-6 overflow-hidden" data-price-display>
      <span class="inline-block">
        {% if current_variant.compare_at_price > current_variant.price %}
          <span class="compare-price" data-compare-price>{{ current_variant.compare_at_price | money }}</span>
        {% endif %}
        <span data-product-price>{{ current_variant.price | money }}</span>
      </span>
    </div>

    {% if product.description != blank %}
      {%- assign desc_text = product.description | strip_html | truncate: 200 -%}
      {%- assign desc_length = desc_text | size -%}
      {%- assign estimated_lines = desc_length | divided_by: 50 | plus: 1 -%}
      {%- assign min_height = estimated_lines | times: 1.35 -%}
      <div class="product-description" style="min-height: {{ min_height }}rem;" data-shuffle-text data-original-text="{{ desc_text | escape }}">
        {{ desc_text }}
      </div>
    {% endif %}

    <div class="product-form" data-product-form>
      {% form 'product', product %}
        {% if product.variants.size > 1 %}
          <div class="product-form-group">
            <label for="variant-select" class="product-form-label">Select Option</label>
            <select id="variant-select" name="id" class="product-form-select">
              {% for variant in product.variants %}
                <option value="{{ variant.id }}" {% if variant == current_variant %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                  {{ variant.title }}{% unless variant.available %} â€” Sold Out{% endunless %}
                </option>
              {% endfor %}
            </select>
          </div>
        {% else %}
          <input type="hidden" name="id" value="{{ current_variant.id }}">
        {% endif %}

        <div class="product-form-group">
          <label class="product-form-label">Quantity</label>
          <div class="product-quantity" data-quantity-wrapper>
            <button type="button" class="product-quantity-btn" data-quantity-minus aria-label="Decrease quantity">
              <i class="ph ph-minus"></i>
            </button>
            <div class="product-quantity-value !border-none">
              <input type="number" id="quantity" name="quantity" value="1" min="1" class="product-quantity-input !border-none" data-quantity-input aria-label="Quantity">
            </div>
            <button type="button" class="product-quantity-btn" data-quantity-plus aria-label="Increase quantity">
              <i class="ph ph-plus"></i>
            </button>
          </div>
        </div>

        <button type="submit" class="btn btn--primary btn--full product-add-btn" data-add-to-cart {% unless current_variant.available %}disabled{% endunless %}>
          <span class="product-add-btn-text">
            {% if current_variant.available %}
              <i class="ph ph-bag"></i>
              <span>Add to Cart</span>
            {% else %}
              <span>Sold Out</span>
            {% endif %}
          </span>
        </button>

        <div>
          {{ form | payment_button }}
        </div>
      {% endform %}
    </div>
    </div>
  </div>
</section>
</div>

<script>
(function() {
  const section = document.querySelector('[data-product-section]');
  if (!section) return;

  // Variant handling
  const variants = {{ product.variants | json }};
  const moneyFormat = {{ shop.money_format | json }};
  const select = document.getElementById('variant-select');
  const priceEl = section.querySelector('[data-product-price]');
  const compareEl = section.querySelector('[data-compare-price]');
  const addButton = section.querySelector('[data-add-to-cart]');

  function formatMoney(cents) {
    const amount = (cents / 100).toFixed(2);
    return moneyFormat.replace(/\{\{\s*amount\s*\}\}/, amount)
                      .replace(/\{\{\s*amount_no_decimals\s*\}\}/, Math.round(cents / 100))
                      .replace(/\{\{\s*amount_with_comma_separator\s*\}\}/, amount.replace('.', ','));
  }

  if (select) {
    select.addEventListener('change', function() {
      const variant = variants.find(v => v.id === parseInt(this.value));
      if (!variant) return;

      // Update price
      if (priceEl) {
        priceEl.textContent = formatMoney(variant.price);
      }

      // Update compare price
      if (compareEl) {
        if (variant.compare_at_price && variant.compare_at_price > variant.price) {
          compareEl.textContent = formatMoney(variant.compare_at_price);
          compareEl.style.display = '';
        } else {
          compareEl.style.display = 'none';
        }
      }

      // Update button state
      if (addButton) {
        if (variant.available) {
          addButton.disabled = false;
          addButton.querySelector('.product-add-btn-text').innerHTML = '<i class="ph ph-bag"></i><span>Add to Cart</span>';
        } else {
          addButton.disabled = true;
          addButton.querySelector('.product-add-btn-text').innerHTML = '<span>Sold Out</span>';
        }
      }

      // Update URL
      const url = new URL(window.location);
      url.searchParams.set('variant', variant.id);
      window.history.replaceState({}, '', url);
    });
  }

  // Quantity buttons with animation
  const quantityWrapper = section.querySelector('[data-quantity-wrapper]');
  const quantityInput = section.querySelector('[data-quantity-input]');
  const minusBtn = section.querySelector('[data-quantity-minus]');
  const plusBtn = section.querySelector('[data-quantity-plus]');

  function animateQuantityChange() {
    if (quantityWrapper) {
      quantityWrapper.classList.remove('is-changing');
      // Trigger reflow
      void quantityWrapper.offsetWidth;
      quantityWrapper.classList.add('is-changing');
    }
  }

  if (minusBtn && plusBtn && quantityInput) {
    minusBtn.addEventListener('click', () => {
      const val = parseInt(quantityInput.value) || 1;
      if (val > 1) {
        quantityInput.value = val - 1;
        animateQuantityChange();
      }
    });

    plusBtn.addEventListener('click', () => {
      const val = parseInt(quantityInput.value) || 1;
      quantityInput.value = val + 1;
      animateQuantityChange();
    });

    // Also animate on direct input change
    quantityInput.addEventListener('change', animateQuantityChange);
  }

  // Image gallery
  const galleryImages = section.querySelectorAll('[data-gallery-image]');
  const thumbnails = section.querySelectorAll('[data-thumbnail]');
  const counterCurrent = section.querySelector('[data-counter-current]');
  let currentImageIndex = 0;

  function showImage(index) {
    galleryImages.forEach((img, i) => {
      img.classList.toggle('is-active', i === index);
    });
    thumbnails.forEach((thumb, i) => {
      thumb.classList.toggle('is-active', i === index);
    });
    if (counterCurrent) {
      counterCurrent.textContent = String(index + 1).padStart(2, '0');
    }
    currentImageIndex = index;
  }

  thumbnails.forEach((thumb, index) => {
    thumb.addEventListener('click', () => showImage(index));
  });

  // Click on main image to cycle
  const galleryMain = section.querySelector('[data-gallery-main]');
  if (galleryMain && galleryImages.length > 1) {
    galleryMain.style.cursor = 'pointer';
    galleryMain.addEventListener('click', () => {
      const nextIndex = (currentImageIndex + 1) % galleryImages.length;
      showImage(nextIndex);
    });
  }
})();
</script>

<script>
(function() {
  function initProductAnimation() {
    const section = document.querySelector('[data-product-section]');
    if (!section) return;
    if (section.dataset.animInitialized) return;

    // Check for GSAP
    let gsap = window.gsap;
    if (!gsap && window.pieces && window.pieces.gsap) {
      gsap = window.pieces.gsap;
    }

    if (!gsap) {
      setTimeout(initProductAnimation, 50);
      return;
    }

    section.dataset.animInitialized = 'true';

    const galleryMain = section.querySelector('[data-gallery-main]');
    const titleContainer = section.querySelector('.product-title');
    const titleLines = section.querySelectorAll('.product-title-line > span');
    const vendor = section.querySelector('.product-vendor');
    const priceContainer = section.querySelector('.product-price');
    const priceDisplay = section.querySelector('[data-price-display]');
    const description = section.querySelector('[data-shuffle-text]');
    const form = section.querySelector('[data-product-form]');
    const thumbnails = section.querySelector('[data-thumbnails]');
    const counter = section.querySelector('[data-image-counter]');
    const scrollHint = section.querySelector('.product-scroll-hint');

    // Set initial animation states via GSAP (overrides CSS for reliability)
    if (galleryMain) {
      gsap.set(galleryMain, { clipPath: 'inset(0 100% 0 0)' });
    }
    if (titleContainer) {
      gsap.set(titleContainer, { opacity: 1 }); // Override CSS opacity: 0
    }
    if (titleLines.length) {
      gsap.set(titleLines, { yPercent: 100 });
    }
    if (vendor) {
      gsap.set(vendor, { opacity: 0, y: 20 });
    }
    if (priceContainer) {
      gsap.set(priceContainer, { opacity: 1 }); // Override CSS opacity: 0
    }
    if (priceDisplay) {
      const priceSpan = priceDisplay.querySelector('.inline-block');
      if (priceSpan) gsap.set(priceSpan, { yPercent: 100 });
    }
    if (description) {
      gsap.set(description, { opacity: 0, y: 20 });
    }
    if (form) {
      gsap.set(form, { opacity: 0, y: 20 });
    }
    if (thumbnails) {
      gsap.set(thumbnails, { opacity: 0, y: 20 });
    }
    if (counter) {
      gsap.set(counter, { opacity: 0, y: 20 });
    }
    if (scrollHint) {
      gsap.set(scrollHint, { opacity: 0 });
    }

    const tl = gsap.timeline({
      onComplete: () => {
        section.classList.add('is-ready');
      }
    });

    // Image reveal - dramatic clip-path
    if (galleryMain) {
      tl.to(galleryMain, {
        clipPath: 'inset(0 0% 0 0)',
        duration: 1.6,
        ease: 'expo.inOut'
      }, 0);
    }

    // Title reveal - staggered from bottom
    if (titleLines.length) {
      tl.to(titleLines, {
        yPercent: 0,
        duration: 1.2,
        ease: 'power4.out',
        stagger: 0.1
      }, 0.3);
    }

    // Vendor fade in
    if (vendor) {
      tl.to(vendor, {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: 'power3.out'
      }, 0.5);
    }

    // Price reveal
    if (priceDisplay) {
      const priceSpan = priceDisplay.querySelector('.inline-block');
      if (priceSpan) {
        tl.to(priceSpan, {
          yPercent: 0,
          duration: 0.8,
          ease: 'power4.out'
        }, 0.6);
      }
    }

    // Description - text shuffle effect
    if (description) {
      const originalText = description.textContent.trim();
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';

      // Start scrambled
      description.textContent = originalText.split('').map(char =>
        char === ' ' ? ' ' : chars[Math.floor(Math.random() * chars.length)]
      ).join('');

      tl.to(description, {
        opacity: 1,
        y: 0,
        duration: 0.6,
        ease: 'power3.out'
      }, 0.7);

      // Shuffle animation
      const shuffleObj = { progress: 0 };
      tl.to(shuffleObj, {
        progress: 1,
        duration: 1.5,
        ease: 'none',
        onUpdate: () => {
          const progress = shuffleObj.progress;
          const revealedCount = Math.floor(progress * originalText.length);
          description.textContent = originalText.split('').map((char, i) => {
            if (char === ' ') return ' ';
            if (i < revealedCount) return char;
            return chars[Math.floor(Math.random() * chars.length)];
          }).join('');
        },
        onComplete: () => {
          description.textContent = originalText;
        }
      }, 0.8);
    }

    // Form fade in
    if (form) {
      tl.to(form, {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: 'power3.out'
      }, 0.9);
    }

    // Thumbnails and counter
    if (thumbnails) {
      tl.to(thumbnails, {
        opacity: 1,
        y: 0,
        duration: 0.6,
        ease: 'power3.out'
      }, 1);
    }

    if (counter) {
      tl.to(counter, {
        opacity: 1,
        y: 0,
        duration: 0.6,
        ease: 'power3.out'
      }, 1);
    }

    // Scroll hint
    if (scrollHint) {
      tl.to(scrollHint, {
        opacity: 1,
        duration: 0.6,
        ease: 'power2.out'
      }, 1.2);
    }
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProductAnimation);
  } else {
    initProductAnimation();
  }

  // Reinitialize after Swup
  window.addEventListener('swup:contentReplaced', () => {
    requestAnimationFrame(initProductAnimation);
  });
})();
</script>

<script>
(function() {
  function setupBuyButton() {
    const buyButtonWrapper = document.querySelector('shopify-buy-it-now-button');
    if (!buyButtonWrapper) {
      setTimeout(setupBuyButton, 100);
      return;
    }

    const button = buyButtonWrapper.querySelector('button');
    if (!button) {
      setTimeout(setupBuyButton, 100);
      return;
    }

    // Check if already set up
    if (button.dataset.piecesHover) return;
    button.dataset.piecesHover = 'true';

    // Create the fill overlay element
    const fillOverlay = document.createElement('span');
    fillOverlay.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-primary);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 0;
      pointer-events: none;
    `;

    // Wrap button text in a span for z-index control
    const buttonText = button.textContent;
    button.textContent = '';

    const textSpan = document.createElement('span');
    textSpan.textContent = buttonText;
    textSpan.style.cssText = `
      position: relative;
      z-index: 1;
      transition: color 0.4s ease;
    `;

    button.appendChild(fillOverlay);
    button.appendChild(textSpan);

    // Add hover listeners
    button.addEventListener('mouseenter', () => {
      fillOverlay.style.transformOrigin = 'left';
      fillOverlay.style.transform = 'scaleX(1)';
      textSpan.style.color = 'var(--color-primary-contrast)';
    });

    button.addEventListener('mouseleave', () => {
      fillOverlay.style.transformOrigin = 'right';
      fillOverlay.style.transform = 'scaleX(0)';
      textSpan.style.color = '';
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupBuyButton);
  } else {
    setupBuyButton();
  }

  // Watch for dynamic insertion of the button
  const observer = new MutationObserver(() => {
    const buyButtonWrapper = document.querySelector('shopify-buy-it-now-button');
    if (buyButtonWrapper && buyButtonWrapper.querySelector('button')) {
      setupBuyButton();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Reinitialize after Swup page transitions
  window.addEventListener('swup:contentReplaced', () => {
    setTimeout(setupBuyButton, 100);
  });
})();
</script>

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
