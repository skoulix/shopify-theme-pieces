{%- comment -%}
  Cart Footer Section - Tailwind Version
  Subtotal, discounts, and checkout button
{%- endcomment -%}

<div
  class="{% if cart == empty %}hidden{% endif %}"
  id="main-cart-footer"
  data-id="{{ section.id }}"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8 lg:pb-12">
    <div class="lg:grid lg:grid-cols-12 lg:gap-8">
      {%- comment -%} Left Side - Cart Note {%- endcomment -%}
      <div class="lg:col-span-7">
        {%- if settings.show_cart_note -%}
          <cart-note class="block">
            <label for="Cart-note" class="text-sm font-medium text-neutral-700 mb-2 block">
              {{ 'sections.cart.note' | t }}
            </label>
            <textarea
              class="w-full px-4 py-3 text-sm border border-neutral-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"
              name="note"
              form="cart"
              id="Cart-note"
              rows="3"
              placeholder="{{ 'sections.cart.note' | t }}"
            >{{ cart.note }}</textarea>
          </cart-note>
        {%- endif -%}
      </div>

      {%- comment -%} Right Side - Totals & Checkout {%- endcomment -%}
      <div class="lg:col-span-5 mt-8 lg:mt-0">
        <div class="bg-neutral-50 rounded-xl p-6 space-y-4">
          {% for block in section.blocks %}
            {%- case block.type -%}
              {%- when '@app' -%}
                <div {{ block.shopify_attributes }}>
                  {% render block %}
                </div>

              {%- when 'subtotal' -%}
                <div class="js-contents space-y-4" {{ block.shopify_attributes }}>
                  {%- comment -%} Cart Discounts {%- endcomment -%}
                  {%- if cart.cart_level_discount_applications.size > 0 -%}
                    <ul class="space-y-2">
                      {%- for discount in cart.cart_level_discount_applications -%}
                        <li class="flex items-center justify-between text-sm">
                          <span class="flex items-center gap-2 text-green-600">
                            {%- render 'icon', name: 'tag', size: '14' -%}
                            {{ discount.title | escape }}
                          </span>
                          <span class="text-green-600 font-medium">-{{ discount.total_allocated_amount | money }}</span>
                        </li>
                      {%- endfor -%}
                    </ul>
                  {%- endif -%}

                  {%- comment -%} Subtotal {%- endcomment -%}
                  <div class="flex items-center justify-between pt-4 border-t border-neutral-200">
                    <h2 class="text-base font-medium text-neutral-900">{{ 'sections.cart.estimated_total' | t }}</h2>
                    <p class="text-lg font-semibold text-neutral-900">{{ cart.total_price | money_with_currency }}</p>
                  </div>

                  {%- comment -%} Tax Note {%- endcomment -%}
                  <p class="text-xs text-neutral-500">
                    {%- if cart.duties_included and cart.taxes_included -%}
                      {%- if shop.shipping_policy.body == blank -%}
                        {{ 'sections.cart.duties_and_taxes_included_shipping_at_checkout_without_policy' | t }}
                      {%- else -%}
                        {{ 'sections.cart.duties_and_taxes_included_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    {%- elsif cart.duties_included == false and cart.taxes_included -%}
                      {%- if shop.shipping_policy.body == blank -%}
                        {{ 'sections.cart.taxes_included_shipping_at_checkout_without_policy' | t }}
                      {%- else -%}
                        {{ 'sections.cart.taxes_included_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    {%- elsif cart.duties_included and cart.taxes_included == false -%}
                      {%- if shop.shipping_policy.body == blank -%}
                        {{ 'sections.cart.duties_included_taxes_at_checkout_shipping_at_checkout_without_policy' | t }}
                      {%- else -%}
                        {{ 'sections.cart.duties_included_taxes_at_checkout_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    {%- else -%}
                      {%- if shop.shipping_policy.body == blank -%}
                        {{ 'sections.cart.taxes_at_checkout_shipping_at_checkout_without_policy' | t }}
                      {%- else -%}
                        {{ 'sections.cart.taxes_at_checkout_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    {%- endif -%}
                  </p>
                </div>

              {%- when 'buttons' -%}
                <div class="space-y-3" {{ block.shopify_attributes }}>
                  <button
                    type="submit"
                    id="checkout"
                    class="w-full py-4 px-6 bg-neutral-900 text-white text-base font-medium rounded-lg hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    name="checkout"
                    {% if cart == empty %}disabled{% endif %}
                    form="cart"
                  >
                    {{ 'sections.cart.checkout' | t }}
                  </button>

                  {%- if additional_checkout_buttons -%}
                    <div class="[&_.additional-checkout-button]:!w-full [&_.additional-checkout-button]:!rounded-lg">
                      {{ content_for_additional_checkout_buttons }}
                    </div>
                  {%- endif -%}
                </div>
            {%- endcase -%}
          {% endfor %}

          <div id="cart-errors" class="text-sm text-red-600"></div>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.main-cart-footer.name",
  "class": "cart__footer-wrapper",
  "settings": [],
  "blocks": [
    {
      "type": "subtotal",
      "name": "t:sections.main-cart-footer.blocks.subtotal.name",
      "limit": 1
    },
    {
      "type": "buttons",
      "name": "t:sections.main-cart-footer.blocks.buttons.name",
      "limit": 1
    },
    {
      "type": "@app"
    }
  ]
}
{% endschema %}
