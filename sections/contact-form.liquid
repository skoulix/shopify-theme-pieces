{%- comment -%}
  Contact Form Section - Large typography header matching collection/page templates
{%- endcomment -%}

{%- liquid
  capture container_class
    render 'container-class', full_width: section.settings.full_width, full_class: 'container-fluid'
  endcapture

  assign heading = section.settings.title | default: 'Contact'

  capture text_align
    render 'alignment-classes', alignment: section.settings.header_alignment, output: 'text'
  endcapture

  capture desc_align
    render 'alignment-classes', alignment: section.settings.header_alignment, output: 'margin'
  endcapture
-%}

<style>
  /* Title line stagger (managed by TweenManager) */
  .contact-section-{{ section.id }} .page-title .tween-split-line:nth-child(2) { margin-left: clamp(1.5rem, 10vw, 8rem); }
  .contact-section-{{ section.id }} .page-title .tween-split-line:nth-child(3) { margin-left: clamp(3rem, 18vw, 14rem); }
  .contact-form-input { transition: border-color 0.3s ease, box-shadow 0.3s ease; }
  .contact-form-input:focus { box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-primary) 20%, transparent); }
</style>

<section class="contact-section-{{ section.id }} color-{{ section.settings.color_scheme }} page-padding" data-contact-wrapper>
  <header class="section-header-spacing {{ container_class }} {{ text_align }}" data-tween-group="contact-header-{{ section.id }}" data-tween-start="top bottom">
    {% if section.settings.label != blank %}
      <span class="section-label" data-tween data-tween-type="fade-up">{{ section.settings.label }}</span>
    {% endif %}

    {% if heading != blank %}
      <h1 class="page-title" data-tween data-tween-type="split-text">
        {{ heading }}
      </h1>
    {% endif %}

    {% if section.settings.description != blank %}
      <p class="mt-8 max-w-105 text-sm{% if settings.headings_uppercase %} uppercase{% endif %} tracking-wider leading-relaxed text-(--color-text-secondary) {{ desc_align }}" data-contact-description{% if section.settings.enable_description_shuffle %} data-shuffle-text data-original-text="{{ section.settings.description | escape }}"{% else %} data-tween data-tween-type="fade-up"{% endif %}>
        {{ section.settings.description }}
      </p>
    {% endif %}
  </header>

  <div class="{{ container_class }}">
    <div class="grid lg:grid-cols-12 gap-8 lg:gap-16 xl:gap-20">
      {%- comment -%} Left: Contact Form {%- endcomment -%}
      <div class="contact-form lg:col-span-8 xl:col-span-7" data-tween data-tween-type="fade-up">
        {% form 'contact', id: 'ContactForm' %}
        {% if form.posted_successfully? %}
          <div class="mb-8 rounded-(--card-radius) bg-green-50 p-4">
            <div class="flex items-center">
              <i class="ph ph-check-circle text-green-400 text-xl mr-3"></i>
              <p class="text-sm font-medium text-green-800">{{ 'contact.form.success' | t }}</p>
            </div>
          </div>
        {% endif %}

        {% if form.errors %}
          <div class="mb-8 rounded-(--card-radius) bg-red-50 p-4">
            <div class="flex items-center">
              <i class="ph ph-warning text-red-400 text-xl mr-3"></i>
              <p class="text-sm font-medium text-red-800">
                {{ form.errors.translated_fields.email | capitalize }} {{ form.errors.messages.email }}
              </p>
            </div>
          </div>
        {% endif %}

        <div class="grid gap-6 sm:grid-cols-2">
          <div class="contact-form-group">
            <label for="ContactForm-name" class="block text-label-sm text-(--color-text-secondary) mb-2">{{ 'contact.form.name' | t }}</label>
            <input
              type="text"
              id="ContactForm-name"
              name="contact[name]"
              autocomplete="name"
              value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-(--color-text) bg-(--color-background) border-(length:--input-border-width) border-solid border-(--color-border) rounded-(--input-radius) placeholder:text-(--color-text-secondary) focus:border-(--color-primary) focus:outline-none text-sm"
            >
          </div>

          <div class="contact-form-group">
            <label for="ContactForm-email" class="block text-label-sm text-(--color-text-secondary) mb-2">{{ 'contact.form.email' | t }} *</label>
            <input
              type="email"
              id="ContactForm-email"
              name="contact[email]"
              autocomplete="email"
              required
              value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-(--color-text) bg-(--color-background) border-(length:--input-border-width) border-solid border-(--color-border) rounded-(--input-radius) placeholder:text-(--color-text-secondary) focus:border-(--color-primary) focus:outline-none text-sm"
            >
          </div>

          <div class="contact-form-group sm:col-span-2">
            <label for="ContactForm-phone" class="block text-label-sm text-(--color-text-secondary) mb-2">{{ 'contact.form.phone' | t }}</label>
            <input
              type="tel"
              id="ContactForm-phone"
              name="contact[phone]"
              autocomplete="tel"
              value="{% if form.phone %}{{ form.phone }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-(--color-text) bg-(--color-background) border-(length:--input-border-width) border-solid border-(--color-border) rounded-(--input-radius) placeholder:text-(--color-text-secondary) focus:border-(--color-primary) focus:outline-none text-sm"
            >
          </div>

          <div class="contact-form-group sm:col-span-2">
            <label for="ContactForm-body" class="block text-label-sm text-(--color-text-secondary) mb-2">{{ 'contact.form.message' | t }}</label>
            <textarea
              id="ContactForm-body"
              name="contact[body]"
              rows="5"
              class="contact-form-input block w-full py-3 px-4 text-(--color-text) bg-(--color-background) border-(length:--input-border-width) border-solid border-(--color-border) rounded-(--input-radius-textarea) placeholder:text-(--color-text-secondary) focus:border-(--color-primary) focus:outline-none text-sm resize-none"
            >{{ form.body }}</textarea>
          </div>
        </div>

        <div class="contact-form-submit mt-8">
          {%- liquid
            assign submit_text = 'contact.form.submit' | t
          -%}
          {% render 'button',
              type: 'submit',
              text: submit_text,
              style: section.settings.button_style,
              color: section.settings.button_color,
              size: section.settings.button_size,
              show_arrow: true
          %}
        </div>
      {% endform %}
      </div>

      {%- comment -%} Right on desktop, below on mobile: Social Links {%- endcomment -%}
      {% if section.settings.show_social_links %}
        <div class="contact-social flex flex-col lg:col-span-4 xl:col-span-5 lg:justify-center" data-tween data-tween-type="fade-up">
          {% if section.settings.social_heading != blank %}
            <h3 class="text-label-sm text-(--color-text-secondary) mb-6">{{ section.settings.social_heading }}</h3>
          {% endif %}

          <div class="flex flex-row flex-wrap gap-3 lg:flex-col lg:gap-4">
            {%- if settings.social_twitter_link != blank -%}
              <a href="{{ settings.social_twitter_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="X (Twitter)">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-x-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">X / Twitter</span>
              </a>
            {%- endif -%}

            {%- if settings.social_facebook_link != blank -%}
              <a href="{{ settings.social_facebook_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="Facebook">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-facebook-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">Facebook</span>
              </a>
            {%- endif -%}

            {%- if settings.social_instagram_link != blank -%}
              <a href="{{ settings.social_instagram_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="Instagram">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-instagram-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">Instagram</span>
              </a>
            {%- endif -%}

            {%- if settings.social_tiktok_link != blank -%}
              <a href="{{ settings.social_tiktok_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="TikTok">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-tiktok-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">TikTok</span>
              </a>
            {%- endif -%}

            {%- if settings.social_youtube_link != blank -%}
              <a href="{{ settings.social_youtube_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="YouTube">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-youtube-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">YouTube</span>
              </a>
            {%- endif -%}

            {%- if settings.social_pinterest_link != blank -%}
              <a href="{{ settings.social_pinterest_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="Pinterest">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-pinterest-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">Pinterest</span>
              </a>
            {%- endif -%}

            {%- if settings.social_linkedin_link != blank -%}
              <a href="{{ settings.social_linkedin_link }}" target="_blank" rel="noopener" class="group flex items-center gap-3 text-(--color-text) no-underline transition-colors hover:text-(--color-primary)" aria-label="LinkedIn">
                <span class="flex items-center justify-center w-10 h-10 rounded-full border border-(--color-border) group-hover:border-(--color-primary) group-hover:bg-(--color-primary) group-hover:text-(--color-primary-contrast) transition-all">
                  <i class="ph ph-linkedin-logo text-lg"></i>
                </span>
                <span class="hidden lg:inline text-sm font-medium">LinkedIn</span>
              </a>
            {%- endif -%}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% if section.settings.enable_description_shuffle %}
<script>
(function() {
  const wrapper = document.querySelector('[data-contact-wrapper]');
  if (!wrapper || wrapper.dataset.shuffleInitialized) return;
  wrapper.dataset.shuffleInitialized = 'true';

  // If animations disabled, skip shuffle
  if (typeof window.shouldAnimate === 'function' && !window.shouldAnimate()) return;

  function initShuffle() {
    const description = wrapper.querySelector('[data-contact-description][data-shuffle-text]');
    if (!description) return;

    let gsap = window.gsap;
    if (!gsap && window.pieces && window.pieces.gsap) {
      gsap = window.pieces.gsap;
    }

    if (!gsap) {
      requestAnimationFrame(initShuffle);
      return;
    }

    const originalText = description.dataset.originalText || description.textContent.trim();
    const chars = {% if settings.headings_uppercase %}'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&*'{% else %}'abcdefghijklmnopqrstuvwxyz0123456789!@#$%&*'{% endif %};

    // Lock height before animation
    const initialHeight = description.offsetHeight;
    description.style.height = initialHeight + 'px';

    // Start with scrambled text
    description.textContent = originalText.split('').map(char =>
      char === ' ' ? ' ' : chars[Math.floor(Math.random() * chars.length)]
    ).join('');
    gsap.set(description, { opacity: 0 });

    const tl = gsap.timeline({ delay: 0.6 });

    // Fade in
    tl.to(description, {
      opacity: 1,
      duration: 0.4,
      ease: 'power2.out'
    }, 0);

    // Shuffle animation
    const shuffleObj = { progress: 0 };
    tl.to(shuffleObj, {
      progress: 1,
      duration: 1.8,
      ease: 'none',
      onUpdate: () => {
        const progress = shuffleObj.progress;
        const revealedCount = Math.floor(progress * originalText.length);
        description.textContent = originalText.split('').map((char, i) => {
          if (char === ' ') return ' ';
          if (i < revealedCount) return char;
          return chars[Math.floor(Math.random() * chars.length)];
        }).join('');
      },
      onComplete: () => {
        description.textContent = originalText;
        description.style.height = '';
      }
    }, 0);
  }

  if (document.readyState === 'complete') {
    initShuffle();
  } else {
    window.addEventListener('load', initShuffle);
  }
})();
</script>
{% endif %}

{% schema %}
{
  "name": "Contact form",
  "settings": [
    {
      "type": "text",
      "id": "label",
      "label": "Label"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Contact"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Have a question or want to work together? Drop us a message and we'll get back to you as soon as possible."
    },
    {
      "type": "checkbox",
      "id": "enable_description_shuffle",
      "label": "Enable description shuffle effect",
      "default": false,
      "info": "Animate description with text scramble effect on page load"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "default": "solid",
      "options": [
        { "value": "solid", "label": "Solid" },
        { "value": "outline", "label": "Outline" }
      ]
    },
    {
      "type": "select",
      "id": "button_color",
      "label": "Button color",
      "default": "primary",
      "options": [
        { "value": "primary", "label": "Primary (accent)" },
        { "value": "secondary", "label": "Secondary (neutral)" }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button size",
      "default": "default",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "default", "label": "Default" },
        { "value": "large", "label": "Large" }
      ]
    },
    {
      "type": "header",
      "content": "Social links"
    },
    {
      "type": "checkbox",
      "id": "show_social_links",
      "label": "Show social links",
      "default": true,
      "info": "Display social media links next to the form (uses global social settings)"
    },
    {
      "type": "text",
      "id": "social_heading",
      "label": "Social heading",
      "default": "Follow us"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Contact form",
      "category": "Store information"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
  }
{% endschema %}
