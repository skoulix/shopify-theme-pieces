{%- comment -%}
  Contact Form Section - Large typography header matching collection/page templates
{%- endcomment -%}

{%- liquid
  if section.settings.full_width
    assign container_class = 'page-full'
  else
    assign container_class = 'page-container'
  endif

  assign heading = section.settings.heading | default: 'Contact'
-%}

<style>
  .contact-header-title { font-size: calc(clamp(2.5rem, 10vw, 4.5rem) * var(--heading-font-scale, 1)); letter-spacing: -0.03em; line-height: 0.9; }
  @media (min-width: 1024px) { .contact-header-title { font-size: calc(clamp(3.5rem, 7vw, 6rem) * var(--heading-font-scale, 1)); } }
  @media (min-width: 1536px) { .contact-header-title { font-size: calc(clamp(4.5rem, 6vw, 8rem) * var(--heading-font-scale, 1)); } }
  .contact-header-title-line:nth-child(2) { margin-left: clamp(1.5rem, 10vw, 8rem); }
  .contact-header-title-line:nth-child(3) { margin-left: clamp(3rem, 18vw, 14rem); }
  .contact-wrapper.is-loading .contact-header-title-line span { opacity: 0; transform: translateY(100%); }
  .contact-wrapper.is-loading .contact-form { opacity: 0; transform: translateY(30px); }
  .contact-form-input { transition: border-color 0.3s ease, box-shadow 0.3s ease; }
  .contact-form-input:focus { box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb, 79, 70, 229), 0.1); }
</style>

<section class="contact-wrapper is-loading bg-[--color-background]" data-contact-wrapper>
  <header class="pt-[--page-vertical-padding] pb-16 {{ container_class }}">
    <h1 class="contact-header-title font-bold text-[--color-text] font-heading">
      {%- assign title_words = heading | split: ' ' -%}
      {%- for word in title_words -%}
        <span class="contact-header-title-line block overflow-hidden">
          <span class="inline-block">{{ word }}</span>
        </span>
      {%- endfor -%}
    </h1>

    {% if section.settings.subheading != blank %}
      <p class="mt-8 max-w-[420px] text-xs uppercase tracking-[0.05em] leading-relaxed text-[--color-text-secondary] pl-[0.15em]">
        {{ section.settings.subheading }}
      </p>
    {% endif %}
  </header>

  <div class="{{ container_class }} pb-[--page-vertical-padding]">
    <div class="contact-form max-w-2xl">
      {% form 'contact', id: 'ContactForm' %}
        {% if form.posted_successfully? %}
          <div class="mb-8 rounded-[--card-radius] bg-green-50 p-4">
            <div class="flex items-center">
              <i class="ph ph-check-circle text-green-400 text-xl mr-3"></i>
              <p class="text-sm font-medium text-green-800">Thanks for your message! We'll get back to you soon.</p>
            </div>
          </div>
        {% endif %}

        {% if form.errors %}
          <div class="mb-8 rounded-[--card-radius] bg-red-50 p-4">
            <div class="flex items-center">
              <i class="ph ph-warning text-red-400 text-xl mr-3"></i>
              <p class="text-sm font-medium text-red-800">
                {{ form.errors.translated_fields.email | capitalize }} {{ form.errors.messages.email }}
              </p>
            </div>
          </div>
        {% endif %}

        <div class="grid gap-6 sm:grid-cols-2">
          <div>
            <label for="ContactForm-name" class="block text-xs font-semibold uppercase tracking-[0.1em] text-[--color-text-secondary] mb-2">Name</label>
            <input
              type="text"
              id="ContactForm-name"
              name="contact[name]"
              autocomplete="name"
              value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-[--color-text] bg-[--color-background] border border-[--color-border] rounded-[--input-radius] placeholder:text-[--color-text-secondary] focus:border-[--color-primary] focus:outline-none text-sm"
              style="border-width: var(--input-border-width);"
            >
          </div>

          <div>
            <label for="ContactForm-email" class="block text-xs font-semibold uppercase tracking-[0.1em] text-[--color-text-secondary] mb-2">Email *</label>
            <input
              type="email"
              id="ContactForm-email"
              name="contact[email]"
              autocomplete="email"
              required
              value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-[--color-text] bg-[--color-background] border border-[--color-border] rounded-[--input-radius] placeholder:text-[--color-text-secondary] focus:border-[--color-primary] focus:outline-none text-sm"
              style="border-width: var(--input-border-width);"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="ContactForm-phone" class="block text-xs font-semibold uppercase tracking-[0.1em] text-[--color-text-secondary] mb-2">Phone</label>
            <input
              type="tel"
              id="ContactForm-phone"
              name="contact[phone]"
              autocomplete="tel"
              value="{% if form.phone %}{{ form.phone }}{% endif %}"
              class="contact-form-input block w-full py-3 px-4 text-[--color-text] bg-[--color-background] border border-[--color-border] rounded-[--input-radius] placeholder:text-[--color-text-secondary] focus:border-[--color-primary] focus:outline-none text-sm"
              style="border-width: var(--input-border-width);"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="ContactForm-body" class="block text-xs font-semibold uppercase tracking-[0.1em] text-[--color-text-secondary] mb-2">Message</label>
            <textarea
              id="ContactForm-body"
              name="contact[body]"
              rows="5"
              class="contact-form-input block w-full py-3 px-4 text-[--color-text] bg-[--color-background] border border-[--color-border] rounded-[--input-radius] placeholder:text-[--color-text-secondary] focus:border-[--color-primary] focus:outline-none text-sm resize-none"
              style="border-width: var(--input-border-width);"
            >{{ form.body }}</textarea>
          </div>
        </div>

        <div class="mt-8">
          <button type="submit" class="btn btn--primary">
            <span>Send message</span>
            <i class="ph ph-arrow-right"></i>
          </button>
        </div>
      {% endform %}
    </div>
  </div>
</section>

<script>
(function() {
  const wrapper = document.querySelector('[data-contact-wrapper]');
  if (!wrapper || wrapper.dataset.contactInitialized) return;
  wrapper.dataset.contactInitialized = 'true';

  function animateHeader() {
    const titleLines = wrapper.querySelectorAll('.contact-header-title-line span');
    const form = wrapper.querySelector('.contact-form');

    if (typeof gsap === 'undefined') {
      wrapper.classList.remove('is-loading');
      return;
    }

    const tl = gsap.timeline({
      onComplete: () => wrapper.classList.remove('is-loading')
    });

    // Title lines slide up
    tl.to(titleLines, {
      y: 0,
      opacity: 1,
      duration: 0.8,
      stagger: 0.1,
      ease: 'power3.out'
    }, 0.2);

    // Form fades in
    if (form) {
      tl.to(form, {
        y: 0,
        opacity: 1,
        duration: 0.6,
        ease: 'power2.out'
      }, 0.5);
    }
  }

  if (document.readyState === 'complete') {
    animateHeader();
  } else {
    window.addEventListener('load', animateHeader);
  }

  window.addEventListener('swup:contentReplaced', () => {
    const newWrapper = document.querySelector('[data-contact-wrapper]');
    if (newWrapper && !newWrapper.dataset.contactInitialized) {
      newWrapper.dataset.contactInitialized = 'true';
      animateHeader();
    }
  });
})();
</script>

{% schema %}
{
  "name": "Contact form",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Contact"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Have a question or want to work together? Drop us a message and we'll get back to you as soon as possible."
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Full width"
    }
  ],
  "presets": [
    {
      "name": "Contact form"
    }
  ]
}
{% endschema %}
