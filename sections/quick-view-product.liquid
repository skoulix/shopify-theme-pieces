{%- comment -%}
  Quick View Product Section
  Loaded via AJAX for quick view modal
{%- endcomment -%}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = current_variant.featured_image | default: product.featured_image
-%}

<div class="quick-view-product grid md:grid-cols-2 gap-6 p-6 lg:p-8">
  {%- comment -%} Product Images {%- endcomment -%}
  <div class="quick-view-product__images">
    <div class="aspect-square overflow-hidden rounded-[--card-radius] bg-[--color-background-secondary]">
      {% if featured_image %}
        {{ featured_image | image_url: width: 800 | image_tag:
          class: 'w-full h-full object-cover',
          loading: 'eager',
          alt: product.title
        }}
      {% else %}
        <div class="w-full h-full flex items-center justify-center">
          <i class="ph ph-image text-6xl text-[--color-text-secondary] opacity-30"></i>
        </div>
      {% endif %}
    </div>

    {% if product.images.size > 1 %}
      <div class="flex gap-2 mt-4 overflow-x-auto pb-2">
        {% for image in product.images limit: 6 %}
          <button
            type="button"
            class="w-16 h-16 flex-shrink-0 rounded-[--card-radius] overflow-hidden border-2 {% if image == featured_image %}border-[--color-primary]{% else %}border-transparent{% endif %}"
            aria-label="View image {{ forloop.index }}"
          >
            {{ image | image_url: width: 200 | image_tag:
              class: 'w-full h-full object-cover',
              loading: 'lazy',
              alt: product.title
            }}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {%- comment -%} Product Info {%- endcomment -%}
  <div class="quick-view-product__info">
    {% if product.vendor != blank %}
      <p class="text-sm text-[--color-text-secondary] uppercase tracking-wider mb-2">
        {{ product.vendor }}
      </p>
    {% endif %}

    <h2 class="text-2xl font-semibold font-heading mb-4">
      {{ product.title }}
    </h2>

    <div class="flex items-center gap-3 mb-6">
      <span class="text-2xl font-semibold" data-quick-view-price>
        {{ current_variant.price | money }}
      </span>
      {% if current_variant.compare_at_price > current_variant.price %}
        <span class="text-lg text-[--color-text-secondary] line-through" data-quick-view-compare>
          {{ current_variant.compare_at_price | money }}
        </span>
        <span class="px-2 py-1 text-xs font-semibold bg-[--color-sale] text-white rounded">
          {% assign save_percent = current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round %}
          -{{ save_percent }}%
        </span>
      {% endif %}
    </div>

    {% if product.description != blank %}
      <div class="prose prose-sm text-[--color-text-secondary] mb-6 line-clamp-3">
        {{ product.description | strip_html | truncate: 200 }}
      </div>
    {% endif %}

    {%- comment -%} Product Form {%- endcomment -%}
    {% form 'product', product, class: 'quick-view-product__form' %}
      <input type="hidden" name="id" value="{{ current_variant.id }}">

      {%- comment -%} Variant Selectors {%- endcomment -%}
      {% unless product.has_only_default_variant %}
        <div class="space-y-4 mb-6">
          {% for option in product.options_with_values %}
            <div>
              <label for="quick-view-option-{{ option.name | handleize }}" class="block text-sm font-medium mb-2">
                {{ option.name }}
              </label>
              <select
                id="quick-view-option-{{ option.name | handleize }}"
                name="options[{{ option.name }}]"
                data-variant-select
                class="input w-full"
              >
                {% for value in option.values %}
                  <option
                    value="{{ value }}"
                    {% if option.selected_value == value %}selected{% endif %}
                  >
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
        </div>
      {% endunless %}

      {%- comment -%} Quantity {%- endcomment -%}
      <div class="mb-6">
        <label for="quick-view-quantity" class="block text-sm font-medium mb-2">
          {{ 'products.product.quantity' | t }}
        </label>
        <div class="flex items-center border border-[--color-border] rounded-[--input-radius] w-fit">
          <button
            type="button"
            class="w-10 h-10 flex items-center justify-center hover:bg-[--color-background-secondary] transition-colors"
            data-qty-minus
            aria-label="{{ 'products.product.decrease_quantity' | t }}"
          >
            <i class="ph ph-minus"></i>
          </button>
          <input
            type="number"
            id="quick-view-quantity"
            name="quantity"
            value="1"
            min="1"
            class="w-14 h-10 text-center border-x border-[--color-border] bg-transparent"
            data-qty-input
          >
          <button
            type="button"
            class="w-10 h-10 flex items-center justify-center hover:bg-[--color-background-secondary] transition-colors"
            data-qty-plus
            aria-label="{{ 'products.product.increase_quantity' | t }}"
          >
            <i class="ph ph-plus"></i>
          </button>
        </div>
      </div>

      {%- comment -%} Add to Cart Button {%- endcomment -%}
      <button
        type="submit"
        class="btn btn-primary w-full"
        {% unless current_variant.available %}disabled{% endunless %}
      >
        <span data-add-text>
          {% if current_variant.available %}
            {{ 'products.product.add_to_cart' | t }}
          {% else %}
            {{ 'products.product.sold_out' | t }}
          {% endif %}
        </span>
        <span data-adding-text class="hidden">{{ 'cart.adding' | t }}</span>
        <span data-added-text class="hidden">{{ 'cart.added' | t }}</span>
      </button>

      {%- comment -%} View Full Product Link {%- endcomment -%}
      <a href="{{ product.url }}" class="block text-center mt-4 text-sm text-[--color-text-secondary] hover:text-[--color-primary] underline">
        {{ 'products.product.view_product' | t }}
      </a>
    {% endform %}

    {%- comment -%} Product JSON for variant switching {%- endcomment -%}
    <script type="application/json" data-product-json>
      {{ product | json }}
    </script>
  </div>
</div>

<script>
  // Quantity controls
  (function() {
    const qtyInput = document.querySelector('[data-qty-input]');
    const qtyMinus = document.querySelector('[data-qty-minus]');
    const qtyPlus = document.querySelector('[data-qty-plus]');

    if (qtyInput && qtyMinus && qtyPlus) {
      qtyMinus.addEventListener('click', () => {
        const val = parseInt(qtyInput.value) || 1;
        if (val > 1) qtyInput.value = val - 1;
      });

      qtyPlus.addEventListener('click', () => {
        const val = parseInt(qtyInput.value) || 1;
        qtyInput.value = val + 1;
      });
    }
  })();
</script>

{% schema %}
{
  "name": "Quick view product",
  "settings": []
}
{% endschema %}
