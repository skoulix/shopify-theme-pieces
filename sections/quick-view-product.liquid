{%- comment -%}
  Quick View Product Section
  Loaded via AJAX for quick view modal
  Modern compact layout optimized for bottom-right modal
{%- endcomment -%}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = current_variant.featured_image | default: product.featured_image
-%}

<div class="quick-view-product h-full grid grid-cols-1 md:grid-cols-2 grid-rows-[auto_1fr] md:grid-rows-1">
  {%- comment -%} Product Images {%- endcomment -%}
  <div class="quick-view-product__images relative w-full aspect-square md:aspect-auto md:h-full overflow-hidden">
    <div class="absolute inset-0 bg-[--color-background-secondary]" data-main-image-wrapper>
      {% if featured_image %}
        <img
          src="{{ featured_image | image_url: width: 800 }}"
          width="{{ featured_image.width }}"
          height="{{ featured_image.height }}"
          class="w-full h-full object-cover"
          loading="eager"
          alt="{{ product.title | escape }}"
          data-main-image
        >
      {% else %}
        <div class="w-full h-full flex items-center justify-center">
          <i class="ph ph-image text-6xl text-[--color-text-secondary] opacity-30"></i>
        </div>
      {% endif %}
    </div>

    {% if product.images.size > 1 %}
      <div class="absolute bottom-4 left-4 right-4 flex justify-center gap-2 overflow-x-auto py-2" data-thumbnails>
        {% for image in product.images limit: 5 %}
          <button
            type="button"
            class="quick-view-thumbnail w-12 h-12 flex-shrink-0 rounded-lg overflow-hidden border-2 transition-all bg-[--color-background] shadow-md {% if image == featured_image %}border-[--color-primary] is-active{% else %}border-transparent hover:border-[--color-primary]{% endif %}"
            aria-label="View image {{ forloop.index }}"
            data-thumbnail
            data-image-id="{{ image.id }}"
            data-image-src="{{ image | image_url: width: 800 }}"
          >
            {{ image | image_url: width: 150 | image_tag:
              class: 'w-full h-full object-cover',
              loading: 'lazy',
              alt: product.title
            }}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {%- comment -%} Product Info {%- endcomment -%}
  <div class="quick-view-product__info flex flex-col p-5 md:p-6 overflow-visible md:overflow-y-auto md:h-full overscroll-contain" data-lenis-prevent>
    {% if product.vendor != blank %}
      <p class="text-xs text-[--color-text-secondary] uppercase tracking-wider mb-1">
        {{ product.vendor }}
      </p>
    {% endif %}

    <h2 class="text-lg md:text-xl font-semibold font-heading mb-2 leading-tight text-balance pr-8">
      <a href="{{ product.url }}" class="hover:text-[--color-primary] transition-colors">
        {{ product.title }}
      </a>
    </h2>

    <div class="flex items-center gap-2 mb-3">
      <span class="text-xl font-semibold" data-quick-view-price>
        {{ current_variant.price | money }}
      </span>
      {% if current_variant.compare_at_price > current_variant.price %}
        <span class="text-sm text-[--color-text-secondary] line-through" data-quick-view-compare>
          {{ current_variant.compare_at_price | money }}
        </span>
        <span class="px-1.5 py-0.5 text-[10px] font-semibold bg-[--color-sale] text-white rounded">
          {% assign save_percent = current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round %}
          -{{ save_percent }}%
        </span>
      {% endif %}
    </div>

    {% if product.description != blank %}
      <div class="text-xs text-[--color-text-secondary] mb-4 line-clamp-2">
        {{ product.description | strip_html | truncate: 120 }}
      </div>
    {% endif %}

    {%- comment -%} Product Form {%- endcomment -%}
    {% form 'product', product, class: 'quick-view-product__form flex flex-col flex-1' %}
      <input type="hidden" name="id" value="{{ current_variant.id }}">

      {%- comment -%} Variant Selectors {%- endcomment -%}
      {% unless product.has_only_default_variant %}
        <div class="space-y-3 mb-4">
          {% for option in product.options_with_values %}
            <div>
              <label for="quick-view-option-{{ option.name | handleize }}" class="block text-xs font-medium mb-1.5 text-[--color-text-secondary]">
                {{ option.name }}
              </label>
              <select
                id="quick-view-option-{{ option.name | handleize }}"
                name="options[{{ option.name }}]"
                data-variant-select
                class="input w-full text-sm"
              >
                {% for value in option.values %}
                  <option
                    value="{{ value }}"
                    {% if option.selected_value == value %}selected{% endif %}
                  >
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
        </div>
      {% endunless %}

      {%- comment -%} Quantity and Add to Cart {%- endcomment -%}
      <div class="mt-auto">
        <div class="flex items-center gap-3 mb-3">
          <div class="inline-flex items-center rounded-[--input-radius] border border-[--color-border] overflow-hidden" data-qty-wrapper>
            <button
              type="button"
              class="w-11 h-11 flex items-center justify-center bg-transparent border-none cursor-pointer text-[--color-text] transition-all duration-300 hover:bg-[--color-primary] hover:text-[--color-primary-contrast] active:scale-95"
              data-qty-minus
              aria-label="{{ 'products.product.decrease_quantity' | t }}"
            >
              <i class="ph ph-minus text-sm"></i>
            </button>
            <div class="w-12 h-11 flex items-center justify-center">
              <input
                type="number"
                id="quick-view-quantity"
                name="quantity"
                value="1"
                min="1"
                class="w-full h-full text-center text-base font-semibold bg-transparent !border-0 text-[--color-text] focus:outline-none"
                data-qty-input
              >
            </div>
            <button
              type="button"
              class="w-11 h-11 flex items-center justify-center bg-transparent border-none cursor-pointer text-[--color-text] transition-all duration-300 hover:bg-[--color-primary] hover:text-[--color-primary-contrast] active:scale-95"
              data-qty-plus
              aria-label="{{ 'products.product.increase_quantity' | t }}"
            >
              <i class="ph ph-plus text-sm"></i>
            </button>
          </div>

          {%- comment -%} Add to Cart Button {%- endcomment -%}
          <button
            type="submit"
            class="btn btn--primary flex-1 !h-[2.75rem]"
            {% unless current_variant.available %}disabled{% endunless %}
          >
            <span data-add-text>
              {% if current_variant.available %}
                {{ 'products.product.add_to_cart' | t }}
              {% else %}
                {{ 'products.product.sold_out' | t }}
              {% endif %}
            </span>
            <span data-adding-text class="hidden">{{ 'cart.adding' | t }}</span>
            <span data-added-text class="hidden">{{ 'cart.added' | t }}</span>
          </button>
        </div>

      </div>
    {% endform %}

    {%- comment -%} Product JSON for variant switching {%- endcomment -%}
    <script type="application/json" data-product-json>
      {{ product | json }}
    </script>
  </div>
</div>

{%- comment -%}
  Note: Quantity controls and image gallery are initialized in quick-view-modal.liquid's initQuickViewForm()
{%- endcomment -%}

{% schema %}
{
  "name": "Quick view product",
  "settings": []
}
{% endschema %}
