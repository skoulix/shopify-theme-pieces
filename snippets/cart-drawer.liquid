{% comment %}
  Renders cart drawer - Tailwind version

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>

<style>
  cart-drawer:not(.is-open) .cart-drawer-overlay,
  cart-drawer:not(.is-open) .cart-drawer-panel {
    visibility: hidden;
    pointer-events: none;
  }
  cart-drawer.is-open .cart-drawer-overlay {
    visibility: visible;
    opacity: 1;
  }
  cart-drawer.is-open .cart-drawer-panel {
    visibility: visible;
    transform: translateX(0);
  }
</style>

<cart-drawer class="{% if cart == empty %}is-empty{% endif %}">
  {%- comment -%} Overlay {%- endcomment -%}
  <div
    id="CartDrawer-Overlay"
    class="cart-drawer-overlay fixed inset-0 bg-black/50 z-40 opacity-0 transition-opacity duration-300"
    onclick="this.closest('cart-drawer').close()"
  ></div>

  {%- comment -%} Drawer Panel {%- endcomment -%}
  <div
    id="CartDrawer"
    class="cart-drawer-panel fixed right-0 top-0 h-full w-full max-w-md bg-white z-50 shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col"
    role="dialog"
    aria-modal="true"
    aria-label="{{ 'sections.cart.title' | t }}"
    tabindex="-1"
  >
    {%- comment -%} Header {%- endcomment -%}
    <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-200">
      <h2 class="text-lg font-semibold text-neutral-900">{{ 'sections.cart.title' | t }}</h2>
      <button
        type="button"
        class="p-2 -mr-2 hover:bg-neutral-100 rounded-full transition-colors"
        onclick="this.closest('cart-drawer').close()"
        aria-label="{{ 'accessibility.close' | t }}"
      >
        {%- render 'icon', name: 'close', size: '20' -%}
      </button>
    </div>

    {%- if cart == empty -%}
      {%- comment -%} Empty Cart State {%- endcomment -%}
      <div class="flex-1 flex flex-col items-center justify-center px-6 text-center">
        <div class="w-16 h-16 mb-4 text-neutral-300">
          {%- render 'icon', name: 'shopping-bag', size: '64' -%}
        </div>
        <p class="text-lg font-medium text-neutral-900 mb-2">{{ 'sections.cart.empty' | t }}</p>
        <a
          href="{{ routes.all_products_collection_url }}"
          class="mt-4 inline-flex items-center gap-2 px-6 py-3 bg-neutral-900 text-white text-sm font-medium rounded-lg hover:bg-neutral-800 transition-colors"
        >
          {{ 'general.continue_shopping' | t }}
          {%- render 'icon', name: 'arrow-right', size: '16' -%}
        </a>
        {%- if shop.customer_accounts_enabled and customer == null -%}
          <div class="mt-8 pt-8 border-t border-neutral-200 w-full">
            <p class="text-sm font-medium text-neutral-900 mb-1">{{ 'sections.cart.login.title' | t }}</p>
            <p class="text-sm text-neutral-600">
              {{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}
            </p>
          </div>
        {%- endif -%}
      </div>
    {%- else -%}
      {%- comment -%} Cart Items {%- endcomment -%}
      <cart-drawer-items class="flex-1 overflow-y-auto">
        <form action="{{ routes.cart_url }}" id="CartDrawer-Form" class="h-full flex flex-col" method="post">
          <div id="CartDrawer-CartItems" class="flex-1 px-6 py-4 space-y-4">
            {%- for item in cart.items -%}
              <div
                id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                class="flex gap-4 {% unless forloop.last %}pb-4 border-b border-neutral-100{% endunless %}"
              >
                {%- comment -%} Product Image {%- endcomment -%}
                {%- if item.image -%}
                  <a href="{{ item.url }}" class="flex-shrink-0">
                    <img
                      src="{{ item.image | image_url: width: 120 }}"
                      alt="{{ item.image.alt | escape }}"
                      class="w-20 h-20 object-cover rounded-lg bg-neutral-100"
                      loading="lazy"
                      width="80"
                      height="80"
                    >
                  </a>
                {%- endif -%}

                {%- comment -%} Product Details {%- endcomment -%}
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between gap-2">
                    <div>
                      {%- if settings.show_vendor -%}
                        <p class="text-xs text-neutral-500 uppercase tracking-wider">{{ item.product.vendor }}</p>
                      {%- endif -%}
                      <a href="{{ item.url }}" class="text-sm font-medium text-neutral-900 hover:text-neutral-600 transition-colors line-clamp-2">
                        {{ item.product.title | escape }}
                      </a>
                    </div>
                    <cart-remove-button
                      id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                      data-index="{{ item.index | plus: 1 }}"
                    >
                      <button
                        type="button"
                        class="p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded transition-colors"
                        aria-label="{{ 'sections.cart.remove_title' | t: title: item.title | escape }}"
                        data-variant-id="{{ item.variant.id }}"
                      >
                        {%- render 'icon', name: 'trash', size: '16' -%}
                      </button>
                    </cart-remove-button>
                  </div>

                  {%- comment -%} Variant Options {%- endcomment -%}
                  {%- if item.product.has_only_default_variant == false -%}
                    <p class="mt-1 text-xs text-neutral-500">
                      {%- for option in item.options_with_values -%}
                        {{ option.value }}{% unless forloop.last %} / {% endunless %}
                      {%- endfor -%}
                    </p>
                  {%- endif -%}

                  {%- comment -%} Selling Plan {%- endcomment -%}
                  {%- if item.selling_plan_allocation != null -%}
                    <p class="mt-1 text-xs text-neutral-500">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                  {%- endif -%}

                  {%- comment -%} Discounts {%- endcomment -%}
                  {%- if item.line_level_discount_allocations.size > 0 -%}
                    <ul class="mt-1 space-y-0.5">
                      {%- for discount in item.line_level_discount_allocations -%}
                        <li class="flex items-center gap-1 text-xs text-green-600">
                          {%- render 'icon', name: 'gift', size: '12' -%}
                          {{ discount.discount_application.title }}
                        </li>
                      {%- endfor -%}
                    </ul>
                  {%- endif -%}

                  {%- comment -%} Price and Quantity {%- endcomment -%}
                  <div class="flex items-center justify-between mt-3">
                    <quantity-input class="flex items-center border border-neutral-300 rounded-lg">
                      <button
                        class="w-8 h-8 flex items-center justify-center text-neutral-600 hover:text-neutral-900 transition-colors"
                        name="minus"
                        type="button"
                      >
                        {%- render 'icon', name: 'minus', size: '14' -%}
                      </button>
                      <input
                        class="w-10 h-8 text-center text-sm font-medium border-0 focus:ring-0"
                        type="number"
                        name="updates[]"
                        value="{{ item.quantity }}"
                        min="0"
                        data-index="{{ item.index | plus: 1 }}"
                        aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                      >
                      <button
                        class="w-8 h-8 flex items-center justify-center text-neutral-600 hover:text-neutral-900 transition-colors"
                        name="plus"
                        type="button"
                      >
                        {%- render 'icon', name: 'plus', size: '14' -%}
                      </button>
                    </quantity-input>

                    <div class="text-right">
                      {%- if item.original_line_price != item.final_line_price -%}
                        <p class="text-sm font-medium text-red-600">{{ item.final_line_price | money }}</p>
                        <p class="text-xs text-neutral-400 line-through">{{ item.original_line_price | money }}</p>
                      {%- else -%}
                        <p class="text-sm font-medium text-neutral-900">{{ item.original_line_price | money }}</p>
                      {%- endif -%}
                    </div>
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>

          <p id="CartDrawer-LiveRegionText" class="sr-only" role="status"></p>
          <p id="CartDrawer-LineItemStatus" class="sr-only" aria-hidden="true" role="status">{{ 'accessibility.loading' | t }}</p>
        </form>
      </cart-drawer-items>

      {%- comment -%} Footer {%- endcomment -%}
      <div class="border-t border-neutral-200 px-6 py-4 space-y-4 bg-neutral-50">
        {%- comment -%} Cart Note {%- endcomment -%}
        {%- if settings.show_cart_note -%}
          <details class="group">
            <summary class="flex items-center gap-2 cursor-pointer text-sm text-neutral-600 hover:text-neutral-900 transition-colors">
              {%- render 'icon', name: 'note', size: '16' -%}
              <span>{{ 'sections.cart.note' | t }}</span>
              <span class="ml-auto transform transition-transform group-open:rotate-180">
                {%- render 'icon', name: 'caret-down', size: '12' -%}
              </span>
            </summary>
            <div class="mt-3">
              <textarea
                id="CartDrawer-Note"
                name="note"
                class="w-full px-3 py-2 text-sm border border-neutral-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-neutral-900"
                rows="3"
                placeholder="{{ 'sections.cart.note' | t }}"
              >{{ cart.note }}</textarea>
            </div>
          </details>
        {%- endif -%}

        {%- comment -%} Cart Discounts {%- endcomment -%}
        {%- if cart.cart_level_discount_applications.size > 0 -%}
          <ul class="space-y-1">
            {%- for discount in cart.cart_level_discount_applications -%}
              <li class="flex items-center justify-between text-sm">
                <span class="flex items-center gap-2 text-green-600">
                  {%- render 'icon', name: 'gift', size: '14' -%}
                  {{ discount.title | escape }}
                </span>
                <span class="text-green-600">-{{ discount.total_allocated_amount | money }}</span>
              </li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- comment -%} Subtotal {%- endcomment -%}
        <div class="flex items-center justify-between">
          <span class="text-base font-medium text-neutral-900">{{ 'sections.cart.estimated_total' | t }}</span>
          <span class="text-lg font-semibold text-neutral-900">{{ cart.total_price | money_with_currency }}</span>
        </div>

        {%- comment -%} Tax Note {%- endcomment -%}
        <p class="text-xs text-neutral-500">
          {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
            {{ 'sections.cart.taxes_included_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
          {%- elsif cart.taxes_included -%}
            {{ 'sections.cart.taxes_included_shipping_at_checkout_without_policy' | t }}
          {%- elsif shop.shipping_policy.body != blank -%}
            {{ 'sections.cart.taxes_at_checkout_shipping_at_checkout_with_policy_html' | t: link: shop.shipping_policy.url }}
          {%- else -%}
            {{ 'sections.cart.taxes_at_checkout_shipping_at_checkout_without_policy' | t }}
          {%- endif -%}
        </p>

        {%- comment -%} Checkout Button {%- endcomment -%}
        <button
          type="submit"
          id="CartDrawer-Checkout"
          class="w-full py-3 bg-neutral-900 text-white text-sm font-medium rounded-lg hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          name="checkout"
          form="CartDrawer-Form"
        >
          {{ 'sections.cart.checkout' | t }}
        </button>
      </div>
    {%- endif -%}

    <div id="CartDrawer-CartErrors" role="alert"></div>
  </div>
</cart-drawer>
