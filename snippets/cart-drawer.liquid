{%- comment -%}
  Cart Drawer - Slide-out cart panel
  Renders when settings.cart_type == 'drawer'
{%- endcomment -%}

<div id="cart-drawer" class="cart-drawer" role="dialog" aria-modal="true" inert aria-label="{{ 'cart.title' | t }}">
  {%- comment -%} Backdrop {%- endcomment -%}
  <div class="cart-drawer__backdrop" data-cart-drawer-close></div>

  {%- comment -%} Drawer Panel {%- endcomment -%}
  <div class="cart-drawer__panel">
    {%- comment -%} Header {%- endcomment -%}
    <div class="cart-drawer__header">
      <h2 class="cart-drawer__title font-heading">{{ 'cart.title' | t }}</h2>
      <button type="button" class="cart-drawer__close" data-cart-drawer-close>
        <span class="sr-only">{{ 'cart.close' | t }}</span>
        <i class="ph ph-x"></i>
      </button>
    </div>

    {%- comment -%} Cart Contents {%- endcomment -%}
    <div class="cart-drawer__content" data-cart-drawer-content>
      {% if cart.item_count > 0 %}
        <ul class="cart-drawer__items" role="list">
          {% for item in cart.items %}
            <li class="cart-drawer__item" data-cart-item data-line-index="{{ forloop.index }}">
              <div class="cart-drawer__item-image">
                {% if item.image %}
                  <a href="{{ item.url }}">
                    {{ item.image | image_url: width: 200 | image_tag:
                      class: 'w-full h-full object-cover',
                      loading: 'lazy'
                    }}
                  </a>
                {% endif %}
              </div>

              <div class="cart-drawer__item-details">
                <a href="{{ item.url }}" class="cart-drawer__item-title">
                  {{ item.product.title }}
                </a>
                {% unless item.product.has_only_default_variant %}
                  <p class="cart-drawer__item-variant">{{ item.variant.title }}</p>
                {% endunless %}

                <div class="cart-drawer__item-price">
                  {%- liquid
                    assign has_compare_at = false
                    if item.variant.compare_at_price > item.variant.price
                      assign has_compare_at = true
                      assign compare_at_line_price = item.variant.compare_at_price | times: item.quantity
                    endif
                    assign has_discount = false
                    if item.original_line_price != item.final_line_price
                      assign has_discount = true
                    endif
                  -%}
                  {% if has_compare_at %}
                    <span class="cart-drawer__item-price--compare">{{ compare_at_line_price | money }}</span>
                  {% elsif has_discount %}
                    <span class="cart-drawer__item-price--compare">{{ item.original_line_price | money }}</span>
                  {% endif %}
                  <span class="{% if has_compare_at or has_discount %}sale-price{% endif %}">
                    {{ item.final_line_price | money }}
                  </span>
                </div>

                <div class="cart-drawer__item-actions">
                  <div class="cart-drawer__quantity" data-quantity-wrapper>
                    <button
                      type="button"
                      class="cart-drawer__quantity-btn"
                      data-quantity-minus
                      data-line="{{ forloop.index }}"
                      aria-label="Decrease quantity"
                    >
                      <i class="ph ph-minus"></i>
                    </button>
                    <div class="cart-drawer__quantity-value">
                      <input
                        type="number"
                        class="cart-drawer__quantity-input"
                        value="{{ item.quantity }}"
                        min="0"
                        data-quantity-input
                        data-line="{{ forloop.index }}"
                        aria-label="Quantity"
                      >
                    </div>
                    <button
                      type="button"
                      class="cart-drawer__quantity-btn"
                      data-quantity-plus
                      data-line="{{ forloop.index }}"
                      aria-label="Increase quantity"
                    >
                      <i class="ph ph-plus"></i>
                    </button>
                  </div>
                  <button
                    type="button"
                    class="cart-drawer__remove"
                    data-remove-item
                    data-line="{{ forloop.index }}"
                    aria-label="Remove {{ item.product.title }}"
                  >
                    <i class="ph ph-trash"></i>
                  </button>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="cart-drawer__empty">
          <h3 class="text-xl font-semibold text-[--color-text] font-heading">{{ 'cart.empty' | t }}</h3>
          <p>{{ 'cart.empty_description' | t }}</p>
          <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary btn--full" data-cart-drawer-close>
            <i class="ph ph-storefront"></i>
            <span>{{ 'cart.start_shopping' | t }}</span>
          </a>
        </div>
      {% endif %}
    </div>

    {%- comment -%} Footer {%- endcomment -%}
    {% if cart.item_count > 0 %}
      <div class="cart-drawer__footer">
        {%- comment -%} Cart Note {%- endcomment -%}
        <details class="cart-drawer__note-wrapper">
          <summary class="cart-drawer__note-toggle">
            <span>{{ 'cart.add_note' | t }}</span>
            <i class="ph ph-caret-down"></i>
          </summary>
          <div class="cart-drawer__note-content">
            <textarea
              name="note"
              class="cart-drawer__note-input"
              placeholder="{{ 'cart.note_placeholder' | t }}"
              data-cart-note
            >{{ cart.note }}</textarea>
          </div>
        </details>

        {%- comment -%} Subtotal {%- endcomment -%}
        <div class="cart-drawer__subtotal">
          <span>{{ 'cart.subtotal' | t }}</span>
          <span data-cart-subtotal>{{ cart.total_price | money }}</span>
        </div>
        <p class="cart-drawer__tax-note">
          {{ 'cart.taxes_shipping_note' | t }}
        </p>

        {%- comment -%} Actions {%- endcomment -%}
        <div class="cart-drawer__actions">
          <a href="{{ routes.cart_url }}" class="btn btn--secondary btn--full" data-cart-drawer-close>
            <span>{{ 'cart.view_cart' | t }}</span>
          </a>
          <form action="{{ routes.cart_url }}" method="post">
            <button type="submit" name="checkout" class="btn btn--primary btn--full">
              <i class="ph ph-lock-simple"></i>
              <span>{{ 'cart.checkout' | t }}</span>
            </button>
          </form>
        </div>
      </div>
    {% endif %}
  </div>
</div>
