{%- comment -%}
  Structured Data (JSON-LD) - SEO Schema Markup
  Include in theme.liquid: {% render 'structured-data' %}

  Outputs schema.org structured data for:
  - Organization (all pages)
  - WebSite with SearchAction (all pages)
  - BreadcrumbList (all pages except homepage)
  - Product (product pages)
  - CollectionPage (collection pages)
  - Article (blog article pages)
{%- endcomment -%}

{%- comment -%} Organization Schema - Global {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {%- if settings.logo %}
  "logo": {{ settings.logo | image_url: width: 600 | json }},
  {%- endif %}
  {%- if settings.social_facebook or settings.social_instagram or settings.social_twitter or settings.social_pinterest or settings.social_youtube or settings.social_tiktok %}
  "sameAs": [
    {%- if settings.social_facebook %}{{ settings.social_facebook | json }}{%- endif -%}
    {%- if settings.social_instagram %}{%- if settings.social_facebook %},{%- endif %}{{ settings.social_instagram | json }}{%- endif -%}
    {%- if settings.social_twitter %}{%- if settings.social_facebook or settings.social_instagram %},{%- endif %}{{ settings.social_twitter | json }}{%- endif -%}
    {%- if settings.social_pinterest %}{%- if settings.social_facebook or settings.social_instagram or settings.social_twitter %},{%- endif %}{{ settings.social_pinterest | json }}{%- endif -%}
    {%- if settings.social_youtube %}{%- if settings.social_facebook or settings.social_instagram or settings.social_twitter or settings.social_pinterest %},{%- endif %}{{ settings.social_youtube | json }}{%- endif -%}
    {%- if settings.social_tiktok %}{%- if settings.social_facebook or settings.social_instagram or settings.social_twitter or settings.social_pinterest or settings.social_youtube %},{%- endif %}{{ settings.social_tiktok | json }}{%- endif -%}
  ],
  {%- endif %}
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "url": "{{ shop.url }}/pages/contact"
  }
}
</script>

{%- comment -%} WebSite Schema with SearchAction - Global {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>

{%- comment -%} BreadcrumbList Schema - All pages except homepage {%- endcomment -%}
{%- unless request.path == '/' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ shop.url | json }}
    }
    {%- if template.name == 'product' -%}
      {%- if product.collections.first -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ product.collections.first.title | json }},
      "item": "{{ shop.url }}{{ product.collections.first.url }}"
    }
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": {{ product.title | json }},
      "item": "{{ shop.url }}{{ product.url }}"
    }
      {%- else -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ product.title | json }},
      "item": "{{ shop.url }}{{ product.url }}"
    }
      {%- endif -%}
    {%- elsif template.name == 'collection' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ collection.title | json }},
      "item": "{{ shop.url }}{{ collection.url }}"
    }
    {%- elsif template.name == 'article' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ blog.title | json }},
      "item": "{{ shop.url }}{{ blog.url }}"
    }
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": {{ article.title | json }},
      "item": "{{ shop.url }}{{ article.url }}"
    }
    {%- elsif template.name == 'blog' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ blog.title | json }},
      "item": "{{ shop.url }}{{ blog.url }}"
    }
    {%- elsif template.name == 'page' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ page.title | json }},
      "item": "{{ shop.url }}{{ page.url }}"
    }
    {%- elsif template.name == 'cart' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Cart",
      "item": "{{ shop.url }}/cart"
    }
    {%- elsif template.name == 'search' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Search",
      "item": "{{ shop.url }}/search"
    }
    {%- endif -%}
  ]
}
</script>
{%- endunless -%}

{%- comment -%} Product Schema - Product pages only {%- endcomment -%}
{%- if template.name == 'product' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": "{{ shop.url }}{{ product.url }}",
  "description": {{ product.description | strip_html | truncate: 5000 | json }},
  {%- if product.featured_image -%}
  "image": [
    {%- for image in product.images limit: 5 -%}
    {{ image | image_url: width: 1200 | json }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ],
  {%- endif -%}
  "sku": {{ product.selected_or_first_available_variant.sku | json }},
  {%- if product.selected_or_first_available_variant.barcode != blank -%}
  "gtin": {{ product.selected_or_first_available_variant.barcode | json }},
  {%- endif -%}
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  "offers": {
    "@type": "AggregateOffer",
    "url": "{{ shop.url }}{{ product.url }}",
    "priceCurrency": {{ cart.currency.iso_code | json }},
    "lowPrice": {{ product.price_min | money_without_currency | json }},
    "highPrice": {{ product.price_max | money_without_currency | json }},
    "offerCount": {{ product.variants.size }},
    "availability": "https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
  }
  {%- if product.metafields.reviews.rating.value != blank -%}
  ,"aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": {{ product.metafields.reviews.rating.value.rating | json }},
    "ratingCount": {{ product.metafields.reviews.rating_count.value | default: 1 | json }},
    "bestRating": {{ product.metafields.reviews.rating.value.scale_max | json }},
    "worstRating": {{ product.metafields.reviews.rating.value.scale_min | json }}
  }
  {%- endif -%}
}
</script>
{%- endif -%}

{%- comment -%} CollectionPage Schema - Collection pages only {%- endcomment -%}
{%- if template.name == 'collection' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ collection.title | json }},
  "url": "{{ shop.url }}{{ collection.url }}",
  "description": {{ collection.description | strip_html | truncate: 5000 | default: collection.title | json }}
  {%- if collection.image -%}
  ,"image": {{ collection.image | image_url: width: 1200 | json }}
  {%- endif -%}
  {%- if collection.products.size > 0 -%}
  ,"numberOfItems": {{ collection.products_count }}
  {%- endif -%}
}
</script>
{%- endif -%}

{%- comment -%} Article Schema - Blog article pages only {%- endcomment -%}
{%- if template.name == 'article' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ article.title | json }},
  "url": "{{ shop.url }}{{ article.url }}",
  "description": {{ article.excerpt_or_content | strip_html | truncate: 300 | json }},
  "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "dateModified": {{ article.updated_at | default: article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "author": {
    "@type": "Person",
    "name": {{ article.author | json }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ shop.name | json }}
    {%- if settings.logo -%}
    ,"logo": {
      "@type": "ImageObject",
      "url": {{ settings.logo | image_url: width: 600 | json }}
    }
    {%- endif -%}
  }
  {%- if article.image -%}
  ,"image": {{ article.image | image_url: width: 1200 | json }}
  {%- endif -%}
  ,"mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ shop.url }}{{ article.url }}"
  }
}
</script>
{%- endif -%}

{%- comment -%} LocalBusiness Schema (optional) - Rendered if store has physical location info {%- endcomment -%}
{%- if settings.enable_local_business_schema -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {%- if settings.logo -%}
  "logo": {{ settings.logo | image_url: width: 600 | json }},
  "image": {{ settings.logo | image_url: width: 600 | json }},
  {%- endif -%}
  {%- if settings.business_phone -%}
  "telephone": {{ settings.business_phone | json }},
  {%- endif -%}
  {%- if settings.business_email -%}
  "email": {{ settings.business_email | json }},
  {%- endif -%}
  {%- if settings.business_address or settings.business_city or settings.business_country -%}
  "address": {
    "@type": "PostalAddress"
    {%- if settings.business_address -%}
    ,"streetAddress": {{ settings.business_address | json }}
    {%- endif -%}
    {%- if settings.business_city -%}
    ,"addressLocality": {{ settings.business_city | json }}
    {%- endif -%}
    {%- if settings.business_state -%}
    ,"addressRegion": {{ settings.business_state | json }}
    {%- endif -%}
    {%- if settings.business_zip -%}
    ,"postalCode": {{ settings.business_zip | json }}
    {%- endif -%}
    {%- if settings.business_country -%}
    ,"addressCountry": {{ settings.business_country | json }}
    {%- endif -%}
  },
  {%- endif -%}
  {%- if settings.business_hours -%}
  "openingHours": {{ settings.business_hours | json }},
  {%- endif -%}
  "priceRange": "{{ settings.business_price_range | default: '$$' }}"
}
</script>
{%- endif -%}

{%- comment -%}
  FAQ Schema - Inject via section/block metafield or page content
  Use this render call in sections with FAQ blocks:
  {% render 'structured-data-faq', faqs: section.blocks %}
{%- endcomment -%}
