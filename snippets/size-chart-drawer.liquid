{%- comment -%}
  Size Chart Drawer
  Renders a drawer with size chart content.

  Accepts:
  - heading: {String} Drawer heading (optional)
  - page: {Page} Page object containing size chart content
  - content: {String} Rich text content if no page is specified

  Usage:
  {% render 'size-chart-drawer', heading: 'Size Guide', page: page %}
{%- endcomment -%}

<style>
  .size-chart-drawer {
    position: fixed;
    inset: 0;
    z-index: 999;
    pointer-events: none;
    visibility: hidden;
    transition: visibility 0s 0.3s;
  }
  .size-chart-drawer.is-open {
    pointer-events: auto;
    visibility: visible;
    transition: visibility 0s 0s;
  }
  .size-chart-drawer__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    transition: opacity 0.3s ease;
  }
  .size-chart-drawer.is-open .size-chart-drawer__backdrop {
    opacity: 1;
  }
  .size-chart-drawer__panel {
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 540px;
    height: 100%;
    background: var(--color-background);
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.1);
  }
  .size-chart-drawer.is-open .size-chart-drawer__panel {
    transform: translateX(0);
  }
  .size-chart-drawer__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem;
    border-bottom: 1px solid var(--color-border);
  }
  .size-chart-drawer__title {
    font-size: 1.125rem;
    font-weight: 600;
  }
  .size-chart-drawer__close {
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    color: inherit;
    transition: opacity 0.2s ease;
  }
  .size-chart-drawer__close:hover {
    opacity: 0.6;
  }
  .size-chart-drawer__body {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
  }
</style>

<div
  id="size-chart-drawer"
  class="size-chart-drawer"
  role="dialog"
  aria-modal="true"
  aria-labelledby="size-chart-drawer-title"
  data-size-chart-drawer
>
  {%- comment -%} Backdrop {%- endcomment -%}
  <div class="size-chart-drawer__backdrop" data-size-chart-close></div>

  {%- comment -%} Panel {%- endcomment -%}
  <div class="size-chart-drawer__panel">
    {%- comment -%} Header {%- endcomment -%}
    <div class="size-chart-drawer__header">
      <h2 id="size-chart-drawer-title" class="size-chart-drawer__title font-heading">
        {%- liquid
          if heading != blank
            echo heading
          else
            echo 'products.size_chart.title' | t
          endif
        -%}
      </h2>
      <button
        type="button"
        class="size-chart-drawer__close"
        data-size-chart-close
        aria-label="{{ 'accessibility.close' | t }}"
      >
        <i class="ph ph-x text-xl"></i>
      </button>
    </div>

    {%- comment -%} Body {%- endcomment -%}
    <div class="size-chart-drawer__body">
      {% if page != blank and page.content != blank %}
        <div class="prose prose-sm max-w-none">
          {{ page.content }}
        </div>
      {% elsif content != blank %}
        <div class="prose prose-sm max-w-none">
          {{ content }}
        </div>
      {% else %}
        {%- comment -%} Default size chart table {%- endcomment -%}
        <div class="space-y-6">
          <div>
            <h3 class="text-sm font-medium mb-2">{{ 'products.size_chart.how_to_measure' | t }}</h3>
            <p class="text-sm text-[--color-text-secondary]">
              {{ 'products.size_chart.measure_instructions' | t }}
            </p>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full text-sm border-collapse">
              <thead>
                <tr class="border-b border-[--color-border]">
                  <th class="py-3 px-4 text-left font-medium">{{ 'products.size_chart.size' | t }}</th>
                  <th class="py-3 px-4 text-center font-medium">{{ 'products.size_chart.chest' | t }}</th>
                  <th class="py-3 px-4 text-center font-medium">{{ 'products.size_chart.waist' | t }}</th>
                  <th class="py-3 px-4 text-center font-medium">{{ 'products.size_chart.hips' | t }}</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-[--color-border]">
                  <td class="py-3 px-4 font-medium">XS</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">32-34"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">24-26"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">34-36"</td>
                </tr>
                <tr class="border-b border-[--color-border]">
                  <td class="py-3 px-4 font-medium">S</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">34-36"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">26-28"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">36-38"</td>
                </tr>
                <tr class="border-b border-[--color-border]">
                  <td class="py-3 px-4 font-medium">M</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">36-38"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">28-30"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">38-40"</td>
                </tr>
                <tr class="border-b border-[--color-border]">
                  <td class="py-3 px-4 font-medium">L</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">38-40"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">30-32"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">40-42"</td>
                </tr>
                <tr class="border-b border-[--color-border]">
                  <td class="py-3 px-4 font-medium">XL</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">40-42"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">32-34"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">42-44"</td>
                </tr>
                <tr>
                  <td class="py-3 px-4 font-medium">XXL</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">42-44"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">34-36"</td>
                  <td class="py-3 px-4 text-center text-[--color-text-secondary]">44-46"</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="p-4 bg-[--color-background-secondary] rounded-lg">
            <p class="text-sm text-[--color-text-secondary]">
              <i class="ph ph-info mr-2"></i>
              {{ 'products.size_chart.fit_note' | t }}
            </p>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  // Remove any existing size chart drawers from body (cleanup from previous page)
  document.querySelectorAll('body > [data-size-chart-drawer]').forEach(el => el.remove());

  const drawer = document.querySelector('[data-size-chart-drawer]');
  if (!drawer) return;

  // Move drawer to body to escape stacking context created by .site-content
  document.body.appendChild(drawer);

  const closeButtons = drawer.querySelectorAll('[data-size-chart-close]');
  const openTriggers = document.querySelectorAll('[data-size-chart-open]');

  let isOpen = false;

  function openDrawer() {
    if (isOpen) return;
    isOpen = true;

    document.body.style.overflow = 'hidden';
    requestAnimationFrame(() => {
      drawer.classList.add('is-open');
    });
  }

  function closeDrawer() {
    if (!isOpen) return;
    isOpen = false;

    drawer.classList.remove('is-open');
    setTimeout(() => {
      document.body.style.overflow = '';
    }, 300);
  }

  // Open triggers
  openTriggers.forEach(trigger => {
    trigger.addEventListener('click', (e) => {
      e.preventDefault();
      openDrawer();
    });
  });

  // Close triggers
  closeButtons.forEach(btn => {
    btn.addEventListener('click', closeDrawer);
  });

  // Close on escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isOpen) {
      closeDrawer();
    }
  });

  // Global event for opening from elsewhere
  document.addEventListener('size-chart:open', openDrawer);
  document.addEventListener('size-chart:close', closeDrawer);
})();
</script>
