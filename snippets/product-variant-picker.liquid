{%- comment -%}
  Renders product variant-picker - Tailwind UI Design

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{%- endcomment -%}

{%- unless product.has_only_default_variant -%}
  <variant-selects
    id="variant-selects-{{ section.id }}"
    data-section="{{ section.id }}"
    {{ block.shopify_attributes }}
    class="block mt-6"
  >
    {%- for option in product.options_with_values -%}
      {%- liquid
        assign swatch_count = option.values | map: 'swatch' | compact | size
        assign picker_type = block.settings.picker_type
        assign option_name_lower = option.name | downcase

        if swatch_count > 0 and block.settings.swatch_shape != 'none'
          if block.settings.picker_type == 'dropdown'
            assign picker_type = 'swatch_dropdown'
          else
            assign picker_type = 'swatch'
          endif
        endif

        comment
          Check if this is a color option
        endcomment
        assign is_color_option = false
        if option_name_lower == 'color' or option_name_lower == 'colour'
          assign is_color_option = true
        endif
      -%}

      {%- if picker_type == 'swatch' or is_color_option -%}
        {%- comment -%} Tailwind UI Color Swatch Style {%- endcomment -%}
        <div class="mb-6">
          <h3 class="text-sm font-medium text-gray-600">{{ option.name }}</h3>
          <fieldset aria-label="{{ 'products.product.choose_option' | t: option: option.name }}" class="mt-2">
            <div class="flex items-center gap-x-3">
              {%- for value in option.values -%}
                {%- liquid
                  assign option_disabled = true
                  if value.available
                    assign option_disabled = false
                  endif

                  assign swatch_color = null
                  if value.swatch.color
                    assign swatch_color = 'rgb(' | append: value.swatch.color.rgb | append: ')'
                  elsif value.swatch.image
                    assign image_url = value.swatch.image | image_url: width: 50
                    assign swatch_color = 'url(' | append: image_url | append: ') center/cover'
                  else
                    comment
                      Fallback color based on value name
                    endcomment
                    assign value_lower = value | downcase
                    case value_lower
                      when 'black' or 'negro'
                        assign swatch_color = '#1f2937'
                      when 'white' or 'blanco'
                        assign swatch_color = '#ffffff'
                      when 'gray' or 'grey' or 'gris'
                        assign swatch_color = '#6b7280'
                      when 'red' or 'rojo'
                        assign swatch_color = '#ef4444'
                      when 'blue' or 'azul'
                        assign swatch_color = '#3b82f6'
                      when 'green' or 'verde'
                        assign swatch_color = '#22c55e'
                      when 'yellow' or 'amarillo'
                        assign swatch_color = '#eab308'
                      when 'pink' or 'rosa'
                        assign swatch_color = '#ec4899'
                      when 'purple' or 'morado'
                        assign swatch_color = '#a855f7'
                      when 'orange' or 'naranja'
                        assign swatch_color = '#f97316'
                      when 'brown' or 'marron'
                        assign swatch_color = '#92400e'
                      when 'navy'
                        assign swatch_color = '#1e3a5f'
                      when 'beige' or 'cream'
                        assign swatch_color = '#f5f5dc'
                      else
                        assign swatch_color = '#9ca3af'
                    endcase
                  endif
                -%}
                <div class="flex rounded-full outline outline-1 -outline-offset-1 outline-black/10{% if option_disabled %} opacity-40{% endif %}">
                  <input
                    type="radio"
                    id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                    name="{{ option.name }}-{{ option.position }}"
                    value="{{ value | escape }}"
                    form="{{ product_form_id }}"
                    {% if value.selected %}checked{% endif %}
                    {% if option_disabled %}disabled{% endif %}
                    data-product-url="{{ value.product_url }}"
                    data-option-value-id="{{ value.id }}"
                    aria-label="{{ value | escape }}"
                    class="size-8 appearance-none rounded-full forced-color-adjust-none checked:outline checked:outline-2 checked:outline-offset-2 checked:outline-gray-700 focus-visible:outline focus-visible:outline-[3px] focus-visible:outline-offset-[3px]"
                    style="background: {{ swatch_color }};"
                  >
                </div>
              {%- endfor -%}
            </div>
          </fieldset>
        </div>

      {%- elsif picker_type == 'button' -%}
        {%- comment -%} Pill/Button Style {%- endcomment -%}
        <fieldset class="js product-form__input product-form__input--pill mb-6">
          <legend class="block text-sm font-medium text-gray-900 mb-3">{{ option.name }}</legend>
          <div class="flex flex-wrap gap-2">
            {% render 'product-variant-options',
              product: product,
              option: option,
              block: block,
              picker_type: picker_type
            %}
          </div>
        </fieldset>

      {%- else -%}
        {%- comment -%} Dropdown Style {%- endcomment -%}
        <div class="product-form__input product-form__input--dropdown mb-6">
          <label class="block text-sm font-medium text-gray-900 mb-2" for="Option-{{ section.id }}-{{ forloop.index0 }}">
            {{ option.name }}
          </label>
          <div class="relative">
            {%- if picker_type == 'swatch_dropdown' -%}
              <span
                data-selected-value
                class="absolute left-3 top-1/2 -translate-y-1/2 z-10"
              >
                {% render 'swatch', swatch: option.selected_value.swatch, shape: block.settings.swatch_shape %}
              </span>
            {%- endif -%}
            <select
              id="Option-{{ section.id }}-{{ forloop.index0 }}"
              class="w-full h-12 {% if picker_type == 'swatch_dropdown' %}pl-12{% else %}pl-4{% endif %} pr-10 bg-white border border-gray-300 rounded-lg text-gray-900 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-shadow"
              name="options[{{ option.name | escape }}]"
              form="{{ product_form_id }}"
            >
              {% render 'product-variant-options',
                product: product,
                option: option,
                block: block,
                picker_type: picker_type
              %}
            </select>
            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
              <svg class="size-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
              </svg>
            </span>
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}

    <script type="application/json" data-selected-variant>
      {{ product.selected_or_first_available_variant | json }}
    </script>
  </variant-selects>
{%- endunless -%}
