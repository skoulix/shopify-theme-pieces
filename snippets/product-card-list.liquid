{%- comment -%}
  Product Card - List View
  A unified list view card used by both grid and metro layouts

  Usage:
  {% render 'product-card-list', product: product, index: forloop.index0, collection: collection %}

  Parameters:
  - product: Product object (required)
  - collection: Collection object (optional) - preserves collection context in URL
  - index: Card index for animation stagger (optional, default: 0)
{%- endcomment -%}

{%- liquid
  assign index = index | default: 0

  # Use global settings for vendor display
  assign show_vendor = settings.show_vendor

  if collection
    assign product_url = product.url | within: collection
  else
    assign product_url = product.url
  endif

  assign first_available_variant = product.selected_or_first_available_variant
  assign has_variants = false
  if product.variants.size > 1
    assign has_variants = true
  endif

  # Check if any action buttons are enabled
  assign show_action_buttons = false
  if settings.enable_wishlist or settings.enable_compare or settings.enable_quick_view
    assign show_action_buttons = true
  endif
-%}

<div
  class="product-card-list group p-2 grid gap-4 items-start grid-cols-[60px_1fr] sm:grid-cols-[80px_1fr] md:grid-cols-[100px_1fr_auto] md:gap-6 md:items-center"
  data-product-card="{{ index }}"
  data-product-id="{{ product.id }}"
  data-tween
  data-tween-type="fade-up">
  {%- comment -%} Image {%- endcomment -%}
  <a
    href="{{ product_url }}"
    class="product-card-list__image"
    aria-label="{{ product.title }}">
    {% if product.featured_image %}
      {%- assign focal_point = product.featured_image.presentation.focal_point | default: '50% 50%' -%}
      {%- assign focal_point_style = 'object-position: ' | append: focal_point -%}
      {{ product.featured_image | image_url: width: 400 | image_tag: class: 'w-full h-full object-cover', style: focal_point_style, loading: 'lazy', decoding: 'async', sizes: '100px', widths: '100, 200, 400', alt: product.title
      }}
    {% else %}
      <div class="w-full h-full flex items-center justify-center bg-(--color-background-secondary)">
        <i class="ph ph-image text-2xl text-(--color-text-secondary) opacity-30" aria-hidden="true"></i>
      </div>
    {% endif %}
  </a>

  {%- comment -%} Content {%- endcomment -%}
  <div class="product-card-list__content">
    {% if show_vendor and product.vendor != blank %}
      <p class="product-card-list__vendor card-meta">{{ product.vendor }}</p>
    {% endif %}

    <h3 class="product-card-list__title card-title">
      <a href="{{ product_url }}">{{ product.title }}</a>
    </h3>

    <div class="product-card-list__price">
      {% if product.compare_at_price > product.price %}
        <span class="product-card-list__price-compare">{{ product.compare_at_price | money }}</span>
        <span class="product-card-list__price-sale">{{ product.price | money }}</span>
      {% else %}
        <span>{{ product.price | money }}</span>
      {% endif %}
    </div>
  </div>

  {%- comment -%} Mobile buttons {%- endcomment -%}
  {%- assign btn_select_options = 'products.product.select_options' | t -%}
  {%- assign btn_add_to_cart = 'products.product.add_to_cart' | t -%}
  {%- assign btn_adding = 'cart.adding' | t -%}
  {%- assign btn_added = 'cart.added' | t -%}
  {%- assign btn_sold_out = 'products.product.sold_out' | t -%}
  <div class="product-card-list__buttons-mobile col-span-2">
    {% if product.available %}
      {% if has_variants %}
        <a
          href="{{ product_url }}"
          class="btn btn--primary btn--sm"
          aria-label="{{ btn_select_options }}: {{ product.title }}">
          {% render 'button-text', text: btn_select_options %}
        </a>
      {% else %}
        <button
          type="button"
          class="btn btn--primary btn--sm"
          data-quick-add="{{ first_available_variant.id }}"
          aria-label="{{ btn_add_to_cart }}: {{ product.title }}">
          <span data-add-text>{% render 'button-text', text: btn_add_to_cart %}</span>
          <span data-adding-text class="hidden">{{ btn_adding }}</span>
          <span data-added-text class="hidden">{{ btn_added }}</span>
        </button>
      {% endif %}
    {% else %}
      <button
        type="button"
        class="btn btn--secondary btn--sm"
        disabled
        aria-label="{{ btn_sold_out }}: {{ product.title }}">
        {% render 'button-text', text: btn_sold_out %}
      </button>
    {% endif %}

    {% if show_action_buttons %}
      <div class="product-card-list__actions-mobile">
        {% if settings.enable_quick_view and product.available %}
          <button
            type="button"
            class="btn btn--secondary btn--sm btn--icon"
            data-quick-view-trigger="{{ product.handle }}"
            aria-label="{{ 'products.product.quick_view' | t | default: 'Quick view' }}: {{ product.title }}">
            <i class="ph ph-eye text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
        {% if settings.enable_wishlist %}
          {%- capture wishlist_json -%}{"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}{%- endcapture -%}
          <button
            type="button"
            class="product-card-wishlist btn btn--secondary btn--sm btn--icon"
            data-wishlist-toggle="{{ product.id }}"
            data-product-json='{{ wishlist_json | strip_newlines | replace: "'", "&#39;" }}'
            aria-label="{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to wishlist' }}: {{ product.title }}"
            aria-pressed="false">
            <i class="ph ph-heart text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
        {% if settings.enable_compare %}
          {%- capture compare_json -%}{"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"type":{{ product.type | json }},"sku":{{ product.selected_or_first_available_variant.sku | json }},"available":{{ product.available | json }}}{%- endcapture -%}
          <button
            type="button"
            class="product-card-compare btn btn--secondary btn--sm btn--icon"
            data-compare-toggle="{{ product.id }}"
            data-product-json='{{ compare_json | strip_newlines | replace: "'", "&#39;" }}'
            aria-label="{{ 'products.compare.add_to_compare' | t | default: 'Add to compare' }}: {{ product.title }}"
            aria-pressed="false">
            <i class="ph ph-scales text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
      </div>
    {% endif %}
  </div>

  {%- comment -%} Desktop buttons (3rd column) {%- endcomment -%}
  <div class="product-card-list__buttons-desktop">
    {% if product.available %}
      {% if has_variants %}
        <a
          href="{{ product_url }}"
          class="btn btn--primary"
          aria-label="{{ btn_select_options }}: {{ product.title }}">
          {% render 'button-text', text: btn_select_options %}
        </a>
      {% else %}
        <button
          type="button"
          class="btn btn--primary"
          data-quick-add="{{ first_available_variant.id }}"
          aria-label="{{ btn_add_to_cart }}: {{ product.title }}">
          <span data-add-text>{% render 'button-text', text: btn_add_to_cart %}</span>
          <span data-adding-text class="hidden">{{ btn_adding }}</span>
          <span data-added-text class="hidden">{{ btn_added }}</span>
        </button>
      {% endif %}
    {% else %}
      <button
        type="button"
        class="btn btn--secondary"
        disabled
        aria-label="{{ btn_sold_out }}: {{ product.title }}">
        {% render 'button-text', text: btn_sold_out %}
      </button>
    {% endif %}

    {% if show_action_buttons %}
      <div class="product-card-list__actions-desktop">
        {% if settings.enable_quick_view and product.available %}
          <button
            type="button"
            class="btn btn--secondary btn--sm btn--icon"
            data-quick-view-trigger="{{ product.handle }}"
            aria-label="{{ 'products.product.quick_view' | t | default: 'Quick view' }}: {{ product.title }}">
            <i class="ph ph-eye text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
        {% if settings.enable_wishlist %}
          {%- capture wishlist_json_desktop -%}{"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"available":{{ product.available | json }}}{%- endcapture -%}
          <button
            type="button"
            class="product-card-wishlist btn btn--secondary btn--sm btn--icon"
            data-wishlist-toggle="{{ product.id }}"
            data-product-json='{{ wishlist_json_desktop | strip_newlines | replace: "'", "&#39;" }}'
            aria-label="{{ 'products.wishlist.add_to_wishlist' | t | default: 'Add to wishlist' }}: {{ product.title }}"
            aria-pressed="false">
            <i class="ph ph-heart text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
        {% if settings.enable_compare %}
          {%- capture compare_json_desktop -%}{"id":{{ product.id | json }},"handle":{{ product.handle | json }},"title":{{ product.title | json }},"url":{{ product.url | json }},"image":{{ product.featured_image | image_url: width: 800 | json }},"price":{{ product.price | json }},"compareAtPrice":{{ product.compare_at_price | default: 0 | json }},"vendor":{{ product.vendor | json }},"type":{{ product.type | json }},"sku":{{ product.selected_or_first_available_variant.sku | json }},"available":{{ product.available | json }}}{%- endcapture -%}
          <button
            type="button"
            class="product-card-compare btn btn--secondary btn--sm btn--icon"
            data-compare-toggle="{{ product.id }}"
            data-product-json='{{ compare_json_desktop | strip_newlines | replace: "'", "&#39;" }}'
            aria-label="{{ 'products.compare.add_to_compare' | t | default: 'Add to compare' }}: {{ product.title }}"
            aria-pressed="false">
            <i class="ph ph-scales text-lg" aria-hidden="true"></i>
          </button>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>